<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.basicauth.mapper.mace.MaceMapper">

    <resultMap id="InvalidBdaySearchMap" type="com.basicauth.data.InvalidBdaySearch">
        <result column="MEM_CODE" property="memCode" jdbcType="VARCHAR"/>
        <result column="HOSPITAL_CODE" property="hospCode" jdbcType="VARCHAR"/>
        <result column="HOSPITAL_NAME" property="hospName" jdbcType="VARCHAR"/>
        <result column="COORDINATOR" property="coordinator" jdbcType="VARCHAR"/>
        <result column="MEM_BDAY" property="memBday" jdbcType="DATE"/>
        <result column="BDAY_ENTERED" property="bdayEntered" jdbcType="DATE"/>
        <result column="LOG_DATE" property="logDate" jdbcType="TIMESTAMP"/>
        <result column="ACCOUNT_NAME" property="accountName" jdbcType="VARCHAR"/>
        <result column="ACCOUNT_CODE" property="accountCode" jdbcType="VARCHAR"/>
    </resultMap>

    <insert id="logInvalidSearch" flushCache="true">
        INSERT INTO INVALID_BDAY_SEARCH
        (MEM_CODE,
        HOSPITAL_CODE,
        HOSPITAL_NAME,
        COORDINATOR,
        MEM_BDAY,
        BDAY_ENTERED,
        LOG_DATE,
        ACCOUNT_NAME,
        ACCOUNT_CODE)
        VALUES
        (#{ibs.memCode, jdbcType=VARCHAR},
        #{ibs.hospCode, jdbcType=VARCHAR},
        #{ibs.hospName, jdbcType=VARCHAR},
        #{ibs.coordinator, jdbcType=VARCHAR},
        #{ibs.memBday, jdbcType=DATE},
        #{ibs.bdayEntered, jdbcType=DATE},
        CURRENT_TIMESTAMP,
        #{ibs.accountName, jdbcType=VARCHAR},
        #{ibs.accountCode, jdbcType=VARCHAR})
    </insert>

    <select id="getLastInvalidAttempt" resultMap="InvalidBdaySearchMap"
            resultType="com.basicauth.data.InvalidBdaySearch">
        SELECT TOP 1 * FROM INVALID_BDAY_SEARCH
        WHERE MEM_CODE = #{memberCode}
        ORDER BY LOG_DATE DESC
    </select>

    <delete id="deleteLogInvalidSearch" flushCache="true">
        DELETE FROM INVALID_BDAY_SEARCH
        WHERE MEM_CODE = #{memberCode}
    </delete>

    <select id="hasExistingMemUserAcct" resultType="java.util.HashMap">
        SELECT TOP 1 * from mem_useracct where
        username = ISNULL(#{username}, username) COLLATE SQL_Latin1_General_CP1_CS_AS
        AND
        mem_code = ISNULL(#{memberCode}, mem_code) COLLATE SQL_Latin1_General_CP1_CS_AS
    </select>

    <select id="getMemUserAcct" resultType="java.util.HashMap">
        SELECT TOP 1 * from mem_useracct where
        username = #{username} COLLATE SQL_Latin1_General_CP1_CS_AS
    </select>

    <select id="getMemUserAcctByMemberCode" resultType="java.util.HashMap">
        SELECT TOP 1 * from mem_useracct where
        mem_code = #{memberCode} COLLATE SQL_Latin1_General_CP1_CS_AS
    </select>

    <update id="increaseInvalidLoginCount">
        UPDATE mem_useracct set INVLOGINATT = ISNULL(INVLOGINATT,0) + 1 where username = #{username} COLLATE
        SQL_Latin1_General_CP1_CS_AS
    </update>

    <update id="resetInvalidLoginCount">
        UPDATE mem_useracct set INVLOGINATT = 0 where username = #{username} COLLATE SQL_Latin1_General_CP1_CS_AS
    </update>

    <update id="lockUser">
        UPDATE mem_useracct set STATUS = 'LOCKED' where username = #{username} COLLATE SQL_Latin1_General_CP1_CS_AS
    </update>

    <update id="unlockUser">
        UPDATE mem_useracct set STATUS = 'ACTIVE' where MEM_CODE = #{memCode} COLLATE SQL_Latin1_General_CP1_CS_AS
    </update>

    <insert id="saveImageHolder" parameterType="com.basicauth.domain.ImageHolder" flushCache="true">
        INSERT INTO MEM_IMAGE_HOLDER (
        mem_code,
        file_id,
        content_type,
        original_file_name,
        file_suffix,
        file_name_no_suffix,
        content
        )
        VALUES
        (
        #{imageHolder.memCode, jdbcType=VARCHAR},
        #{imageHolder.fileId, jdbcType=VARCHAR},
        #{imageHolder.contentType, jdbcType=VARCHAR},
        #{imageHolder.originalFileName, jdbcType=VARCHAR},
        #{imageHolder.fileSuffix, jdbcType=VARCHAR},
        #{imageHolder.fileNameNoSuffix, jdbcType=VARCHAR},
        #{imageHolder.content, javaType=byte[], jdbcType=BLOB, typeHandler=org.apache.ibatis.type.BlobTypeHandler}
        )
    </insert>

    <resultMap id="imageHolderMap" type="com.basicauth.domain.ImageHolder">
        <result column="id" property="id" jdbcType="NUMERIC"/>
        <result column="mem_code" property="memCode" jdbcType="VARCHAR"/>
        <result column="file_id" property="fileId" jdbcType="VARCHAR"/>
        <result column="content_type" property="contentType" jdbcType="VARCHAR"/>
        <result column="original_file_name" property="originalFileName" jdbcType="VARCHAR"/>
        <result column="file_suffix" property="fileSuffix" jdbcType="VARCHAR"/>
        <result column="file_name_no_suffix" property="fileNameNoSuffix" jdbcType="VARCHAR"/>
        <result column="content" property="content" jdbcType="BLOB"/>
    </resultMap>

    <select id="getImageHolder" resultMap="imageHolderMap">
        select TOP 1
        mem_code,
        file_id,
        content_type,
        original_file_name,
        file_suffix,
        file_name_no_suffix,
        content
        FROM
        MEM_IMAGE_HOLDER
        WHERE
        mem_code=#{memCode, jdbcType=VARCHAR} COLLATE SQL_Latin1_General_CP1_CS_AS
        ORDER BY id DESC
    </select>

    <!-- TODO: test addAttachment -->
    <insert id="saveMaceRequestAttachment" parameterType="com.basicauth.data.MaceRequestAttachment" flushCache="true"
            useGeneratedKeys="true" keyColumn="id" keyProperty="MaceRequestAttachment.id">
        INSERT INTO MACE_REQUEST_ATTACHMENTS (
            request_id,
            file_id,
            content_type,
            original_file_name,
            file_suffix,
            file_name_no_suffix,
            content,
            request_code,
            transaction_id,
            added_on
        )
        VALUES (
            #{MaceRequestAttachment.requestId, jdbcType=INTEGER},
            #{MaceRequestAttachment.fileId, jdbcType=VARCHAR},
            #{MaceRequestAttachment.contentType, jdbcType=VARCHAR},
            #{MaceRequestAttachment.originalFileName, jdbcType=VARCHAR},
            #{MaceRequestAttachment.fileSuffix, jdbcType=VARCHAR},
            #{MaceRequestAttachment.fileNameNoSuffix, jdbcType=VARCHAR},
            #{MaceRequestAttachment.content, javaType=byte[], jdbcType=BLOB, typeHandler=org.apache.ibatis.type.BlobTypeHandler},
           #{MaceRequestAttachment.requestCode, jdbcType=VARCHAR},
           #{MaceRequestAttachment.transactionId, jdbcType=VARCHAR},
           #{MaceRequestAttachment.addedOn, jdbcType=TIMESTAMP}
           )
    </insert>

    <resultMap id="loaMaceAttachmentMap" type="com.basicauth.data.MaceRequestAttachment">
        <result column="id" property="id" jdbcType="NUMERIC"/>
        <result column="request_id" property="requestId" jdbcType="INTEGER"/>
        <result column="file_id" property="fileId" jdbcType="VARCHAR"/>
        <result column="content_type" property="contentType" jdbcType="VARCHAR"/>
        <result column="original_file_name" property="originalFileName" jdbcType="VARCHAR"/>
        <result column="file_suffix" property="fileSuffix" jdbcType="VARCHAR"/>
        <result column="file_name_no_suffix" property="fileNameNoSuffix" jdbcType="VARCHAR"/>
        <result column="content" property="content" jdbcType="BLOB"/>
        <result column="request_code" property="requestCode" jdbcType="VARCHAR"/>
        <result column="transaction_id" property="transactionId" jdbcType="VARCHAR"/>
        <result column="added_on" property="addedOn" jdbcType="VARCHAR"/>
        <result column="added_by" property="addedBy" jdbcType="VARCHAR"/>
        <result column="remarks" property="remarks" jdbcType="VARCHAR"/>
    </resultMap>

    <select id="getMaceAttachmentsByReqCode" resultMap="loaMaceAttachmentMap" resultType="java.util.List">
        SELECT * FROM MACE_REQUEST_ATTACHMENTS WHERE request_code = #{requestCode}
    </select>

    <!--TODO: test select for deleteAttachmentByRequestCode-->
    <delete id="deleteMaceAttachment" flushCache="true">
        DELETE FROM MACE_REQUEST_ATTACHMENTS WHERE id=#{id}
    </delete>

    <!--TODO: test select for deleteAttachmentsByRequestCode-->
    <delete id="deleteMaceAttachmentByRequestCode" flushCache="true">
        DELETE FROM MACE_REQUEST_ATTACHMENTS WHERE request_code=#{requestCode}
    </delete>


    <!--TODO: test select for getAttachmentById-->
    <select id="retrieveMaceAttachment" resultMap="loaMaceAttachmentMap"
            resultType="com.basicauth.data.MaceRequestAttachment">
        select TOP 1
        id,
            request_id,
        file_id,
        content_type,
        original_file_name,
        file_suffix,
        file_name_no_suffix,
            content,
            request_code
        FROM MACE_REQUEST_ATTACHMENTS
        WHERE id=#{id}
    </select>


    <select id="hasExistingAppUserAcct" resultType="java.util.HashMap">
        SELECT TOP 1 * from APPUSER where
        APP_USERNAME = #{username} COLLATE SQL_Latin1_General_CP1_CS_AS
    </select>

    <select id="getAppUser" resultType="java.util.HashMap">
        SELECT TOP 1 * from APPUSER where
        APP_USERNAME = ISNULL(#{username}, APP_USERNAME) COLLATE SQL_Latin1_General_CP1_CS_AS
    </select>

    <select id="getUserAccounts" resultMap="memAccountMap" resultType="java.util.List">
        SELECT *
        FROM MEM_ACCTS
        WHERE USER_ACCT_ID = #{userAccountId}
    </select>

    <select id="getUserAccountsDependents" resultMap="memAccountMap" resultType="java.util.List">
        SELECT
        ID,
        USER_ACCT_ID,
        MEM_TYPE,
        MEM_CODE,
        MEM_FNAME,
        MEM_LNAME,
        MEM_MI,
        MEM_BDAY,
        MEM_SEX
        FROM MEM_ACCTS
        WHERE USER_ACCT_ID = #{userAccountId}
        AND MEM_TYPE = 0
    </select>

    <insert id="saveMemAccount" parameterType="com.basicauth.data.MemberAccount" flushCache="true">
        INSERT INTO MEM_ACCTS
        ([USER_ACCT_ID]
        ,[MEM_TYPE]
        ,[MEM_CODE]
        ,[MEM_LNAME]
        ,[MEM_FNAME]
        ,[MEM_MI]
        ,[MEM_BDAY]
        ,[MEM_SEX])
        VALUES
        (
        #{memberAccount.userAcctId, jdbcType=DOUBLE},
        #{memberAccount.memType, jdbcType=INTEGER},
        #{memberAccount.memCode, jdbcType=VARCHAR},
        #{memberAccount.memLname, jdbcType=VARCHAR},
        #{memberAccount.memFname, jdbcType=VARCHAR},
        #{memberAccount.memMname, jdbcType=VARCHAR},
        #{memberAccount.memBday, jdbcType=TIMESTAMP},
        #{memberAccount.memSex, jdbcType=INTEGER}
        )
    </insert>

    <resultMap id="memAccountMap" type="com.basicauth.data.MemberAccount">
        <result column="ID" property="id" jdbcType="DOUBLE"/>
        <result column="USER_ACCT_ID" property="userAcctId" jdbcType="DOUBLE"/>
        <result column="MEM_TYPE" property="memType" jdbcType="INTEGER"/>
        <result column="MEM_CODE" property="memCode" jdbcType="VARCHAR"/>
        <result column="MEM_LNAME" property="memLname" jdbcType="VARCHAR"/>
        <result column="MEM_FNAME" property="memFname" jdbcType="VARCHAR"/>
        <result column="MEM_MI" property="memMname" jdbcType="VARCHAR"/>
        <result column="MEM_BDAY" property="memBday" jdbcType="TIMESTAMP"/>
        <result column="MEM_SEX" property="memSex" jdbcType="INTEGER"/>
    </resultMap>

    <delete id="deleteImageHolder" flushCache="true">
        DELETE FROM MEM_IMAGE_HOLDER WHERE mem_code=#{memCode, jdbcType=VARCHAR} COLLATE SQL_Latin1_General_CP1_CS_AS
    </delete>

    <select id="getVerifiedMembers" resultMap="verifiedMemberMap" resultType="java.util.List">
        SELECT * FROM VERIFIED_MEMBER WHERE MEM_CODE=#{memberCode, jdbcType=VARCHAR} COLLATE
        SQL_Latin1_General_CP1_CS_AS
    </select>

    <select id="getLatestVerifiedMember" resultMap="verifiedMemberMap">
        SELECT TOP 1 * FROM VERIFIED_MEMBER WHERE MEM_CODE=#{memberCode, jdbcType=VARCHAR} COLLATE
        SQL_Latin1_General_CP1_CS_AS ORDER BY VERIFY_DATE DESC
    </select>

    <resultMap id="verifiedMemberMap" type="com.basicauth.data.VerifiedMember">
        <result column="ID" property="id" jdbcType="DOUBLE"/>
        <result column="MEM_CODE" property="memCode" jdbcType="VARCHAR"/>
        <result column="IS_SKIPPED" property="isSkipped" jdbcType="INTEGER"/>
        <result column="IS_VERIFIED" property="isVerified" jdbcType="INTEGER"/>
        <result column="APP_USERNAME" property="appUsername" jdbcType="VARCHAR"/>
        <result column="VERIFY_DATE" property="verifyDate" jdbcType="TIMESTAMP"/>
        <result column="ID_TYPE" property="idType" jdbcType="VARCHAR"/>
        <result column="ID_NUMBER" property="idNumber" jdbcType="VARCHAR"/>
        <result column="STATUS" property="status" jdbcType="VARCHAR"/>
    </resultMap>

    <insert id="saveVerifiedMember" parameterType="com.basicauth.data.VerifiedMember" flushCache="true">
        INSERT INTO VERIFIED_MEMBER (
        MEM_CODE,
        IS_SKIPPED,
        IS_VERIFIED,
        APP_USERNAME,
        VERIFY_DATE,
        ID_TYPE,
        ID_NUMBER,
        STATUS
        )
        VALUES
        (
        #{verifiedMember.memCode, jdbcType=VARCHAR},
        #{verifiedMember.isSkipped, jdbcType=INTEGER},
        #{verifiedMember.isVerified, jdbcType=INTEGER},
        #{verifiedMember.appUsername, jdbcType=VARCHAR},
        #{verifiedMember.verifyDate, jdbcType=TIMESTAMP},
        #{verifiedMember.idType, jdbcType=VARCHAR},
        #{verifiedMember.idNumber, jdbcType=VARCHAR},
        #{verifiedMember.status, jdbcType=VARCHAR}
        )
    </insert>

    <select id="findAppUserByUsername" resultMap="appUserMap" resultType="com.basicauth.data.AppUser">
        select TOP 1 * FROM APPUSER
        WHERE APP_USERNAME = ISNULL(#{username}, APP_USERNAME) COLLATE SQL_Latin1_General_CP1_CS_AS
    </select>

    <resultMap id="appUserMap" type="com.basicauth.data.AppUser">
        <result column="APPUSER_ID" property="id" jdbcType="INTEGER"/>
        <result column="APP_USERNAME" property="username" jdbcType="VARCHAR"/>
        <result column="APP_PASSWORD" property="password" jdbcType="VARCHAR"/>
        <result column="CNTCT_LNAME" property="lname" jdbcType="VARCHAR"/>
        <result column="CNTCT_FNAME" property="fname" jdbcType="VARCHAR"/>
        <result column="CNTCT_MNAME" property="mname" jdbcType="VARCHAR"/>
        <result column="CNTCT_EMAIL" property="email" jdbcType="VARCHAR"/>
        <result column="CNTCT_PHONENO" property="phoneno" jdbcType="VARCHAR"/>
        <result column="HOSPITAL" property="hospital" jdbcType="VARCHAR"/>
        <result column="ROLE" property="role" jdbcType="TIMESTAMP"/>
        <result column="LOCATION" property="location" jdbcType="VARCHAR"/>
        <result column="COSTCENTER" property="costcenter" jdbcType="VARCHAR"/>
        <result column="STATUS" property="status" jdbcType="VARCHAR"/>
        <result column="DOCTOR_CODE" property="doctorCode" jdbcType="VARCHAR"/>
        <result column="DENTIST_CODE" property="dentistCode" jdbcType="VARCHAR"/>
        <result column="FORCE_CHANGE_PASSWORD" property="forceChangePassword" jdbcType="INTEGER"/>
    </resultMap>

    <update id="updateContactNo" flushCache="true">
        UPDATE APPUSER
        SET CNTCT_PHONENO = #{contactNo}
        WHERE APP_USERNAME = #{appUsername}
    </update>

    <select id="getAppUserEmailByUsername" resultType="java.lang.String">
        SELECT CNTCT_EMAIL FROM APPUSER WHERE
        APP_USERNAME = #{username}
    </select>

    <select id="getAppUserByEmailAndDoctorOrDentistCode" resultMap="appUserMap" resultType="com.basicauth.data.AppUser">
        SELECT * FROM APPUSER
        WHERE CNTCT_EMAIL = #{email}
        AND (DOCTOR_CODE = #{code} OR DENTIST_CODE = #{code})
    </select>

    <insert id="saveTransactionCustomerCare" parameterType="com.basicauth.data.CustomerCare" flushCache="true">
        INSERT INTO [SYS_CUST_CARE_MTBL]
        ([CALLER_ID]
        ,[START_TIME]
        ,[END_TIME]
        ,[CALL_TYPE_ID]
        ,[CALL_DATE]
        ,[UPDATED_BY]
        ,[UPDATED_DATE]
        ,[HOSPITAL_CODE]
        ,[REMARKS]
        ,[CALLER]
        ,[COMPANY_CODE]
        ,[LOCATION]
        ,[TYPE]
        ,[DATE_ADMITTED]
        ,[MEMBER_TYPE]
        ,[DOCTOR_CODE]
        ,[ACTION_TAKEN]
        ,[APPROVAL_NO]
        ,[BATCH_CODE]
        ,[TERMINAL_NO]
        ,[DIAGNOSIS_CODE]
        ,[PROCEDURE_CODE]
        ,[PROCEDURE_AMOUNT]
        )
        VALUES
        (#{c.callerId, jdbcType=VARCHAR}
        ,#{c.startTime, jdbcType=TIMESTAMP}
        ,#{c.endTime, jdbcType=TIMESTAMP}
        ,#{c.callTypeId, jdbcType=INTEGER}
        ,#{c.callDate, jdbcType=TIMESTAMP}
        ,#{c.updatedBy, jdbcType=VARCHAR}
        ,#{c.updatedDate, jdbcType=TIMESTAMP}
        ,#{c.hospitalCode, jdbcType=VARCHAR}
        ,#{c.deviceId, jdbcType=VARCHAR}
        ,#{c.caller, jdbcType=VARCHAR}
        ,#{c.companyCode, jdbcType=VARCHAR}
        ,#{c.location, jdbcType=VARCHAR}
        ,#{c.type, jdbcType=INTEGER}
        ,#{c.dateAdmitted, jdbcType=TIMESTAMP}
        ,#{c.memberType, jdbcType=VARCHAR}
        ,#{c.doctorCode, jdbcType=VARCHAR}
        ,#{c.actionTaken, jdbcType=INTEGER}
        ,#{c.approvalNo, jdbcType=INTEGER}
        ,#{c.batchCode, jdbcType=INTEGER}
        ,#{c.terminalNo, jdbcType=VARCHAR}
        ,#{c.diagnosisCode, jdbcType=VARCHAR}
        ,#{c.procedureCode, jdbcType=VARCHAR}
        ,#{c.procedureAmount, jdbcType=NUMERIC}
        )
    </insert>

    <select id="isCompanyBlacklisted" resultType="java.lang.Boolean">
        SELECT CAST(
        CASE WHEN EXISTS(SELECT 1 FROM BLACKLISTED WHERE COMPANY_CODE= #{account_code} COLLATE
        SQL_Latin1_General_CP1_CS_AS AND SERVICE= #{serviceType}) THEN 1
        ELSE 0
        END
        AS BIT)
    </select>

    <select id="getLastId" resultType="java.util.HashMap">
        SELECT * FROM lastid WHERE LTRIM(RTRIM(name))= #{type}
    </select>

    <select id="checkIfMemberCodeExistingInAccount" resultType="java.lang.Boolean">
        SELECT CAST(
        CASE WHEN EXISTS(SELECT 1 FROM MEM_ACCTS WHERE USER_ACCT_ID= #{user_account_id} AND MEM_CODE= #{depMemberCode}
        COLLATE SQL_Latin1_General_CP1_CS_AS ) THEN 1
        ELSE 0
        END
        AS BIT)
    </select>

    <update id="updateLastId">
        UPDATE LASTID SET NO =#{approvaNo} WHERE LTRIM(RTRIM(NAME))=#{type}
    </update>

    <update id="changeMemUserAccountPassword">
        UPDATE mem_useracct SET password = #{encoded}, force_change_password=0 WHERE username = #{username}
    </update>

    <update id="changeMemUserAccountPasswordAuto">
        UPDATE mem_useracct SET password = #{encoded}, force_change_password=1 WHERE username = #{username}
    </update>

    <update id="changeMemUserAccountPin" flushCache="true">
        UPDATE mem_useracct SET pin = #{pin} WHERE username = #{username}
    </update>

    <insert id="saveTransactionCustomerCareApproval" parameterType="com.basicauth.data.CustomerCare" flushCache="true">
        INSERT INTO [SYS_CUST_CARE_LTBL]
        ([BATCH_CODE]
        ,[CALLER_ID]
        ,[MEMBER_CODE]
        ,[TYPE]
        ,[ROOM]
        ,[DATE_ADMITTED]
        ,[DIAGNOSIS]
        ,[PROCEDURE_DESC]
        ,[PROCEDURE_AMT]
        ,[ACTION_TAKEN]
        ,[APPROVAL_NO]
        ,[UPDATED_BY]
        ,[UPDATED_DATE]
        ,[REMARKS]
        ,[RUNNING_BILL]
        ,[NOTES]
        ,[REASON]
        ,[CATEGORY]
        ,[CLASSIFICATION]
        ,[MEM_LNAME]
        ,[MEM_FNAME]
        ,[MEM_COMPANY]
        ,[TERMINAL_NO]
        ,[DIAGNOSIS_CODE]
        ,[PROCEDURE_CODE]
        ,[SEARCH_TYPE]
        ,[DEVICE_ID]
        )
        VALUES
        (#{c.batchCode, jdbcType=VARCHAR}
        ,#{c.callerId, jdbcType=VARCHAR}
        ,#{c.memberCode, jdbcType=VARCHAR}
        ,#{c.type, jdbcType=INTEGER}
        ,#{c.room, jdbcType=VARCHAR}
        ,#{c.dateAdmitted, jdbcType=TIMESTAMP}
        ,#{c.diagnosis, jdbcType=VARCHAR}
        ,#{c.procedureDesc, jdbcType=VARCHAR}
        ,#{c.procedureAmount, jdbcType=NUMERIC}
        ,#{c.actionTaken, jdbcType=INTEGER}
        ,#{c.approvalNo, jdbcType=VARCHAR}
        ,#{c.updatedBy, jdbcType=VARCHAR}
        ,#{c.updatedDate, jdbcType=TIMESTAMP}
        ,#{c.remarks, jdbcType=VARCHAR}
        ,#{c.runningBill, jdbcType=NUMERIC}
        ,#{c.notes, jdbcType=VARCHAR}
        ,#{c.reason, jdbcType=VARCHAR}
        ,#{c.category, jdbcType=VARCHAR}
        ,#{c.classification, jdbcType=INTEGER}
        ,#{c.memLname, jdbcType=VARCHAR}
        ,#{c.memFname, jdbcType=VARCHAR}
        ,#{c.memCompany, jdbcType=VARCHAR}
        ,#{c.terminalNo, jdbcType=VARCHAR}
        ,#{c.diagnosisCode, jdbcType=VARCHAR}
        ,#{c.procedureCode, jdbcType=VARCHAR}
        ,#{c.searchType, jdbcType=VARCHAR}
        ,#{c.deviceId, jdbcType=VARCHAR}
        )
    </insert>

    <insert id="addToLoaHistory" parameterType="com.basicauth.data.CustomerCare" flushCache="true">
        INSERT INTO [SYS_CUST_CARE_LTBL_HISTORY]
        ([LTBL_ID]
        ,[BATCH_CODE]
        ,[CALLER_ID]
        ,[MEMBER_CODE]
        ,[TYPE]
        ,[ROOM]
        ,[DATE_ADMITTED]
        ,[DIAGNOSIS]
        ,[PROCEDURE_DESC]
        ,[PROCEDURE_AMT]
        ,[ACTION_TAKEN]
        ,[APPROVAL_NO]
        ,[UPDATED_BY]
        ,[UPDATED_DATE]
        ,[REMARKS]
        ,[RUNNING_BILL]
        ,[NOTES]
        ,[REASON]
        ,[CATEGORY]
        ,[CLASSIFICATION]
        ,[MEM_LNAME]
        ,[MEM_FNAME]
        ,[MEM_COMPANY]
        ,[TERMINAL_NO]
        ,[DIAGNOSIS_CODE]
        ,[PROCEDURE_CODE]
        )
        VALUES
        (#{c.id, jdbcType=INTEGER}
        ,#{c.batchCode, jdbcType=VARCHAR}
        ,#{c.callerId, jdbcType=VARCHAR}
        ,#{c.memberCode, jdbcType=VARCHAR}
        ,#{c.type, jdbcType=INTEGER}
        ,#{c.room, jdbcType=VARCHAR}
        ,#{c.dateAdmitted, jdbcType=TIMESTAMP}
        ,#{c.diagnosis, jdbcType=VARCHAR}
        ,#{c.procedureDesc, jdbcType=VARCHAR}
        ,#{c.procedureAmount, jdbcType=NUMERIC}
        ,#{c.actionTaken, jdbcType=INTEGER}
        ,#{c.approvalNo, jdbcType=VARCHAR}
        ,#{c.updatedBy, jdbcType=VARCHAR}
        ,#{c.updatedDate, jdbcType=TIMESTAMP}
        ,#{c.remarks, jdbcType=VARCHAR}
        ,#{c.runningBill, jdbcType=NUMERIC}
        ,#{c.notes, jdbcType=VARCHAR}
        ,#{c.reason, jdbcType=VARCHAR}
        ,#{c.category, jdbcType=VARCHAR}
        ,#{c.classification, jdbcType=INTEGER}
        ,#{c.memLname, jdbcType=VARCHAR}
        ,#{c.memFname, jdbcType=VARCHAR}
        ,#{c.memCompany, jdbcType=VARCHAR}
        ,#{c.terminalNo, jdbcType=VARCHAR}
        ,#{c.diagnosisCode, jdbcType=VARCHAR}
        ,#{c.procedureCode, jdbcType=VARCHAR}
        )
    </insert>

    <insert id="saveTransactionCustomerCarePhysician" parameterType="com.basicauth.data.CustomerCare" flushCache="true">
        INSERT INTO [SYS_CUST_CARE_PF_MTBL]
        ([BATCH_CODE]
        ,[DOCTOR_CODE]
        ,[SPECIALIZATION]
        ,[ACCREDITED]
        )
        VALUES
        (#{c.batchCode, jdbcType=VARCHAR}
        ,#{c.doctorCode, jdbcType=VARCHAR}
        ,#{c.specialization, jdbcType=VARCHAR}
        ,#{c.accredited, jdbcType=INTEGER}
        )
    </insert>

    <resultMap id="otherLimitMap" type="com.basicauth.data.OtherLimit">
        <result column="ID" property="id" jdbcType="INTEGER"/>
        <result column="STDLIMIT" property="stdLimit" jdbcType="NUMERIC"/>
        <result column="ALLOWLIMIT" property="allowLimit" jdbcType="NUMERIC"/>
        <result column="LIMIT_WHEN_PEC_EQUAL_DDL" property="limitWhenPecEqualDdl" jdbcType="NUMERIC"/>
        <result column="LIMIT_WHEN_PEC_UNEQUAL_DDL" property="limitWhenPecNotEqualDdl" jdbcType="NUMERIC"/>
        <result column="PROC_LIMIT_WHEN_REM_LIMIT_IS_LESS_THAN_20K" property="procLimitWhenRemLimitIsLessThan20k"
                jdbcType="NUMERIC"/>
        <result column="PROC_LIMIT_WHEN_REM_LIMIT_IS_LESS_THAN_20K_MORE_THAN_10K"
                property="procLimitWhenRemLimitIsLessThan20kLessThan10k" jdbcType="NUMERIC"/>
    </resultMap>

    <select id="getOtherLimit" resultMap="otherLimitMap" resultType="com.basicauth.data.OtherLimit">
        SELECT * FROM OTHERLIMIT
    </select>

    <select id="getInnerLimit" resultType="java.lang.Double">
        SELECT innerlimit.amount
        FROM innerlimit
        WHERE serviceclasscode =
            (SELECT
                CASE
                    WHEN UPPER(#{costCenter}) NOT IN (SELECT DISTINCT serviceclasscode FROM innerlimit WHERE serviceclasscode != 'OTHER')
                        THEN 'OTHER'
                    ELSE UPPER(#{costCenter})
                END
            AS VARCHAR)
    </select>

    <select id="findMemUserByEmailAndMemberCode" resultType="java.util.Map">
        SELECT TOP 1 * from mem_useracct where
        email = ISNULL(#{email}, email) COLLATE SQL_Latin1_General_CP1_CS_AS
        AND
        mem_code = ISNULL(#{memberCode}, mem_code) COLLATE SQL_Latin1_General_CP1_CS_AS
    </select>

    <resultMap id="blacklistMap" type="com.basicauth.data.Blacklist">
        <result column="ID" property="id" jdbcType="INTEGER"/>
        <result column="COMPANY_CODE" property="companyCode" jdbcType="VARCHAR"/>
        <result column="SERVICE" property="service" jdbcType="VARCHAR"/>
        <result column="DATE_AS_OF" property="asOfDate" jdbcType="TIMESTAMP"/>
    </resultMap>

    <select id="companyBlacklistedServices" resultMap="blacklistMap" resultType="java.util.List">
        SELECT * FROM BLACKLISTED WHERE COMPANY_CODE= #{account_code}
    </select>

    <resultMap id="specialAccountMap" type="com.basicauth.data.SpecialAccount">
        <result column="ID" property="id" jdbcType="INTEGER"/>
        <result column="ACCOUNT_CODE" property="accountCode" jdbcType="VARCHAR"/>
        <result column="STATUS_ASSIGNEE" property="statusAssignee" jdbcType="VARCHAR"/>
    </resultMap>

    <select id="getSpecialAccount" resultMap="specialAccountMap" resultType="com.basicauth.data.SpecialAccount">
        SELECT TOP 1 * FROM SPECIAL_ACCOUNTS WHERE ACCOUNT_CODE= #{account_code}
    </select>

    <select id="isMemberLocked" resultType="java.lang.Boolean">
        SELECT CAST(
        CASE WHEN EXISTS(SELECT 1 FROM LOCKED WHERE MEMBER_CODE= #{memberCode} COLLATE SQL_Latin1_General_CP1_CS_AS )
        THEN 1
        ELSE 0
        END
        AS BIT)
    </select>

    <insert id="lockMember" flushCache="true">
        INSERT INTO LOCKED (
        MEMBER_CODE,
        DATE_AS_OF,
        HOSP_CODE,
        HOSPITAL_NAME,
        MEM_BDAY,
        BDAY_ENTERED,
        ACCOUNT_CODE,
        ACCOUNT_NAME)
        VALUES
        (#{lockMember.memberCode, jdbcType=VARCHAR},
        #{lockMember.dateTimeBlocked, jdbcType=TIMESTAMP},
        #{lockMember.hospitalCode, jdbcType=VARCHAR},
        #{lockMember.hospitalName, jdbcType=VARCHAR},
        #{lockMember.bdayActual, jdbcType=DATE},
        #{lockMember.bdayEntered, jdbcType=DATE},
        #{lockMember.accountCode, jdbcType=VARCHAR},
        #{lockMember.accountName, jdbcType=VARCHAR})
    </insert>

    <insert id="saveLoaMace" parameterType="com.basicauth.data.LoaMace" flushCache="true">
        INSERT INTO [LOA_MACE]
        ([APPROVAL_NO]
        ,[BATCH_CODE]
        ,[CALLER_ID]
        ,[CALL_TYPE_ID]
        ,[MEMBER_CODE]
        ,[HOSPITAL_CODE]
        ,[COMPANY_CODE]
        ,[DOCTOR_CODE]
        ,[DIAGNOSIS_CODE]
        ,[PROCEDURE_CODE]
        ,[TYPE]
        ,[ROOM]
        ,[DATE_ADMITTED]
        ,[DIAGNOSIS]
        ,[PROCEDURE_DESC]
        ,[PROCEDURE_AMT]
        ,[ACTION_TAKEN]
        ,[UPDATED_BY]
        ,[UPDATED_DATE]
        ,[REMARKS]
        ,[RUNNING_BILL]
        ,[NOTES]
        ,[REASON]
        ,[CATEGORY]
        ,[MEM_LNAME]
        ,[MEM_FNAME]
        ,[MEM_MI]
        ,[MEM_COMPANY]
        ,[TERMINAL_NO]
        ,[CALL_DATE]
        ,[STATUS]
        ,[DATE_OF_APPROVAL]
        ,[PRIMARY_COMPLAINT]
        ,[DISCLAIMER_TICKED]
        ,[REQUEST_ORIGIN]
        )
        VALUES
        (#{loaMace.approvalNo,jdbcType=VARCHAR}
        ,#{loaMace.batchCode,jdbcType=VARCHAR}
        ,#{loaMace.callerId,jdbcType=VARCHAR}
        ,#{loaMace.callTypeId,jdbcType=INTEGER}
        ,#{loaMace.memberCode,jdbcType=VARCHAR}
        ,#{loaMace.hospitalCode,jdbcType=VARCHAR}
        ,#{loaMace.companyCode,jdbcType=VARCHAR}
        ,#{loaMace.doctorCode,jdbcType=VARCHAR}
        ,#{loaMace.diagnosisCode,jdbcType=VARCHAR}
        ,#{loaMace.procedureCode,jdbcType=VARCHAR}
        ,#{loaMace.type,jdbcType=VARCHAR}
        ,#{loaMace.room,jdbcType=VARCHAR}
        ,#{loaMace.dateAdmitted,jdbcType=TIMESTAMP}
        ,#{loaMace.diagnosis,jdbcType=VARCHAR}
        ,#{loaMace.procedureDesc,jdbcType=VARCHAR}
        ,#{loaMace.procedureAmount,jdbcType=NUMERIC}
        ,#{loaMace.actionTaken,jdbcType=INTEGER}
        ,#{loaMace.updatedBy,jdbcType=VARCHAR}
        ,#{loaMace.updatedDate,jdbcType=TIMESTAMP}
        ,#{loaMace.remarks,jdbcType=VARCHAR}
        ,#{loaMace.runningBill,jdbcType=NUMERIC}
        ,#{loaMace.notes,jdbcType=VARCHAR}
        ,#{loaMace.reason,jdbcType=VARCHAR}
        ,#{loaMace.category,jdbcType=VARCHAR}
        ,#{loaMace.memLname,jdbcType=VARCHAR}
        ,#{loaMace.memFname,jdbcType=VARCHAR}
        ,#{loaMace.memMi,jdbcType=VARCHAR}
        ,#{loaMace.memCompany,jdbcType=VARCHAR}
        ,#{loaMace.terminalNo,jdbcType=VARCHAR}
        ,#{loaMace.callDate,jdbcType=TIMESTAMP}
        ,#{loaMace.status,jdbcType=VARCHAR}
        ,#{loaMace.approvalDate,jdbcType=TIMESTAMP}
        ,#{loaMace.primaryComplaint, jdbcType=VARCHAR}
        ,#{loaMace.disclaimerTicked, jdbcType=INTEGER}
        ,#{loaMace.requestOrigin, jdbcType=VARCHAR}
        )
    </insert>

    <update id="cancelLOAByBatchCode" flushCache="true">
        UPDATE [LOA_MACE]
        SET REMARKS = #{user},
        STATUS = 'CANCELLED',
        UPDATED_DATE = GETDATE(),
        UPDATED_BY = #{updatedBy}
        WHERE BATCH_CODE = #{batchCode}
    </update>

    <update id="cancelLTBLByBatchCode" flushCache="true">
        UPDATE [SYS_CUST_CARE_LTBL]
        SET REMARKS = #{user},
        UPDATED_DATE = GETDATE(),
        UPDATED_BY = #{updatedBy}
        WHERE BATCH_CODE = #{batchCode}
    </update>

    <delete id="unlockMember">
        DELETE FROM LOCKED WHERE membercode=#{memberCode}
    </delete>

    <select id="getLockCount" resultType="int">
        SELECT COUNT(*) FROM LOCKED
    </select>

    <resultMap id="messagesMap" type="com.basicauth.data.Message">
        <result column="ID" property="id" jdbcType="INTEGER"/>
        <result column="MESSAGE_TYPE" property="messageType" jdbcType="VARCHAR"/>
        <result column="MESSAGE" property="message" jdbcType="VARCHAR"/>
    </resultMap>

    <select id="getMessages" resultMap="messagesMap" resultType="java.util.List">
        SELECT * FROM MESSAGE
    </select>

    <resultMap id="loaMaceMap" type="com.basicauth.data.LoaMace">
        <result column="ID" property="id" jdbcType="INTEGER"/>
        <result column="APPROVAL_NO" property="approvalNo" jdbcType="VARCHAR"/>
        <result column="BATCH_CODE" property="batchCode" jdbcType="VARCHAR"/>
        <result column="CALLER_ID" property="callerId" jdbcType="VARCHAR"/>
        <result column="CALL_TYPE_ID" property="callTypeId" jdbcType="INTEGER"/>
        <result column="MEMBER_CODE" property="memberCode" jdbcType="VARCHAR"/>
        <result column="HOSPITAL_CODE" property="hospitalCode" jdbcType="VARCHAR"/>
        <result column="COMPANY_CODE" property="companyCode" jdbcType="VARCHAR"/>
        <result column="DOCTOR_CODE" property="doctorCode" jdbcType="VARCHAR"/>
        <result column="DIAGNOSIS_CODE" property="diagnosisCode" jdbcType="VARCHAR"/>
        <result column="PROCEDURE_CODE" property="procedureCode" jdbcType="VARCHAR"/>
        <result column="TYPE" property="type" jdbcType="INTEGER"/>
        <result column="ROOM" property="room" jdbcType="VARCHAR"/>
        <result column="DATE_ADMITTED" property="dateAdmitted" jdbcType="TIMESTAMP"/>
        <result column="DIAGNOSIS" property="diagnosis" jdbcType="VARCHAR"/>
        <result column="PROCEDURE_DESC" property="procedureDesc" jdbcType="VARCHAR"/>
        <result column="PROCEDURE_AMOUNT" property="procedureAmount" jdbcType="NUMERIC"/>
        <result column="ACTION_TAKEN" property="actionTaken" jdbcType="DOUBLE"/>
        <result column="UPDATED_BY" property="updatedBy" jdbcType="VARCHAR"/>
        <result column="UPDATED_DATE" property="updatedDate" jdbcType="TIMESTAMP"/>
        <result column="REMARKS" property="remarks" jdbcType="VARCHAR"/>
        <result column="RUNNING_BILL" property="runningBill" jdbcType="NUMERIC"/>
        <result column="NOTES" property="notes" jdbcType="VARCHAR"/>
        <result column="REASON" property="reason" jdbcType="VARCHAR"/>
        <result column="CATEGORY" property="category" jdbcType="VARCHAR"/>
        <result column="MEM_LNAME" property="memLname" jdbcType="VARCHAR"/>
        <result column="MEM_FNAME" property="memFname" jdbcType="VARCHAR"/>
        <result column="MEM_MI" property="memMi" jdbcType="VARCHAR"/>
        <result column="MEM_COMPANY" property="memCompany" jdbcType="VARCHAR"/>
        <result column="TERMINAL_NO" property="terminalNo" jdbcType="VARCHAR"/>
        <result column="CALL_DATE" property="callDate" jdbcType="TIMESTAMP"/>
        <result column="STATUS" property="status" jdbcType="VARCHAR"/>
        <result column="DATE_OF_APPROVAL" property="approvalDate" jdbcType="TIMESTAMP"/>
        <result column="PRIMARY_COMPLAINT" property="primaryComplaint" jdbcType="VARCHAR"/>
        <result column="DISCLAIMER_TICKED" property="disclaimerTicked" jdbcType="INTEGER"/>
        <result column="REQUEST_ORIGIN" property="requestOrigin" jdbcType="VARCHAR"/>
    </resultMap>

    <resultMap id="loaMaceJsonMap" type="com.basicauth.data.LoaMaceJson">
        <result column="ID" property="id" jdbcType="INTEGER"/>
        <result column="APPROVAL_NO" property="approvalNo" jdbcType="VARCHAR"/>
        <result column="BATCH_CODE" property="batchCode" jdbcType="VARCHAR"/>
        <result column="CALLER_ID" property="callerId" jdbcType="VARCHAR"/>
        <result column="CALL_TYPE_ID" property="callTypeId" jdbcType="INTEGER"/>
        <result column="MEMBER_CODE" property="memberCode" jdbcType="VARCHAR"/>
        <result column="HOSPITAL_CODE" property="hospitalCode" jdbcType="VARCHAR"/>
        <result column="COMPANY_CODE" property="companyCode" jdbcType="VARCHAR"/>
        <result column="DOCTOR_CODE" property="doctorCode" jdbcType="VARCHAR"/>
        <result column="DIAGNOSIS_CODE" property="diagnosisCode" jdbcType="VARCHAR"/>
        <result column="PROCEDURE_CODE" property="procedureCode" jdbcType="VARCHAR"/>
        <result column="TYPE" property="type" jdbcType="INTEGER"/>
        <result column="ROOM" property="room" jdbcType="VARCHAR"/>
        <result column="DATE_ADMITTED" property="dateAdmitted" jdbcType="TIMESTAMP"/>
        <result column="DIAGNOSIS" property="diagnosis" jdbcType="VARCHAR"/>
        <result column="PROCEDURE_DESC" property="procedureDesc" jdbcType="VARCHAR"/>
        <result column="PROCEDURE_AMOUNT" property="procedureAmount" jdbcType="NUMERIC"/>
        <result column="ACTION_TAKEN" property="actionTaken" jdbcType="DOUBLE"/>
        <result column="UPDATED_BY" property="updatedBy" jdbcType="VARCHAR"/>
        <result column="UPDATED_DATE" property="updatedDate" jdbcType="TIMESTAMP"/>
        <result column="REMARKS" property="remarks" jdbcType="VARCHAR"/>
        <result column="RUNNING_BILL" property="runningBill" jdbcType="NUMERIC"/>
        <result column="NOTES" property="notes" jdbcType="VARCHAR"/>
        <result column="REASON" property="reason" jdbcType="VARCHAR"/>
        <result column="CATEGORY" property="category" jdbcType="VARCHAR"/>
        <result column="MEM_LNAME" property="memLname" jdbcType="VARCHAR"/>
        <result column="MEM_FNAME" property="memFname" jdbcType="VARCHAR"/>
        <result column="MEM_MI" property="memMi" jdbcType="VARCHAR"/>
        <result column="MEM_COMPANY" property="memCompany" jdbcType="VARCHAR"/>
        <result column="TERMINAL_NO" property="terminalNo" jdbcType="VARCHAR"/>
        <result column="CALL_DATE" property="callDate" jdbcType="TIMESTAMP"/>
        <result column="STATUS" property="status" jdbcType="VARCHAR"/>
        <result column="DATE_OF_APPROVAL" property="approvalDate" jdbcType="TIMESTAMP"/>
        <result column="PRIMARY_COMPLAINT" property="primaryComplaint" jdbcType="VARCHAR"/>
        <result column="DISCLAIMER_TICKED" property="disclaimerTicked" jdbcType="INTEGER"/>
        <result column="REQUEST_ORIGIN" property="requestOrigin" jdbcType="VARCHAR"/>
    </resultMap>

    <select id="getLoaByProvider" resultMap="loaMaceMap" resultType="java.util.List">
        SELECT * FROM LOA_MACE
        WHERE DOCTOR_CODE=#{doctorCode}
    </select>

    <select id="getLoaLTBLByBatchCode" resultMap="customerCareMap" resultType="com.basicauth.data.CustomerCare">
        SELECT Top 1 * FROM SYS_CUST_CARE_LTBL
        WHERE BATCH_CODE=#{batchCode}
    </select>

    <select id="getLoaByMemberCode" resultMap="loaMaceMap" resultType="java.util.List">
        SELECT TOP 100 * FROM LOA_MACE
        WHERE MEMBER_CODE=#{memberCode}
        ORDER BY DATE_OF_APPROVAL DESC
    </select>

    <select id="getFilteredLoaByMemberCode" resultMap="loaMaceMap" resultType="java.util.List">
        SELECT * FROM MACE_REQUEST
        WHERE MEMBER_CODE = #{memberCode}
        AND SERVICETYPE_ID = #{filterType}
    </select>

    <select id="getLoaByMemberCodeJson" resultMap="loaMaceJsonMap" resultType="java.util.List">
        SELECT * FROM LOA_MACE
        WHERE MEMBER_CODE=#{memberCode}
    </select>

    <select id="getMaceByRequestCode" resultMap="loaMaceMap" resultType="java.util.List">
        SELECT * FROM MACE_REQUEST
        WHERE REQUEST_CODE=#{requestCode}
    </select>

    <select id="getLoaByProviderAndMemberCode" resultMap="loaMaceMap" resultType="java.util.List">
        SELECT TOP 1 * FROM LOA_MACE
        WHERE MEMBER_CODE=#{memberCode} AND DOCTOR_CODE=#{doctorCode}
        ORDER BY DATE_ADMITTED DESC
    </select>

    <select id="getLoaByHospitalAndMemberCode" resultMap="loaMaceMap" resultType="java.util.List">
        SELECT * FROM MACE_REQUEST
        WHERE MEMBER_CODE=#{memberCode} AND HOSPITAL_CODE=#{hospitalCode}
    </select>

    <select id="getMemberLOAList" resultMap="maceRequestMap">
        {CALL [SP_MACE_GetLoaForMember](
        #{@membercode, mode=IN, jdbcType=VARCHAR },
        #{@hospitalCode, mode=IN, jdbcType=VARCHAR },
        #{@serviceType, mode=IN, jdbcType=VARCHAR },
        #{@requestStatus, mode=IN, jdbcType=VARCHAR },
        #{@requestId, mode=IN, jdbcType=INTEGER },
        #{@offset, mode=IN, jdbcType=INTEGER },
        #{@count, mode=IN, jdbcType=INTEGER }
        )}
    </select>

    <select id="getMemberLOAListNoHospital" resultMap="maceRequestMap">
        {CALL [SP_MACE_GetLoaForMemberNoHospital](
        #{@membercode, mode=IN, jdbcType=VARCHAR } ,
        #{@serviceType, mode=IN, jdbcType=VARCHAR },
        #{@requestStatus, mode=IN, jdbcType=VARCHAR },
        #{@offset, mode=IN, jdbcType=INTEGER },
        #{@count, mode=IN, jdbcType=INTEGER }
        )}
    </select>

    <select id="getLoaByApprovalNumberAndDoctorCode" resultMap="loaMaceMap">
        SELECT * FROM LOA_MACE
        WHERE APPROVAL_NO=#{approvalNumber} AND DOCTOR_CODE=#{doctorCode}
    </select>


    <resultMap id="inpatientMap" type="com.basicauth.data.InpatientJson">
        <result column="ID" property="id" jdbcType="INTEGER"/>
        <result column="MEMBER_CODE" property="memberCode" jdbcType="VARCHAR"/>
        <result column="MEMBER_NAME" property="memberName" jdbcType="VARCHAR"/>
        <result column="HOSPITAL_CODE" property="hospitalCode" jdbcType="VARCHAR"/>
        <result column="HOSPITAL_NAME" property="hospitalName" jdbcType="VARCHAR"/>
        <result column="USERNAME" property="username" jdbcType="VARCHAR"/>
        <result column="DOCTOR_CODE" property="doctorCode" jdbcType="VARCHAR"/>
        <result column="DOCTOR_NAME" property="doctorName" jdbcType="VARCHAR"/>
        <result column="COMPANY_CODE" property="companyCode" jdbcType="VARCHAR"/>
        <result column="DIAGNOSIS_CODE" property="diagnosisCode" jdbcType="VARCHAR"/>
        <result column="ROOM_TYPE" property="roomType" jdbcType="VARCHAR"/>
        <result column="DEVICE_ID" property="deviceId" jdbcType="VARCHAR"/>
        <result column="ROOM_NUMBER" property="roomNumber" jdbcType="VARCHAR"/>
        <result column="ROOM_PRICE" property="roomPrice" jdbcType="NUMERIC"/>
        <result column="CATEGORY" property="category" jdbcType="VARCHAR"/>
        <result column="PROCEDURE_CODE" property="procedureCode" jdbcType="VARCHAR"/>
        <result column="PROCEDURE_DESC" property="procedureDesc" jdbcType="VARCHAR"/>
        <result column="DIAGNOSIS_DESC" property="diagnosisDesc" jdbcType="VARCHAR"/>
        <result column="RUNNING_BILL" property="runningBill" jdbcType="NUMERIC"/>
        <result column="DATE_ADMITTED" property="dateAdmitted" jdbcType="TIMESTAMP"/>
        <result column="UPDATED_BY" property="updatedBy" jdbcType="VARCHAR"/>
        <result column="UPDATED_DATE" property="updatedDate" jdbcType="TIMESTAMP"/>
    </resultMap>

    <insert id="insertInpatientRecord" parameterType="com.basicauth.data.InpatientJson" flushCache="true">
        INSERT INTO [dbo].[INPATIENT_RECORD]
        ([MEMBER_CODE]
        ,[MEMBER_NAME]
        ,[HOSPITAL_CODE]
        ,[HOSPITAL_NAME]
        ,[USERNAME]
        ,[DOCTOR_CODE]
        ,[DOCTOR_NAME]
        ,[COMPANY_CODE]
        ,[DIAGNOSIS_CODE]
        ,[ROOM_TYPE]
        ,[DEVICE_ID]
        ,[ROOM_NUMBER]
        ,[ROOM_PRICE]
        ,[CATEGORY]
        ,[PROCEDURE_CODE]
        ,[PROCEDURE_DESC]
        ,[DIAGNOSIS_DESC]
        ,[RUNNING_BILL]
        ,[DATE_ADMITTED]
        ,[STATUS]
        ,[UPDATED_BY]
        ,[UPDATED_DATE])
        VALUES
        (
        #{i.memberCode,jdbcType=VARCHAR}
        ,#{i.memberName,jdbcType=VARCHAR}
        ,#{i.hospitalCode,jdbcType=VARCHAR}
        ,#{i.hospitalName,jdbcType=VARCHAR}
        ,#{i.username,jdbcType=VARCHAR}
        ,#{i.doctorCode,jdbcType=VARCHAR}
        ,#{i.doctorName,jdbcType=VARCHAR}
        ,#{i.companyCode,jdbcType=VARCHAR}
        ,#{i.diagnosisCode,jdbcType=VARCHAR}
        ,#{i.roomType,jdbcType=VARCHAR}
        ,#{i.deviceId,jdbcType=VARCHAR}
        ,#{i.roomNumber,jdbcType=VARCHAR}
        ,#{i.category,jdbcType=VARCHAR}
        ,#{i.procedureCode,jdbcType=VARCHAR}
        ,#{i.procedureDesc,jdbcType=VARCHAR}
        ,#{i.diagnosisDesc,jdbcType=VARCHAR}
        ,#{i.runningBill,jdbcType=NUMERIC}
        ,#{i.dateAdmitted,jdbcType=TIMESTAMP}
        ,#{i.status,jdbcType=VARCHAR}
        ,#{i.updatedBy,jdbcType=VARCHAR}
        ,#{i.updatedDate,jdbcType=TIMESTAMP}
        )
    </insert>

    <select id="checkInpatientRecord" resultMap="inpatientMap" resultType="com.basicauth.data.InpatientJson">
        SELECT * FROM INPATIENT_RECORD
        WHERE MEMBER_CODE=#{memberCode} AND HOSPITAL_CODE=#{hospitalCode} AND STATUS='ADMITTED'
    </select>
    <select id="checkIfProviderHasAppUserAccount" resultType="java.lang.Boolean">
        SELECT CAST(
        CASE WHEN EXISTS(SELECT * FROM [APPUSER] WHERE DOCTOR_CODE= #{doctorCode} COLLATE SQL_Latin1_General_CP1_CS_AS)
        THEN 1
        ELSE 0
        END
        AS BIT)
    </select>

    <update id="releaseInpatientRecord" flushCache="true">
        UPDATE INPATIENT_RECORD
        SET STATUS='RELEASED'
        WHERE MEMBER_CODE=#{memberCode} AND HOSPITAL_CODE=#{hospitalCode} AND STATUS='ADMITTED'
    </update>

    <update id="updateInpatientRecord" parameterType="com.basicauth.data.InpatientJson" flushCache="true">
        UPDATE INPATIENT_RECORD
        SET
        STATUS='ADMITTED'
        ,[USERNAME] = #{i.username}
        ,[DOCTOR_CODE] = #{i.doctorCode}
        ,[DOCTOR_NAME] = #{i.doctorName}
        ,[COMPANY_CODE] = #{i.companyCode}
        ,[DIAGNOSIS_CODE] = #{i.diagnosisCode}
        ,[ROOM_TYPE] = #{i.roomType}
        ,[DEVICE_ID] = #{i.deviceId}
        ,[ROOM_NUMBER] = #{i.roomNumber}
        ,[ROOM_PRICE] = #{i.roomPrice}
        ,[CATEGORY] = #{i.category}
        ,[PROCEDURE_CODE] = #{i.procedureCode}
        ,[PROCEDURE_DESC] = #{i.procedureDesc}
        ,[DIAGNOSIS_DESC] = #{i.diagnosisDesc}
        ,[RUNNING_BILL] = #{i.runningBill}
        ,[DATE_ADMITTED] = #{i.updatedBy}
        ,[UPDATED_BY] = #{i.updatedBy}
        ,[UPDATED_DATE] = #{i.updatedDate}
        WHERE ID = #{i.id}
    </update>

    <insert id="saveComplaint" flushCache="true">
        INSERT INTO [COMPLAINT]
        ([batch_code]
        ,[complaint])
        VALUES
        (#{batchCode,jdbcType=VARCHAR}
        ,#{complaint,jdbcType=VARCHAR})
    </insert>

    <insert id="insertConsultationRecordVersion2" parameterType="com.basicauth.data.ConsultationRecordVersion02Json"
            useGeneratedKeys="true" keyColumn="id" keyProperty="consultationRecordJson.id" flushCache="true">
        INSERT INTO [CONSULTATION_RECORD_V02]
        ([APPROVAL_NUMBER]
        ,[MEMBER_CODE]
        ,[MEMBER_NAME]
        ,[HOSPITAL_CODE]
        ,[HOSPITAL_NAME]
        ,[USERNAME]
        ,[DOCTOR_CODE]
        ,[DOCTOR_NAME]
        ,[COMPANY_CODE]
        ,[CONSULTATION_DATE]
        ,[CHIEF_COMPLAINT]
        ,[HISTORY_OF_PRESENT_ILLNESS]
        ,[PAST_OR_FAMILY_HISTORY]
        ,[REVIEW_OF_SYSTEMS]
        ,[VITALS_BP]
        ,[VITALS_HR]
        ,[VITALS_RR]
        ,[VITALS_TEMP]
        ,[PHYSICAL_EXAMINATION]
        ,[PRIMARY_DIAGNOSIS_CODE]
        ,[DX_REMARKS]
        ,[ILLNESS_TYPE]
        ,[PLAN_OF_MANAGEMENT_OR_NOTES])
        VALUES
        (#{consultationRecordJson.approvalNumber,jdbcType=VARCHAR}
        ,#{consultationRecordJson.memberCode,jdbcType=VARCHAR}
        ,#{consultationRecordJson.memberName,jdbcType=VARCHAR}
        ,#{consultationRecordJson.hospitalCode,jdbcType=VARCHAR}
        ,#{consultationRecordJson.hospitalName,jdbcType=VARCHAR}
        ,#{consultationRecordJson.username,jdbcType=VARCHAR}
        ,#{consultationRecordJson.doctorCode,jdbcType=VARCHAR}
        ,#{consultationRecordJson.doctorName,jdbcType=VARCHAR}
        ,#{consultationRecordJson.companyCode,jdbcType=VARCHAR}
        ,#{consultationRecordJson.consultationDate,jdbcType=TIMESTAMP}
        ,#{consultationRecordJson.chiefComplaint,jdbcType=VARCHAR}
        ,#{consultationRecordJson.historyOfPresentIllness,jdbcType=VARCHAR}
        ,#{consultationRecordJson.pastOrFamilyHistory,jdbcType=VARCHAR}
        ,#{consultationRecordJson.reviewOfSystems,jdbcType=VARCHAR}
        ,#{consultationRecordJson.vitalsBp,jdbcType=VARCHAR}
        ,#{consultationRecordJson.vitalsHr,jdbcType=VARCHAR}
        ,#{consultationRecordJson.vitalsRr,jdbcType=VARCHAR}
        ,#{consultationRecordJson.vitalsTemp,jdbcType=VARCHAR}
        ,#{consultationRecordJson.physicalExamination,jdbcType=VARCHAR}
        ,#{consultationRecordJson.primaryDiagnosisCode,jdbcType=VARCHAR}
        ,#{consultationRecordJson.dxRemarks,jdbcType=VARCHAR}
        ,#{consultationRecordJson.illnessType,jdbcType=VARCHAR}
        ,#{consultationRecordJson.planOfManagementOrNotes,jdbcType=VARCHAR}
        )
    </insert>

    <insert id="insertConsultationRecordVersion2PrescribedTestOrProcedures" flushCache="true">
        INSERT INTO [PRESCRIBED_TEST_OR_PROCEDURES]
        ([CONSULTATION_RECORD_ID] ,[DESCRIPTION])
        VALUES
        <foreach item="item" collection="prescribedTestOrProcedures" separator=",">
            (#{consultationRecordId},#{item})
        </foreach>
    </insert>

    <insert id="insertConsultationRecordVersion2OtherDiagnosisContributoryToChiefComplaint" flushCache="true">
        INSERT INTO [OTHER_DIAGNOSIS_CONTRIBUTORY_TO_CHIEF_COMPLAINT]
        ([CONSULTATION_RECORD_ID] ,[DESCRIPTION])
        VALUES
        <foreach item="item" collection="otherDiagnosisContributoryToChiefComplaint" separator=",">
            (#{consultationRecordId},#{item})
        </foreach>
    </insert>

    <insert id="insertConsultationRecordVersion2OtherDiagnosisNonContributoryToChiefComplaint" flushCache="true">
        INSERT INTO [OTHER_DIAGNOSIS_NON_CONTRIBUTORY_TO_CHIEF_COMPLAINT]
        ([CONSULTATION_RECORD_ID] ,[DESCRIPTION])
        VALUES
        <foreach item="item" collection="otherDiagnosisNonContributoryToChiefComplaint" separator=",">
            (#{consultationRecordId},#{item})
        </foreach>
    </insert>

    <insert id="insertConsultationRecordVersion2ProceduresDoneInClinic" flushCache="true">
        INSERT INTO [PROCEDURES_DONE_IN_CLINIC]
        ([CONSULTATION_RECORD_ID] ,[PROCEDURE_CODE])
        VALUES
        <foreach item="item" collection="proceduresDoneInClinic" separator=",">
            (#{consultationRecordId},#{item})
        </foreach>
    </insert>

    <insert id="insertConsultationRecordVersion3" parameterType="com.basicauth.data.ConsultationRecordVersion03Json"
            useGeneratedKeys="true" keyColumn="id" keyProperty="consultationRecordJson.id" flushCache="true">
        INSERT INTO [CONSULTATION_RECORD_V03]
        ([APPROVAL_NUMBER]
        ,[MEMBER_CODE]
        ,[MEMBER_NAME]
        ,[HOSPITAL_CODE]
        ,[HOSPITAL_NAME]
        ,[USERNAME]
        ,[DOCTOR_CODE]
        ,[DOCTOR_NAME]
        ,[COMPANY_CODE]
        ,[CONSULTATION_DATE]
        ,[CHIEF_COMPLAINT]
        ,[HISTORY_OF_PRESENT_ILLNESS]
        ,[PAST_OR_FAMILY_HISTORY]
        ,[REVIEW_OF_SYSTEMS]
        ,[VITALS_BP]
        ,[VITALS_HR]
        ,[VITALS_RR]
        ,[VITALS_TEMP]
        ,[PHYSICAL_EXAMINATION]
        ,[PRIMARY_DIAGNOSIS_CODE]
        ,[DX_REMARKS]
        ,[ILLNESS_TYPE]
        ,[PLAN_OF_MANAGEMENT_OR_NOTES])
        VALUES
        (#{consultationRecordJson.approvalNumber,jdbcType=VARCHAR}
        ,#{consultationRecordJson.memberCode,jdbcType=VARCHAR}
        ,#{consultationRecordJson.memberName,jdbcType=VARCHAR}
        ,#{consultationRecordJson.hospitalCode,jdbcType=VARCHAR}
        ,#{consultationRecordJson.hospitalName,jdbcType=VARCHAR}
        ,#{consultationRecordJson.username,jdbcType=VARCHAR}
        ,#{consultationRecordJson.doctorCode,jdbcType=VARCHAR}
        ,#{consultationRecordJson.doctorName,jdbcType=VARCHAR}
        ,#{consultationRecordJson.companyCode,jdbcType=VARCHAR}
        ,#{consultationRecordJson.consultationDate,jdbcType=TIMESTAMP}
        ,#{consultationRecordJson.chiefComplaint,jdbcType=VARCHAR}
        ,#{consultationRecordJson.historyOfPresentIllness,jdbcType=VARCHAR}
        ,#{consultationRecordJson.pastOrFamilyHistory,jdbcType=VARCHAR}
        ,#{consultationRecordJson.reviewOfSystems,jdbcType=VARCHAR}
        ,#{consultationRecordJson.vitalsBp,jdbcType=VARCHAR}
        ,#{consultationRecordJson.vitalsHr,jdbcType=VARCHAR}
        ,#{consultationRecordJson.vitalsRr,jdbcType=VARCHAR}
        ,#{consultationRecordJson.vitalsTemp,jdbcType=VARCHAR}
        ,#{consultationRecordJson.physicalExamination,jdbcType=VARCHAR}
        ,#{consultationRecordJson.primaryDiagnosisCode,jdbcType=VARCHAR}
        ,#{consultationRecordJson.dxRemarks,jdbcType=VARCHAR}
        ,#{consultationRecordJson.illnessType,jdbcType=VARCHAR}
        ,#{consultationRecordJson.planOfManagementOrNotes,jdbcType=VARCHAR}
        )
    </insert>

    <insert id="insertConsultationRecordVersion3PrescribedTestOrProceduresForPrimaryDiagnosisCodeList"
            flushCache="true">
        INSERT INTO [PRESCRIBED_TEST_OR_PROCEDURES_FOR_PRIMARY_DIAGNOSIS]
        ([CONSULTATION_RECORD_ID] ,[DESCRIPTION])
        VALUES
        <foreach item="item" collection="prescribedTestOrProceduresForPrimaryDiagnosisCodeList" separator=",">
            (#{consultationRecordId},#{item})
        </foreach>
    </insert>

    <insert id="insertConsultationRecordVersion3ProceduresDoneInClinic" flushCache="true">
        INSERT INTO [PROCEDURES_DONE_IN_CLINIC_V03]
        ([CONSULTATION_RECORD_ID] ,[PROCEDURE_CODE])
        VALUES
        <foreach item="item" collection="proceduresDoneInClinic" separator=",">
            (#{consultationRecordId},#{item})
        </foreach>
    </insert>

    <insert id="insertConsultationRecordVersion3OtherDiagnosisContributoryToChiefComplaintListDiagnosisCode"
            flushCache="true">
        INSERT INTO [OTHER_DIAGNOSIS_CONTRIBUTORY_TO_CHIEF_COMPLAINT_DIAGNOSIS_CODE_V03]
        ([CONSULTATION_RECORD_ID] ,[DIAGNOSIS_CODE])
        VALUES
        (#{consultationRecordId},#{diagnosisCode})
    </insert>

    <insert id="insertConsultationRecordVersion3OtherDiagnosisContributoryToChiefComplaintListPerDiagnosisCode"
            flushCache="true">
        INSERT INTO [OTHER_DIAGNOSIS_CONTRIBUTORY_TO_CHIEF_COMPLAINT_PER_DIAGNOSIS_CODE_V03]
        ([CONSULTATION_RECORD_ID] ,[DIAGNOSIS_CODE] ,[TEST_OR_PROCEDURE_CODE])
        VALUES
        <foreach item="item" collection="prescribedTestOrProcedureCodeList" separator=",">
            (#{consultationRecordId},#{diagnosisCode},#{item})
        </foreach>
    </insert>

    <insert id="insertConsultationRecordVersion3OtherDiagnosisNonContributoryToChiefComplaintListDiagnosisCode"
            flushCache="true">
        INSERT INTO [OTHER_DIAGNOSIS_NON_CONTRIBUTORY_TO_CHIEF_COMPLAINT_DIAGNOSIS_CODE_V03]
        ([CONSULTATION_RECORD_ID] ,[DIAGNOSIS_CODE])
        VALUES
        (#{consultationRecordId},#{diagnosisCode})
    </insert>

    <insert id="insertConsultationRecordVersion3OtherDiagnosisNonContributoryToChiefComplaintListPerDiagnosisCode"
            flushCache="true">
        INSERT INTO [OTHER_DIAGNOSIS_NON_CONTRIBUTORY_TO_CHIEF_COMPLAINT_PER_DIAGNOSIS_CODE_V03]
        ([CONSULTATION_RECORD_ID] ,[DIAGNOSIS_CODE] ,[TEST_OR_PROCEDURE_CODE] )
        VALUES
        <foreach item="item" collection="prescribedTestOrProcedureCodeList" separator=",">
            (#{consultationRecordId} ,#{diagnosisCode} ,#{item})
        </foreach>
    </insert>

    <resultMap id="consultationRecordVersion2Map" type="com.basicauth.data.ConsultationRecordVersion02Json">
        <result column="ID" property="id" jdbcType="INTEGER"/>
        <result column="APPROVAL_NUMBER" property="approvalNumber" jdbcType="VARCHAR"/>
        <result column="MEMBER_CODE" property="memberCode" jdbcType="VARCHAR"/>
        <result column="MEMBER_NAME" property="memberName" jdbcType="VARCHAR"/>
        <result column="HOSPITAL_CODE" property="hospitalCode" jdbcType="VARCHAR"/>
        <result column="HOSPITAL_NAME" property="hospitalName" jdbcType="VARCHAR"/>
        <result column="USERNAME" property="username" jdbcType="VARCHAR"/>
        <result column="DOCTOR_CODE" property="doctorCode" jdbcType="VARCHAR"/>
        <result column="DOCTOR_NAME" property="doctorName" jdbcType="VARCHAR"/>
        <result column="COMPANY_CODE" property="companyCode" jdbcType="VARCHAR"/>
        <result column="CONSULTATION_DATE" property="consultationDate" jdbcType="TIMESTAMP"/>
        <result column="CHIEF_COMPLAINT" property="chiefComplaint" jdbcType="VARCHAR"/>
        <result column="HISTORY_OF_PRESENT_ILLNESS" property="historyOfPresentIllness" jdbcType="VARCHAR"/>
        <result column="PAST_OR_FAMILY_HISTORY" property="pastOrFamilyHistory" jdbcType="VARCHAR"/>
        <result column="REVIEW_OF_SYSTEMS" property="reviewOfSystems" jdbcType="VARCHAR"/>
        <result column="VITALS_BP" property="vitalsBp" jdbcType="VARCHAR"/>
        <result column="VITALS_HR" property="vitalsHr" jdbcType="VARCHAR"/>
        <result column="VITALS_RR" property="vitalsRr" jdbcType="VARCHAR"/>
        <result column="VITALS_TEMP" property="vitalsTemp" jdbcType="VARCHAR"/>
        <result column="PHYSICAL_EXAMINATION" property="physicalExamination" jdbcType="VARCHAR"/>
        <result column="PRIMARY_DIAGNOSIS_CODE" property="primaryDiagnosisCode" jdbcType="VARCHAR"/>
        <result column="DX_REMARKS" property="dxRemarks" jdbcType="VARCHAR"/>
        <result column="ILLNESS_TYPE" property="illnessType" jdbcType="VARCHAR"/>
        <result column="PLAN_OF_MANAGEMENT_OR_NOTES" property="planOfManagementOrNotes" jdbcType="VARCHAR"/>
    </resultMap>

    <select id="getConsultationRecordVersion2" resultMap="consultationRecordVersion2Map"
            resultType="com.basicauth.data.ConsultationRecordVersion02Json">
        SELECT
        [ID]
        ,[APPROVAL_NUMBER]
        ,[MEMBER_CODE]
        ,[MEMBER_NAME]
        ,[HOSPITAL_CODE]
        ,[HOSPITAL_NAME]
        ,[USERNAME]
        ,[DOCTOR_CODE]
        ,[DOCTOR_NAME]
        ,[COMPANY_CODE]
        ,[CONSULTATION_DATE]
        ,[CHIEF_COMPLAINT]
        ,[HISTORY_OF_PRESENT_ILLNESS]
        ,[PAST_OR_FAMILY_HISTORY]
        ,[REVIEW_OF_SYSTEMS]
        ,[VITALS_BP]
        ,[VITALS_HR]
        ,[VITALS_RR]
        ,[VITALS_TEMP]
        ,[PHYSICAL_EXAMINATION]
        ,[PRIMARY_DIAGNOSIS_CODE]
        ,[DX_REMARKS]
        ,[ILLNESS_TYPE]
        ,[PLAN_OF_MANAGEMENT_OR_NOTES]
        FROM [CONSULTATION_RECORD_V02]
        WHERE [ID] = #{consultationRecordId}
    </select>

    <select id="getConsultationRecordVersion2OtherDiagnosisContributoryToChiefComplaint"
            resultType="java.lang.String">
        SELECT
        [DESCRIPTION]
        FROM
        [OTHER_DIAGNOSIS_CONTRIBUTORY_TO_CHIEF_COMPLAINT]
        WHERE
        [CONSULTATION_RECORD_ID] = #{consultationRecordId}
    </select>

    <select id="getConsultationRecordVersion2OtherDiagnosisNonContributoryToChiefComplaint"
            resultType="java.lang.String">
        SELECT
        [DESCRIPTION]
        FROM
        [OTHER_DIAGNOSIS_NON_CONTRIBUTORY_TO_CHIEF_COMPLAINT]
        WHERE
        [CONSULTATION_RECORD_ID] = #{consultationRecordId}
    </select>

    <select id="getConsultationRecordVersion2PrescribedTestOrProcedures" resultType="java.lang.String">
        SELECT
        [DESCRIPTION]
        FROM
        [PRESCRIBED_TEST_OR_PROCEDURES]
        WHERE
        [CONSULTATION_RECORD_ID] = #{consultationRecordId}
    </select>

    <select id="getConsultationRecordVersion2ProceduresDoneInClinic" resultType="java.lang.String">
        SELECT
            [PROCEDURE_CODE]
        FROM
          [PROCEDURES_DONE_IN_CLINIC]
        WHERE
          [CONSULTATION_RECORD_ID] = #{consultationRecordId}
    </select>

    <resultMap id="consultationRecordVersion3Map" type="com.basicauth.data.ConsultationRecordVersion03Json">
        <result column="ID" property="id" jdbcType="INTEGER"/>
        <result column="APPROVAL_NUMBER" property="approvalNumber" jdbcType="VARCHAR"/>
        <result column="MEMBER_CODE" property="memberCode" jdbcType="VARCHAR"/>
        <result column="MEMBER_NAME" property="memberName" jdbcType="VARCHAR"/>
        <result column="HOSPITAL_CODE" property="hospitalCode" jdbcType="VARCHAR"/>
        <result column="HOSPITAL_NAME" property="hospitalName" jdbcType="VARCHAR"/>
        <result column="USERNAME" property="username" jdbcType="VARCHAR"/>
        <result column="DOCTOR_CODE" property="doctorCode" jdbcType="VARCHAR"/>
        <result column="DOCTOR_NAME" property="doctorName" jdbcType="VARCHAR"/>
        <result column="COMPANY_CODE" property="companyCode" jdbcType="VARCHAR"/>
        <result column="CONSULTATION_DATE" property="consultationDate" jdbcType="TIMESTAMP"/>
        <result column="CHIEF_COMPLAINT" property="chiefComplaint" jdbcType="VARCHAR"/>
        <result column="HISTORY_OF_PRESENT_ILLNESS" property="historyOfPresentIllness" jdbcType="VARCHAR"/>
        <result column="PAST_OR_FAMILY_HISTORY" property="pastOrFamilyHistory" jdbcType="VARCHAR"/>
        <result column="REVIEW_OF_SYSTEMS" property="reviewOfSystems" jdbcType="VARCHAR"/>
        <result column="VITALS_BP" property="vitalsBp" jdbcType="VARCHAR"/>
        <result column="VITALS_HR" property="vitalsHr" jdbcType="VARCHAR"/>
        <result column="VITALS_RR" property="vitalsRr" jdbcType="VARCHAR"/>
        <result column="VITALS_TEMP" property="vitalsTemp" jdbcType="VARCHAR"/>
        <result column="PHYSICAL_EXAMINATION" property="physicalExamination" jdbcType="VARCHAR"/>
        <result column="PRIMARY_DIAGNOSIS_CODE" property="primaryDiagnosisCode" jdbcType="VARCHAR"/>
        <result column="DX_REMARKS" property="dxRemarks" jdbcType="VARCHAR"/>
        <result column="ILLNESS_TYPE" property="illnessType" jdbcType="VARCHAR"/>
        <result column="PLAN_OF_MANAGEMENT_OR_NOTES" property="planOfManagementOrNotes" jdbcType="VARCHAR"/>
    </resultMap>

    <select id="getConsultationRecordVersion3ByApprovalNo" resultMap="consultationRecordVersion3Map">
        SELECT TOP 1 [ID]
        ,A.[APPROVAL_NUMBER] AS APPROVAL_NUMBER
        ,A.[MEMBER_CODE] AS MEMBER_CODE
        ,A.[MEMBER_NAME] AS MEMBER_NAME
        ,A.[HOSPITAL_CODE] AS HOSPITAL_CODE
        ,B.[HOSPITAL_NAME] AS HOSPITAL_NAME
        ,A.[USERNAME] AS USERNAME
        ,A.[DOCTOR_CODE] AS DOCTOR_CODE
        ,A.[DOCTOR_NAME] AS DOCTOR_NAME
        ,A.[COMPANY_CODE] AS COMPANY_CODE
        ,A.[CONSULTATION_DATE] AS CONSULTATION_DATE
        ,A.[CHIEF_COMPLAINT] AS CHIEF_COMPLAINT
        ,A.[HISTORY_OF_PRESENT_ILLNESS] AS HISTORY_OF_PRESENT_ILLNESS
        ,A.[PAST_OR_FAMILY_HISTORY] AS PAST_OR_FAMILY_HISTORY
        ,A.[REVIEW_OF_SYSTEMS] AS REVIEW_OF_SYSTEMS
        ,A.[VITALS_BP] AS VITALS_BP
        ,A.[VITALS_HR] AS VITALS_HR
        ,A.[VITALS_RR] AS VITALS_RR
        ,A.[VITALS_TEMP] AS VITALS_TEMP
        ,A.[PHYSICAL_EXAMINATION] AS PHYSICAL_EXAMINATION
        ,A.[PRIMARY_DIAGNOSIS_CODE] AS PRIMARY_DIAGNOSIS_CODE
        ,A.[DX_REMARKS] AS DX_REMARKS
        ,A.[ILLNESS_TYPE] AS ILLNESS_TYPE
        ,A.[PLAN_OF_MANAGEMENT_OR_NOTES] AS PLAN_OF_MANAGEMENT_OR_NOTES
        FROM [Mace].[dbo].[CONSULTATION_RECORD_V03] AS A
        LEFT JOIN [Claims].[dbo].SYS_HOSPITALS_LTBL AS B ON A.HOSPITAL_CODE = B.HOSPITAL_CODE
        WHERE APPROVAL_NUMBER = #{approvalNo}
    </select>

    <select id="getConsultationRecordVersion3" resultMap="consultationRecordVersion3Map"
            resultType="com.basicauth.data.ConsultationRecordVersion03Json">
        SELECT
        [ID]
        ,[APPROVAL_NUMBER]
        ,[MEMBER_CODE]
        ,[MEMBER_NAME]
        ,[HOSPITAL_CODE]
        ,[HOSPITAL_NAME]
        ,[USERNAME]
        ,[DOCTOR_CODE]
        ,[DOCTOR_NAME]
        ,[COMPANY_CODE]
        ,[CONSULTATION_DATE]
        ,[CHIEF_COMPLAINT]
        ,[HISTORY_OF_PRESENT_ILLNESS]
        ,[PAST_OR_FAMILY_HISTORY]
        ,[REVIEW_OF_SYSTEMS]
        ,[VITALS_BP]
        ,[VITALS_HR]
        ,[VITALS_RR]
        ,[VITALS_TEMP]
        ,[PHYSICAL_EXAMINATION]
        ,[PRIMARY_DIAGNOSIS_CODE]
        ,[DX_REMARKS]
        ,[ILLNESS_TYPE]
        ,[PLAN_OF_MANAGEMENT_OR_NOTES]
        FROM [CONSULTATION_RECORD_V03]
        WHERE [ID] = #{consultationRecordId}
    </select>

    <select id="getConsultationRecordVersion3PrescribedTestOrProcedures" resultType="java.lang.String">
        SELECT
        [DESCRIPTION]
        FROM
        [PRESCRIBED_TEST_OR_PROCEDURES_FOR_PRIMARY_DIAGNOSIS]
        WHERE
        [CONSULTATION_RECORD_ID] = #{consultationRecordId}
    </select>

    <select id="getConsultationRecordVersion3ProceduresDoneInClinic" resultType="java.lang.String">
        SELECT
            [PROCEDURE_CODE]
        FROM
          [PROCEDURES_DONE_IN_CLINIC_V03]
        WHERE
          [CONSULTATION_RECORD_ID] = #{consultationRecordId}
    </select>

    <select id="getConsultationRecordVersion3OtherDiagnosisNonContributoryToChiefComplaintList"
            resultType="java.lang.String">
        SELECT
        [DIAGNOSIS_CODE]
        FROM
        [OTHER_DIAGNOSIS_NON_CONTRIBUTORY_TO_CHIEF_COMPLAINT_DIAGNOSIS_CODE_V03]
        WHERE
        [CONSULTATION_RECORD_ID] = #{consultationRecordId}
    </select>

    <select id="getConsultationRecordVersion3OtherDiagnosisNonContributoryToChiefComplaintListPerDiagnosisCode"
            resultType="java.lang.String">
        SELECT
        [TEST_OR_PROCEDURE_CODE]
        FROM
        [OTHER_DIAGNOSIS_NON_CONTRIBUTORY_TO_CHIEF_COMPLAINT_PER_DIAGNOSIS_CODE_V03]
        WHERE
        [CONSULTATION_RECORD_ID] = #{consultationRecordId}
        AND
        [DIAGNOSIS_CODE] = #{diagnosisCode}
    </select>

    <select id="getConsultationRecordVersion3OtherDiagnosisContributoryToChiefComplaintList"
            resultType="java.lang.String">
        SELECT
        [DIAGNOSIS_CODE]
        FROM
        [OTHER_DIAGNOSIS_CONTRIBUTORY_TO_CHIEF_COMPLAINT_DIAGNOSIS_CODE_V03]
        WHERE
        [CONSULTATION_RECORD_ID] = #{consultationRecordId}
    </select>

    <select id="getConsultationRecordVersion3OtherDiagnosisContributoryToChiefComplaintListPerDiagnosisCode"
            resultType="java.lang.String">
        SELECT
        [TEST_OR_PROCEDURE_CODE]
        FROM
        [OTHER_DIAGNOSIS_CONTRIBUTORY_TO_CHIEF_COMPLAINT_PER_DIAGNOSIS_CODE_V03]
        WHERE
        [CONSULTATION_RECORD_ID] = #{consultationRecordId}
        AND
        [DIAGNOSIS_CODE] = #{diagnosisCode}
    </select>

    <resultMap id="blockingMessageMap" type="com.basicauth.data.BlockingMessages">
        <result column="id" property="id" jdbcType="INTEGER"/>
        <result column="blockingCode" property="blockingCode" jdbcType="VARCHAR"/>
        <result column="remarks" property="remarks" jdbcType="VARCHAR"/>
        <result column="responseCode" property="responseCode" jdbcType="INTEGER"/>
        <result column="responseDesc" property="responseDesc" jdbcType="VARCHAR"/>
    </resultMap>

    <select id="getBlockingMessageByCode" resultMap="blockingMessageMap"
            resultType="com.basicauth.data.BlockingMessages">
        SELECT TOP 1 * FROM BLOCKING_MESSAGES
        WHERE blockingCode = #{msgCode}
    </select>

    <resultMap id="transactionCostsMap" type="com.basicauth.data.TransactionCosts">
        <result column="id" property="id" jdbcType="INTEGER"/>
        <result column="transactionType" property="transactionType" jdbcType="VARCHAR"/>
        <result column="cost" property="cost" jdbcType="NUMERIC"/>
    </resultMap>

    <select id="getCostByTransactionType" resultType="java.lang.Double">
        SELECT cost FROM TRANSACTION_COSTS
        WHERE transactionType = #{transaction}
    </select>

    <select id="getRequestByComparison" resultType="java.lang.Integer">
        SELECT CAST(
        CASE WHEN EXISTS(SELECT * FROM LOA_MACE WHERE
        DATEDIFF(day, DATE_ADMITTED, #{c.dateAdmitted, jdbcType=TIMESTAMP}) = 0
        AND MEMBER_CODE = #{c.memberCode, jdbcType=VARCHAR}
        AND DOCTOR_CODE = #{c.doctorCode, jdbcType=VARCHAR}
        AND REMARKS = #{c.remarks, jdbcType=VARCHAR}
        AND HOSPITAL_CODE = #{c.hospitalCode, jdbcType=VARCHAR}
        AND PROCEDURE_CODE = #{c.procedureCode, jdbcType=VARCHAR}
        AND DIAGNOSIS_CODE = #{c.diagnosisCode, jdbcType=VARCHAR}
        AND STATUS != 'CANCELLED'
        ) THEN 2
        WHEN EXISTS(SELECT * FROM LOA_MACE WHERE
        DATEDIFF(day, DATE_ADMITTED, #{c.dateAdmitted, jdbcType=TIMESTAMP}) &gt;= 0 AND
        DATEDIFF(day, DATE_ADMITTED, #{c.dateAdmitted, jdbcType=TIMESTAMP}) &lt; 3
        AND MEMBER_CODE = #{c.memberCode, jdbcType=VARCHAR}
        AND HOSPITAL_CODE = #{c.hospitalCode, jdbcType=VARCHAR}
        AND PROCEDURE_CODE = #{c.procedureCode, jdbcType=VARCHAR}
        AND DIAGNOSIS_CODE = #{c.diagnosisCode, jdbcType=VARCHAR}
        AND STATUS != 'CANCELLED'
        ) THEN 1
        ELSE 0
        END AS INT)
    </select>

    <insert id="storeInTempTransaction">
        INSERT INTO SYS_CUST_CARE_HOLD
        (BATCH_CODE,
        CALLER_ID,
        START_TIME,
        END_TIME,
        CALL_TYPE_ID,
        CALL_DATE,
        UPDATED_BY,
        UPDATED_DATE,
        HOSPITAL_CODE,
        REMARKS,
        CALLER,
        COMPANY_CODE,
        LOCATION,
        DIAGNOSIS_CODE,
        DIAGNOSIS,
        PROCEDURE_DESC,
        PROCEDURE_AMT,
        PROCEDURE_CODE,
        PROCEDURE_AMOUNT,
        TYPE,
        DATE_ADMITTED,
        MEMBER_TYPE,
        DOCTOR_CODE,
        ACTION_TAKEN,
        APPROVAL_NO,
        TERMINAL_NO,
        MEMBER_CODE,
        ROOM,
        RUNNING_BILL,
        NOTES,
        REASON,
        CATEGORY,
        CLASSIFICATION,
        MEM_LNAME,
        MEM_FNAME,
        MEM_COMPANY,
        SEARCH_TYPE,
        DEVICE_ID,
        PRIMARY_COMPLAINT,
        REQUEST_ORIGIN,
        DOCTOR_NAME,
        SPECIALIZATION,
        ACCREDITED,
        MEM_MI
        )VALUES(
        #{c.batchCode, jdbcType=VARCHAR},
        #{c.callerId, jdbcType=VARCHAR},
        #{c.startTime, jdbcType=TIMESTAMP},
        #{c.endTime, jdbcType=TIMESTAMP},
        #{c.callTypeId, jdbcType=INTEGER},
        #{c.callDate, jdbcType=TIMESTAMP},
        #{c.updatedBy, jdbcType=VARCHAR},
        #{c.updatedDate, jdbcType=TIMESTAMP},
        #{c.hospitalCode, jdbcType=VARCHAR},
        #{c.remarks, jdbcType=VARCHAR},
        #{c.caller, jdbcType=VARCHAR},
        #{c.companyCode, jdbcType=VARCHAR},
        #{c.location, jdbcType=VARCHAR},
        #{c.diagnosisCode, jdbcType=VARCHAR},
        #{c.diagnosis, jdbcType=VARCHAR},
        #{c.procedureDesc, jdbcType=VARCHAR},
        #{c.procedureAmt, jdbcType=NUMERIC},
        #{c.procedureCode, jdbcType=VARCHAR},
        #{c.procedureAmount, jdbcType=NUMERIC},
        #{c.type, jdbcType=INTEGER},
        #{c.dateAdmitted, jdbcType=TIMESTAMP},
        #{c.memberType, jdbcType=VARCHAR},
        #{c.doctorCode, jdbcType=VARCHAR},
        #{c.actionTaken, jdbcType=INTEGER},
        #{c.approvalNo, jdbcType=VARCHAR},
        #{c.terminalNo, jdbcType=VARCHAR},
        #{c.memberCode, jdbcType=VARCHAR},
        #{c.room, jdbcType=VARCHAR},
        #{c.runningBill, jdbcType=NUMERIC},
        #{c.notes, jdbcType=VARCHAR},
        #{c.reason, jdbcType=VARCHAR},
        #{c.category, jdbcType=VARCHAR},
        #{c.classification, jdbcType=VARCHAR},
        #{c.memLname, jdbcType=VARCHAR},
        #{c.memFname, jdbcType=VARCHAR},
        #{c.memCompany, jdbcType=VARCHAR},
        #{c.searchType, jdbcType=VARCHAR},
        #{c.deviceId, jdbcType=VARCHAR},
        #{c.primaryComplaint, jdbcType=VARCHAR},
        #{c.requestOrigin, jdbcType=VARCHAR},
        #{c.doctorName, jdbcType=VARCHAR},
        #{c.specialization, jdbcType=VARCHAR},
        #{c.accredited, jdbcType=INTEGER},
        #{c.memMi, jdbcType=VARCHAR}
        )
    </insert>

    <resultMap id="customerCareMap" type="com.basicauth.data.CustomerCare">
        <result column="ID" property="id" jdbcType="INTEGER"/>
        <result column="BATCH_CODE" property="batchCode" jdbcType="VARCHAR"/>
        <result column="CALLER_ID" property="callerId" jdbcType="VARCHAR"/>
        <result column="START_TIME" property="startTime" jdbcType="TIMESTAMP"/>
        <result column="END_TIME" property="endTime" jdbcType="TIMESTAMP"/>
        <result column="RETURNED_CALL" property="returnedCall" jdbcType="INTEGER"/>
        <result column="CALL_TYPE_ID" property="callTypeId" jdbcType="INTEGER"/>
        <result column="CALL_DATE" property="callDate" jdbcType="TIMESTAMP"/>
        <result column="UPDATED_BY" property="updatedBy" jdbcType="VARCHAR"/>
        <result column="UPDATED_DATE" property="updatedDate" jdbcType="TIMESTAMP"/>
        <result column="HOSPITAL_CODE" property="hospitalCode" jdbcType="VARCHAR"/>
        <result column="REMARKS" property="remarks" jdbcType="VARCHAR"/>
        <result column="CALLER" property="caller" jdbcType="VARCHAR"/>
        <result column="COMPANY_CODE" property="companyCode" jdbcType="VARCHAR"/>
        <result column="LOCATION" property="location" jdbcType="VARCHAR"/>
        <result column="DIAGNOSIS_CODE" property="diagnosisCode" jdbcType="VARCHAR"/>
        <result column="DIAGNOSIS" property="diagnosis" jdbcType="VARCHAR"/>
        <result column="PROCEDURE_DESC" property="procedureDesc" jdbcType="VARCHAR"/>
        <result column="PROCEDURE_AMT" property="procedureAmount" jdbcType="NUMERIC"/>
        <result column="PROCEDURE_CODE" property="procedureCode" jdbcType="VARCHAR"/>
        <result column="PROCEDURE_AMOUNT" property="procedureAmount" jdbcType="NUMERIC"/>
        <result column="TYPE" property="type" jdbcType="INTEGER"/>
        <result column="DATE_ADMITTED" property="dateAdmitted" jdbcType="TIMESTAMP"/>
        <result column="MEMBER_TYPE" property="memberType" jdbcType="VARCHAR"/>
        <result column="DOCTOR_CODE" property="doctorCode" jdbcType="VARCHAR"/>
        <result column="ACTION_TAKEN" property="actionTaken" jdbcType="INTEGER"/>
        <result column="APPROVAL_NO" property="approvalNo" jdbcType="VARCHAR"/>
        <result column="TERMINAL_NO" property="terminalNo" jdbcType="VARCHAR"/>
        <result column="MEMBER_CODE" property="memberCode" jdbcType="VARCHAR"/>
        <result column="ROOM" property="room" jdbcType="VARCHAR"/>
        <result column="RUNNING_BILL" property="runningBill" jdbcType="NUMERIC"/>
        <result column="NOTES" property="notes" jdbcType="VARCHAR"/>
        <result column="REASON" property="reason" jdbcType="VARCHAR"/>
        <result column="CATEGORY" property="category" jdbcType="VARCHAR"/>
        <result column="CLASSIFICATION" property="classification" jdbcType="VARCHAR"/>
        <result column="MEM_LNAME" property="memLname" jdbcType="VARCHAR"/>
        <result column="MEM_FNAME" property="memFname" jdbcType="VARCHAR"/>
        <result column="MEM_COMPANY" property="memCompany" jdbcType="VARCHAR"/>
        <result column="SEARCH_TYPE" property="searchType" jdbcType="VARCHAR"/>
        <result column="DEVICE_ID" property="deviceId" jdbcType="VARCHAR"/>
        <result column="PRIMARY_COMPLAINT" property="primaryComplaint" jdbcType="VARCHAR"/>
        <result column="REQUEST_ORIGIN" property="requestOrigin" jdbcType="VARCHAR"/>
        <result column="DOCTOR_NAME" property="doctorName" jdbcType="VARCHAR"/>
        <result column="SPECIALIZATION" property="specialization" jdbcType="VARCHAR"/>
        <result column="ACCREDITED" property="accredited" jdbcType="INTEGER"/>
        <result column="MEM_MI" property="memMi" jdbcType="VARCHAR"/>
    </resultMap>

    <select id="getCustomerCareByBatchCode" resultMap="customerCareMap" resultType="com.basicauth.data.CustomerCare">
        SELECT TOP 1 * FROM SYS_CUST_CARE_HOLD WHERE BATCH_CODE = #{batchCode, jdbcType=VARCHAR}
    </select>

    <update id="setLoaStatusByApprovalNo" flushCache="true">
        UPDATE LOA_MACE
        SET STATUS = #{status},
        DISCLAIMER_TICKED = #{disclaimerTicked}
        WHERE APPROVAL_NO = #{approvalNo}
    </update>

    <resultMap id="appUserDeviceMap" type="com.basicauth.data.AppUserDevice">
        <result column="ID" property="id" jdbcType="INTEGER"/>
        <result column="APPUSER_ID" property="appuserId" jdbcType="VARCHAR"/>
        <result column="DEVICE_ID" property="deviceId" jdbcType="VARCHAR"/>
        <result column="VALID_FROM" property="validFrom" jdbcType="TIMESTAMP"/>
        <result column="VALID_TO" property="validTo" jdbcType="TIMESTAMP"/>
        <result column="VERSION_NO" property="versionNo" jdbcType="VARCHAR"/>
    </resultMap>

    <select id="getAppUsersByDeviceId" resultType="string">
        SELECT APP_USERNAME FROM APPUSER WHERE APPUSER_ID IN
        (SELECT APPUSER_ID FROM APPUSER_DEVICE WHERE DEVICE_ID = #{deviceId})
    </select>

    <update id="changeAppUserDeviceVersionNo" flushCache="true">
        UPDATE APPUSER_DEVICE
        SET VERSION_NO = #{versionNo}
        WHERE DEVICE_ID = #{deviceId}
    </update>

    <resultMap id="appVersionMap" type="com.basicauth.data.AppVersion">
        <result column="id" property="id" jdbcType="INTEGER"/>
        <result column="USER_TYPE" property="userType" jdbcType="VARCHAR"/>
        <result column="VERSION_NO" property="versionNo" jdbcType="VARCHAR"/>
        <result column="FORCE_VERSION" property="forceVersion" jdbcType="VARCHAR"/>
    </resultMap>

    <select id="getAppUserDeviceByDeviceId" resultMap="appUserDeviceMap" resultType="com.basicauth.data.AppUserDevice">
        SELECT TOP 1 * FROM APPUSER_DEVICE
        WHERE DEVICE_ID = #{deviceId}
    </select>

    <select id="getAppVersionByUserType" resultMap="appVersionMap" resultType="com.basicauth.data.AppVersion">
        SELECT TOP 1 * FROM APP_VERSION
        WHERE USER_TYPE = #{type}
    </select>

    <select id="getPinByMemberCode" resultType="java.lang.String">
        SELECT TOP 1 PIN FROM MEM_USERACCT
        WHERE MEM_CODE = #{memberCode}
    </select>

    <update id="updateLOADisclaimerByApprovalNo" flushCache="true">
        UPDATE LOA_MACE
        SET DISCLAIMER_TICKED = #{disclaimerTicked}
        WHERE APPROVAL_NO = #{approvalNo}
    </update>

    <select id="getDisclaimerTickedByMemberCode" resultType="java.lang.Integer">
        SELECT TOP 1 HAS_DISCLAIMER FROM MEM_USERACCT
        WHERE MEM_CODE = #{memberCode}
    </select>

    <update id="updateDisclaimerTickedByMemberCode" flushCache="true">
        UPDATE MEM_USERACCT
        SET HAS_DISCLAIMER = #{disclaimerTicked, jdbcType=INTEGER},
        DISCLAIMER_LAST_UPDATE = #{date, jdbcType=TIMESTAMP}
        WHERE MEM_CODE = #{memberCode, jdbcType=VARCHAR}
    </update>

    <update id="changeAppUserAccountPassword" flushCache="true">
        UPDATE APPUSER
        SET APP_PASSWORD = #{password},
        FORCE_CHANGE_PASSWORD = 0
        WHERE APP_USERNAME = #{username}
    </update>

    <update id="changeAppUserAccountPasswordAuto" flushCache="true">
        UPDATE APPUSER
        SET APP_PASSWORD = #{password},
        FORCE_CHANGE_PASSWORD = 1
        WHERE APP_USERNAME = #{username}
    </update>

    <resultMap id="RecordConsultMap" type="com.basicauth.data.RecordConsult">
        <result column="id" property="id" jdbcType="INTEGER"/>
        <result column="reference_code" property="referenceCode" jdbcType="VARCHAR"/>
        <result column="mem_code" property="memCode" jdbcType="VARCHAR"/>
        <result column="mem_name" property="memName" jdbcType="VARCHAR"/>
        <result column="mem_age" property="memAge" jdbcType="INTEGER"/>
        <result column="mem_gender" property="memGender" jdbcType="VARCHAR"/>
        <result column="company_name" property="companyName" jdbcType="VARCHAR"/>
        <result column="date_approved" property="dateApproved" jdbcType="TIMESTAMP"/>
        <result column="hospital_code" property="hospitalCode" jdbcType="VARCHAR"/>
        <result column="hospital_name" property="hospitalName" jdbcType="VARCHAR"/>
        <result column="doctor_code" property="doctorCode" jdbcType="VARCHAR"/>
        <result column="doctor_name" property="doctorName" jdbcType="VARCHAR"/>
        <result column="doctor_field" property="doctorField" jdbcType="VARCHAR"/>
        <result column="reason_for_consult" property="reasonForConsult" jdbcType="VARCHAR"/>
        <result column="primary_diagnosis" property="primaryDiagnosis" jdbcType="VARCHAR"/>
        <result column="other_diagnosis" property="otherDiagnosis" jdbcType="VARCHAR"/>
        <result column="notes" property="notes" jdbcType="VARCHAR"/>
        <result column="LOA_MACE_REQUEST_ID" property="loaMaceRequestId" jdbcType="VARCHAR"/>
        <result column="date_submitted" property="dateSubmitted" jdbcType="TIMESTAMP"/>
        <result column="date_expired" property="dateExpired" jdbcType="TIMESTAMP"/>
    </resultMap>

    <select id="getAvailedConsultationListByDoctorCodeAndMemberCode" resultMap="loaMaceMap" resultType="java.util.List">
        SELECT * FROM LOA_MACE
        WHERE doctor_code = #{doctorCode}
        AND member_code = #{memberCode}
        AND STATUS = 'AVAILED'
    </select>

    <select id="getAvailedConsultationByDoctorCodeAndMemberCode" resultMap="loaMaceMap"
            resultType="com.basicauth.data.LoaMace">
        SELECT * FROM LOA_MACE
        WHERE id = #{referenceNo}
        AND STATUS = 'AVAILED'
    </select>

    <select id="getAvailedConsultationById" resultMap="loaMaceMap" resultType="com.basicauth.data.LoaMace">
        SELECT * FROM LOA_MACE
        WHERE id = #{referenceNo, jdbcType=INTEGER}
        AND STATUS = 'AVAILED'
    </select>

    <select id="getAvailedConsultationByApprovalNo" resultMap="loaMaceMap" resultType="com.basicauth.data.LoaMace">
        SELECT * FROM LOA_MACE
        WHERE APPROVAL_NO = #{approvalNo}
        AND STATUS = 'AVAILED'
    </select>

    <resultMap id="RequestOpProcedureMap" type="com.basicauth.data.MaceRequestOpProcedure">
        <result column="DIAGPROC_ID" property="diagProcId" jdbcType="INTEGER"/>
        <!--<result column="REQDIAG_ID" property="reqProcId" jdbcType="INTEGER"/>-->
        <result column="MACEREQUEST_ID" property="maceRequestId" jdbcType="INTEGER"/>
        <result column="PRESCRIBEDTEST_ID" property="prescribedTestId" jdbcType="INTEGER"/>
        <result column="TRANSACTION_ID" property="transactionId" jdbcType="INTEGER"/>
        <result column="REF_DIAGPROC_ID" property="refDiagProcId" jdbcType="INTEGER"/>
        <result column="DIAG_CODE" property="diagCode" jdbcType="VARCHAR"/>
        <result column="PROC_CODE" property="procCode" jdbcType="VARCHAR"/>
        <result column="PROC_DESC" property="procDesc" jdbcType="VARCHAR"/>
        <result column="RUV" property="ruv" jdbcType="VARCHAR"/>
        <result column="PROC_HOSPAMOUNT" property="procHospAmount" jdbcType="DECIMAL"/>
        <result column="PROC_DEFAMOUNT" property="procDefAmount" jdbcType="DECIMAL"/>
        <result column="PROC_ACTUALAMOUNT" property="procActualAmount" jdbcType="DECIMAL"/>
        <result column="GROUP" property="group" jdbcType="VARCHAR"/>
        <result column="PROC_TYPE" property="procType" jdbcType="NVARCHAR"/>
        <result column="PROC_TYPEDESC" property="procTypeDesc" jdbcType="NVARCHAR"/>
        <result column="PROC_CLASS" property="procClass" jdbcType="NVARCHAR"/>
        <result column="PROC_CLASSDESC" property="procClassDesc" jdbcType="VARCHAR"/>
        <result column="REMARKS" property="remarks" jdbcType="VARCHAR"/>
        <result column="STATUS" property="status" jdbcType="INTEGER"/>
        <result column="MACE_SUBTYPE" property="maceSubtype" jdbcType="INTEGER"/>
    </resultMap>

    <resultMap id="RequestProcedureMap" type="com.basicauth.data.MaceRequestProcedure">
        <result column="TRANSACTION_ID" property="transactionId" jdbcType="INTEGER"/>
        <result column="MACEREQUEST_ID" property="maceRequestId" jdbcType="INTEGER"/>
        <result column="REQUEST_FROM" property="requestFrom" jdbcType="VARCHAR"/>
        <result column="STATUS" property="status" jdbcType="VARCHAR"/>
        <result column="STATUS_REMARKS" property="statusRemarks" jdbcType="VARCHAR"/>
        <result column="APPROVED_ON" property="approvedOn" jdbcType="TIMESTAMP"/>
        <result column="APPROVED_BY" property="approvedBy" jdbcType="VARCHAR"/>
        <result column="APPROVAL_REMARKS" property="approvalRemarks" jdbcType="VARCHAR"/>
        <result column="DISAPPROVED_ON" property="disapprovedOn" jdbcType="TIMESTAMP"/>
        <result column="DISAPPROVED_BY" property="disapprovedBy" jdbcType="VARCHAR"/>
        <result column="DISAPPROVAL_REMARKS" property="disapprovalRemarks" jdbcType="VARCHAR"/>
        <result column="DISAPPROVAL_REASON" property="disapprovalReason" jdbcType="VARCHAR"/>
        <result column="APPROVAL_NO" property="approvalNo" jdbcType="VARCHAR"/>
        <result column="VALIDFROM" property="validFrom" jdbcType="TIMESTAMP"/>
        <result column="VALIDTO" property="validTo" jdbcType="TIMESTAMP"/>
        <result column="NOTES" property="notes" jdbcType="VARCHAR"/>
        <result column="EXPIRED_ON" property="expiredOn" jdbcType="TIMESTAMP"/>
        <result column="CONSULT_REASON" property="consultReason" jdbcType="VARCHAR"/>
        <result column="DOC_HOSP_ID" property="docHospId" jdbcType="INTEGER"/>
        <result column="DOCTOR_CODE" property="doctorCode" jdbcType="VARCHAR"/>
        <result column="HOSPITAL_CODE" property="hospitalCode" jdbcType="VARCHAR"/>
        <result column="PrimaryDiagnosisId" property="primaryDiagnosisId" jdbcType="INTEGER"/>
        <result column="PRIMARY_DIAGNOSIS_ICD10" property="primaryDiagnosisICD10" jdbcType="VARCHAR"/>
        <result column="PRIMARY_DIAGNOSIS_DESC" property="primaryDiagnosisDesc" jdbcType="VARCHAR"/>
        <result column="DX_REMARKS" property="dxRemarks" jdbcType="VARCHAR"/>
        <result column="AVAIL_HOSP_ID" property="availHospId" jdbcType="VARCHAR"/>
        <result column="PLANOFMANAGEMENT" property="planOfManagement" jdbcType="VARCHAR"/>
        <result column="TRANSAMOUNT" property="transamount" jdbcType="DECIMAL"/>
        <result column="TEST_SUBTYPE" property="testSubtype" jdbcType="SMALLINT"/>
        <result column="MACE_TESTGROUP" property="maceTestGroup" jdbcType="VARCHAR"/>
        <result column="REF_REQUESTID" property="refRequestId" jdbcType="INTEGER"/>
        <result column="REF_REFNO" property="refRefNo" jdbcType="VARCHAR"/>
    </resultMap>

    <resultMap id="MaceRequestMap" type="com.basicauth.data.MaceRequest">
        <result column="REQUEST_ID" property="requestId" jdbcType="INTEGER"/>
        <result column="SERVICETYPE_ID" property="serviceTypeId" jdbcType="VARCHAR"/>
        <result column="MEMBER_CODE" property="memCode" jdbcType="VARCHAR"/>
        <result column="MEM_LNAME" property="memLname" jdbcType="VARCHAR"/>
        <result column="MEM_FNAME" property="memFname" jdbcType="VARCHAR"/>
        <result column="REQUEST_CODE" property="requestCode" jdbcType="VARCHAR"/>
        <result column="MEM_MI" property="memMi" jdbcType="VARCHAR"/>
        <result column="MEM_COMPANY" property="memCompany" jdbcType="VARCHAR"/>
        <result column="MEM_ACCT" property="memAcct" jdbcType="VARCHAR"/>
        <result column="MEM_STAT" property="memStat" jdbcType="VARCHAR"/>
        <result column="MEM_BDATE" property="memBdate" jdbcType="TIMESTAMP"/>
        <result column="MEM_GENDER" property="memGender" jdbcType="VARCHAR"/>
        <result column="MEM_AGE" property="memAge" jdbcType="INTEGER"/>
        <result column="MEM_TYPE" property="memType" jdbcType="VARCHAR"/>
        <result column="IDREMARKS" property="idremarks" jdbcType="VARCHAR"/>
        <result column="ACCT_VALIDITY" property="acctValidity" jdbcType="TIMESTAMP"/>
        <result column="ACCT_EFFECTIVITY" property="acctEffectivity" jdbcType="TIMESTAMP"/>
        <result column="REQUEST_ORIGIN" property="requestOrigin" jdbcType="VARCHAR"/>
        <result column="REQUEST_FROMHOSP" property="requestFromhosp" jdbcType="VARCHAR"/>
        <result column="REQUEST_FROMMEM" property="requestFrommem" jdbcType="VARCHAR"/>
        <result column="REQUEST_BY" property="requestBy" jdbcType="VARCHAR"/>
        <result column="REQUEST_DEVICE" property="requestDevice" jdbcType="VARCHAR"/>
        <result column="REQUEST_DATETIME" property="requestDatetime" jdbcType="TIMESTAMP"/>
        <result column="DISCLAIMER_TICKED" property="disclaimerTicked" jdbcType="BIT"/>
        <result column="LASTUPDATE_ON" property="lastupdateOn" jdbcType="TIMESTAMP"/>
        <result column="LASTUPDATE_BY" property="lastupdateBy" jdbcType="VARCHAR"/>
        <result column="STATUS" property="status" jdbcType="VARCHAR"/>
        <result column="OVERRIDE" property="override" jdbcType="BIT"/>
        <result column="PAR_REQUEST_ID" property="parRequestId" jdbcType="INTEGER"/>
        <result column="MBAS_CODE" property="mbasCode" jdbcType="VARCHAR"/>
        <result column="MBAS_APPROVER" property="mbasApprover" jdbcType="VARCHAR"/>
        <result column="MBASUPDATE_ON" property="mbasupdateOn" jdbcType="TIMESTAMP"/>
        <result column="SERVICETYPE" property="serviceType" jdbcType="VARCHAR"/>
    </resultMap>

    <select id="getAvailedMaceRequestsByDocCodeAndMemCode" resultMap="MaceRequestMap" resultType="java.util.List">
        SELECT * FROM MACE_REQUEST WHERE MEMBER_CODE = #{memCode}
        AND STATUS != 'AVAILED'
        AND REQUEST_ID IN (SELECT MACEREQUEST_ID FROM MACEREQ_CONSULT WHERE DOCTOR_CODE = #{docCode})
    </select>

    <select id="getMaceRequestOpTestAndProcedureByDocCodeAndMemCode" resultMap="MaceRequestMap"
            resultType="java.util.List">
        SELECT * FROM MACE_REQUEST WHERE MEMBER_CODE = #{memCode}
        AND STATUS != 'AVAILED'
        AND REQUEST_ID IN (SELECT MACEREQUEST_ID FROM MACEREQ_TEST WHERE DOCTOR_CODE = #{docCode})
        UNION
        SELECT * FROM MACE_REQUEST WHERE MEMBER_CODE = #{memCode}
        AND STATUS != 'AVAILED'
        AND REQUEST_ID IN (SELECT MACEREQUEST_ID FROM MACEREQ_PROCEDURE WHERE DOCTOR_CODE = #{docCode})
    </select>


    <update id="updateMaceRequest" flushCache="true">
        UPDATE MACE_REQUEST
        SET
        SERVICETYPE_ID = #{maceRequest.serviceTypeId, jdbcType=INTEGER},
        MEMBER_CODE = #{maceRequest.memCode, jdbcType=VARCHAR},
        MEM_LNAME = #{maceRequest.memLname, jdbcType=VARCHAR},
        MEM_FNAME = #{maceRequest.memFname, jdbcType=VARCHAR},
        MEM_MI = #{maceRequest.memMi, jdbcType=VARCHAR},
        MEM_COMPANY = #{maceRequest.memCompany, jdbcType=VARCHAR},
        MEM_ACCT = #{maceRequest.memAcct, jdbcType=VARCHAR},
        MEM_STAT = #{maceRequest.memStat, jdbcType=VARCHAR},
        MEM_BDATE = #{maceRequest.memBdate, jdbcType=TIMESTAMP},
        MEM_GENDER = #{maceRequest.memGender, jdbcType=VARCHAR},
        MEM_AGE = #{maceRequest.memAge, jdbcType=INTEGER},
        MEM_TYPE = #{maceRequest.memType, jdbcType=VARCHAR},
        MEM_CONTACT = #{maceRequest.memContact , jdbcType=VARCHAR},
        IDREMARKS = #{maceRequest.idremarks, jdbcType=VARCHAR},
        ACCT_VALIDITY = #{maceRequest.acctValidity, jdbcType=TIMESTAMP},
        ACCT_EFFECTIVITY = #{maceRequest.acctEffectivity, jdbcType=TIMESTAMP},
        REQUEST_ORIGIN = #{maceRequest.requestOrigin, jdbcType=VARCHAR},
        REQUEST_FROMHOSP = #{maceRequest.requestFromhosp, jdbcType=VARCHAR},
        REQUEST_FROMMEM = #{maceRequest.requestFrommem, jdbcType=VARCHAR},
        REQUEST_BY_CODE = #{maceRequest.requestByCode, jdbcType=VARCHAR},
        REQUEST_FROM = #{maceRequest.requestFrom, jdbcType=VARCHAR},
        REQUEST_BY = #{maceRequest.requestBy, jdbcType=VARCHAR},
        REQUEST_DEVICE = #{maceRequest.requestDevice, jdbcType=VARCHAR},
        REQUEST_DATETIME = #{maceRequest.requestDatetime, jdbcType=TIMESTAMP},
        DISCLAIMER_TICKED = #{maceRequest.disclaimerTicked, jdbcType=BIT},
        LASTUPDATE_ON = #{maceRequest.lastupdateOn, jdbcType=TIMESTAMP},
        LASTUPDATE_BY = #{maceRequest.lastupdateBy, jdbcType=VARCHAR},
        STATUS = #{maceRequest.status, jdbcType=VARCHAR},
        STATUS_ASSIGNEE = #{maceRequest.statusAssignee, jdbcType=VARCHAR},
        OVERRIDE = #{maceRequest.override, jdbcType=BIT},
        PAR_REQUEST_ID = #{maceRequest.parRequestId, jdbcType=INTEGER},
        MBAS_CODE = #{maceRequest.mbasCode, jdbcType=VARCHAR},
        MBAS_APPROVER = #{maceRequest.mbasApprover, jdbcType=VARCHAR},
        MBASUPDATE_ON = #{maceRequest.mbasupdateOn, jdbcType=TIMESTAMP},
        HOSP_CONTACT = #{maceRequest.hospContact, jdbcType=VARCHAR},
        HOSP_EMAIL = #{maceRequest.hospEmail, jdbcType=VARCHAR},
        TOTAL_UTILIZATION = #{maceRequest.totalUtilization, jdbcType=VARCHAR},
        ADMISSION_TYPE = #{maceRequest.admissionType, jdbcType=VARCHAR},
        ADMISSION_DATE = #{maceRequest.admissionDate, jdbcType=TIMESTAMP},
        REASON_FOR_ADMISSION = #{maceRequest.reasonForConsult, jdbcType=VARCHAR}
        WHERE
        REQUEST_ID = #{maceRequest.requestId, jdbcType=INTEGER}
    </update>

    <select id="getRequestCodeByRequestId" resultType="java.lang.String">
        SELECT TOP 1 REQUEST_CODE FROM MACE_REQUEST WHERE REQUEST_ID = #{requestId}
    </select>

    <select id="checkProcedureAvailability" resultType="java.lang.Boolean">
        SELECT CASE WHEN EXISTS (
        SELECT
        *
        FROM
        MACE_REQUEST, MACEREQ_PROCEDURE
        WHERE
        DOCTOR_CODE = #{doctorCode, jdbcType=VARCHAR} AND
        HOSPITAL_CODE = #{hospitalCode, jdbcType=VARCHAR} AND
        PrimaryDiagnosisId = #{diagnosisId, jdbcType=INTEGER} AND
        CONVERT(TIMESTAMP, REQUEST_DATETIME) = CONVERT(TIMESTAMP, GETDATE()))
        THEN CAST(0 AS BIT)
        ELSE CAST(1 AS BIT) END
    </select>

    <update id="cancelMaceReqByRequestCode" flushCache="true">
        UPDATE MACE_REQUEST
        SET STATUS = 'CANCELLED'
        WHERE REQUEST_CODE = #{requestCode}
    </update>

    <insert id="saveMaceRequest" parameterType="com.basicauth.data.MaceRequest"
            useGeneratedKeys="true" keyProperty="maceRequest.requestId" keyColumn="REQUEST_ID" flushCache="true">
        INSERT INTO MACE_REQUEST (
        SERVICETYPE_ID,
        MEMBER_CODE,
        MEM_LNAME,
        MEM_FNAME,
        MEM_MI,
        MEM_COMPANY,
        MEM_ACCT,
        MEM_STAT,
        MEM_BDATE,
        MEM_GENDER,
        MEM_AGE,
        MEM_TYPE,
        IDREMARKS,
        ACCT_VALIDITY,
        ACCT_EFFECTIVITY,
        REQUEST_ORIGIN,
        REQUEST_FROMHOSP,
        REQUEST_FROMMEM,
        REQUEST_BY_CODE,
        REQUEST_BY,
        REQUEST_DEVICE,
        REQUEST_DATETIME,
        DISCLAIMER_TICKED,
        LASTUPDATE_ON,
        LASTUPDATE_BY,
        STATUS,
        STATUS_ASSIGNEE,
        OVERRIDE,
        PAR_REQUEST_ID,
        MBAS_CODE,
        MBAS_APPROVER,
        MBASUPDATE_ON,
        HOSP_CONTACT,
        HOSP_EMAIL,
        MEM_CONTACT,
        TOTAL_UTILIZATION,
        ADMISSION_TYPE,
        ADMISSION_DATE,
        REASON_FOR_ADMISSION,
        REQUEST_FROM)
        VALUES (
        #{maceRequest.serviceTypeId, jdbcType=INTEGER},
        #{maceRequest.memCode, jdbcType=VARCHAR},
        #{maceRequest.memLname, jdbcType=VARCHAR},
        #{maceRequest.memFname, jdbcType=VARCHAR},
        #{maceRequest.memMi, jdbcType=VARCHAR},
        #{maceRequest.memCompany, jdbcType=VARCHAR},
        #{maceRequest.memAcct, jdbcType=VARCHAR},
        #{maceRequest.memStat, jdbcType=VARCHAR},
        #{maceRequest.memBdate, jdbcType=TIMESTAMP},
        #{maceRequest.memGender, jdbcType=VARCHAR},
        #{maceRequest.memAge, jdbcType=INTEGER},
        #{maceRequest.memType, jdbcType=VARCHAR},
        #{maceRequest.idremarks, jdbcType=VARCHAR},
        #{maceRequest.acctValidity, jdbcType=TIMESTAMP},
        #{maceRequest.acctEffectivity, jdbcType=TIMESTAMP},
        #{maceRequest.requestOrigin, jdbcType=VARCHAR},
        #{maceRequest.requestFromhosp, jdbcType=VARCHAR},
        #{maceRequest.requestFrommem, jdbcType=VARCHAR},
        #{maceRequest.requestByCode, jdbcType=VARCHAR},
        #{maceRequest.requestBy, jdbcType=VARCHAR},
        #{maceRequest.requestDevice, jdbcType=VARCHAR},
        #{maceRequest.requestDatetime, jdbcType=TIMESTAMP},
        #{maceRequest.disclaimerTicked, jdbcType=BIT},
        #{maceRequest.lastupdateOn, jdbcType=TIMESTAMP},
        #{maceRequest.lastupdateBy, jdbcType=VARCHAR},
        #{maceRequest.status, jdbcType=VARCHAR},
        #{maceRequest.statusAssignee, jdbcType=VARCHAR},
        #{maceRequest.override, jdbcType=BIT},
        #{maceRequest.parRequestId, jdbcType=INTEGER},
        #{maceRequest.mbasCode, jdbcType=VARCHAR},
        #{maceRequest.mbasApprover, jdbcType=VARCHAR},
        #{maceRequest.mbasupdateOn, jdbcType=TIMESTAMP},
        #{maceRequest.hospContact, jdbcType=VARCHAR},
        #{maceRequest.hospEmail, jdbcType=VARCHAR},
        #{maceRequest.memContact, jdbcType=VARCHAR},
        #{maceRequest.totalUtilization, jdbcType=NUMERIC},
        #{maceRequest.admissionType, jdbcType=VARCHAR},
        #{maceRequest.admissionDate, jdbcType=TIMESTAMP},
        #{maceRequest.reasonForConsult, jdbcType=VARCHAR},
        #{maceRequest.requestFrom, jdbcType=VARCHAR}
        )
    </insert>

    <insert id="saveMaceRequestInpatient" parameterType="com.basicauth.data.MaceReqInpatient"
            useGeneratedKeys="true" keyProperty="mrip.transactionId" keyColumn="transaction_id" flushCache="true">
        INSERT INTO MACEREQ_INPATIENT (
        MACEREQUEST_ID,
        REQUEST_FROM,
        STATUS,
        STATUS_REMARKS,
        APPROVED_ON,
        APPROVED_BY,
        APPROVAL_REMARKS,
        DISAPPROVED_ON,
        DISAPPROVED_BY,
        DISAPPROVAL_REMARKS,
        DISAPPROVAL_REASON,
        LOA_NO,
        VALIDFROM,
        VALIDTO,
        ADMITTED_ON,
        ROOMBOARD,
        ROOM_NO,
        ROOMRATE_PERDAY,
        RECORD_SUBMITTED_ON,
        RECORD_SUBMITTED_BY,
        IP_REASON_REMARKS,
        DOC_HOSP_ID,
        DOCTOR_CODE,
        HOSPITAL_CODE,
        ESTIMATED_COST,
        PrimaryDiagnosisId,
        PRIMARY_DIAGNOSIS_ICD10,
        PRIMARY_DIAGNOSIS_DESC,
        DISEASE_TYPE,
        DX_REMARKS,
        DISCHARGED_ON,
        DISCHARGEUPDATE_BY,
        LASTUPDATE_ON,
        LASTUPDATE_BY,
        PEC_LIMIT,
        PEC_REMLIMIT,
        DD_LIMIT,
        DD_REMLIMIT,
        DISPOSITION,
        DISP_REMARKS,
        TRANS_CODE,
        TOTAL_HOSPITAL_BILL
        ) VALUES (
        #{mrip.maceRequestId, jdbcType=INTEGER},
        #{mrip.requestFrom, jdbcType=VARCHAR},
        #{mrip.status, jdbcType=VARCHAR},
        #{mrip.statusRemarks, jdbcType=VARCHAR},
        #{mrip.approvedOn, jdbcType=TIMESTAMP},
        #{mrip.approvedBy, jdbcType=VARCHAR},
        #{mrip.approvalRemarks, jdbcType=VARCHAR},
        #{mrip.disapprovedOn, jdbcType=TIMESTAMP},
        #{mrip.disapprovedBy, jdbcType=VARCHAR},
        #{mrip.disapprovalRemarks, jdbcType=VARCHAR},
        #{mrip.disapprovalReason, jdbcType=VARCHAR},
        #{mrip.loaNo, jdbcType=VARCHAR},
        #{mrip.validfrom, jdbcType=TIMESTAMP},
        #{mrip.validto, jdbcType=TIMESTAMP},
        #{mrip.admittedOn, jdbcType=TIMESTAMP},
        #{mrip.roomboard, jdbcType=VARCHAR},
        #{mrip.roomNo, jdbcType=VARCHAR},
        #{mrip.roomratePerday, jdbcType=NUMERIC},
        #{mrip.recordSubmittedOn, jdbcType=TIMESTAMP},
        #{mrip.recordSubmittedBy, jdbcType=VARCHAR},
        #{mrip.ipReasonRemarks, jdbcType=VARCHAR},
        #{mrip.docHospId, jdbcType=INTEGER},
        #{mrip.doctorCode, jdbcType=VARCHAR},
        #{mrip.hospitalCode, jdbcType=VARCHAR},
        #{mrip.estimatedCost, jdbcType=NUMERIC},
        #{mrip.primaryDiagnosisId, jdbcType=INTEGER},
        #{mrip.primaryDiagnosisIcd10, jdbcType=VARCHAR},
        #{mrip.primaryDiagnosisDesc, jdbcType=VARCHAR},
        #{mrip.diseaseType, jdbcType=VARCHAR},
        #{mrip.dxRemarks, jdbcType=VARCHAR},
        #{mrip.dischargedOn, jdbcType=TIMESTAMP},
        #{mrip.dischargeupdateBy, jdbcType=VARCHAR},
        #{mrip.lastupdateOn, jdbcType=TIMESTAMP},
        #{mrip.lastupdateBy, jdbcType=VARCHAR},
        #{mrip.pecLimit, jdbcType=VARCHAR},
        #{mrip.pecRemlimit, jdbcType=VARCHAR},
        #{mrip.ddLimit, jdbcType=VARCHAR},
        #{mrip.ddRemlimit, jdbcType=VARCHAR},
        #{mrip.disposition, jdbcType=VARCHAR},
        #{mrip.dispRemarks, jdbcType=VARCHAR},
        #{mrip.transCode, jdbcType=VARCHAR},
        #{mrip.totalHospitalBill, jdbcType=NUMERIC}
        )
    </insert>

    <update id="updateMaceRequestInpatientPortal" flushCache="true">
        UPDATE [MACEREQ_INPATIENT]
        SET [REQUEST_FROM] = #{mrip.requestFrom, jdbcType=VARCHAR}
        ,[STATUS] = #{mrip.status, jdbcType=VARCHAR}
        ,[APPROVED_ON] = #{mrip.approvedOn, jdbcType=TIMESTAMP}
        ,[APPROVED_BY] = #{mrip.approvedBy, jdbcType=VARCHAR}
        ,[APPROVAL_REMARKS] = #{mrip.approvalRemarks, jdbcType=VARCHAR}
        ,[LOA_NO] = #{mrip.loaNo, jdbcType=VARCHAR}
        ,[ADMITTED_ON] = #{mrip.admittedOn, jdbcType=TIMESTAMP}
        ,[RECORD_SUBMITTED_ON] = #{mrip.recordSubmittedOn, jdbcType=TIMESTAMP}
        ,[RECORD_SUBMITTED_BY] = #{mrip.recordSubmittedBy, jdbcType=VARCHAR}
        ,[IP_REASON_REMARKS] = #{mrip.ipReasonRemarks, jdbcType=VARCHAR}
        ,[DOC_HOSP_ID] = #{mrip.docHospId, jdbcType=INTEGER}
        ,[DOCTOR_CODE] = #{mrip.doctorCode, jdbcType=VARCHAR}
        ,[HOSPITAL_CODE] = #{mrip.hospitalCode, jdbcType=VARCHAR}
        ,[PrimaryDiagnosisId] = #{mrip.primaryDiagnosisId, jdbcType=INTEGER}
        ,[PRIMARY_DIAGNOSIS_ICD10] = #{mrip.primaryDiagnosisIcd10, jdbcType=VARCHAR}
        ,[PRIMARY_DIAGNOSIS_DESC] = #{mrip.primaryDiagnosisDesc, jdbcType=VARCHAR}
        ,[DISEASE_TYPE] = #{mrip.diseaseType, jdbcType=VARCHAR}
        ,[DX_REMARKS] = #{mrip.dxRemarks, jdbcType=VARCHAR}
        ,[DISCHARGED_ON] = #{mrip.dischargedOn, jdbcType=TIMESTAMP}
        ,[DISCHARGEUPDATE_BY] = #{mrip.dischargeupdateBy, jdbcType=VARCHAR}
        ,[LASTUPDATE_ON] = #{mrip.lastupdateOn, jdbcType=TIMESTAMP}
        ,[LASTUPDATE_BY] = #{mrip.lastupdateBy, jdbcType=VARCHAR}
        ,[DISPOSITION] = #{mrip.disposition, jdbcType=VARCHAR}
        ,[TRANS_CODE] = #{mrip.transCode, jdbcType=VARCHAR}
        ,[TOTAL_HOSPITAL_BILL] = #{mrip.totalHospitalBill, jdbcType=NUMERIC}
        WHERE MACEREQUEST_ID = #{mrip.maceRequestId, jdbcType=INTEGER}
    </update>

    <select id="getMaceRequestProcedureByMaceRequestId" resultMap="RequestProcedureMap">
        SELECT TOP 1 * FROM MACE_REQUEST WHERE REQUEST_ID=#{requestId, jdbcType=INTEGER}
    </select>

    <select id="checkIfMemberExistsByMemberCode" resultType="java.lang.Boolean">
        SELECT CASE WHEN EXISTS (
        SELECT TOP 1 * FROM MEM_ACCTS WHERE MEM_CODE=#{memberCode}
        )
        THEN CAST(1 AS BIT)
        ELSE CAST(0 AS BIT) END
    </select>

    <insert id="saveMaceReqProcedure" parameterType="com.basicauth.data.MaceRequestProcedure"
            useGeneratedKeys="true" keyProperty="maceRequestProcedure.transactionId" keyColumn="TRANSACTION_ID"
            flushCache="true">
        INSERT INTO MACEREQ_PROCEDURE (
        TRANS_CODE,
        MACEREQUEST_ID,
        REQUEST_FROM,
        STATUS,
        STATUS_REMARKS,
        APPROVED_ON,
        APPROVED_BY,
        APPROVAL_REMARKS,
        DISAPPROVED_ON,
        DISAPPROVED_BY,
        DISAPPROVAL_REMARKS,
        DISAPPROVAL_REASON,
        APPROVAL_NO,
        VALIDFROM,
        VALIDTO,
        NOTES,
        EXPIRED_ON,
        CONSULT_REASON,
        DOC_HOSP_ID,
        DOCTOR_CODE,
        HOSPITAL_CODE,
        PrimaryDiagnosisId,
        PRIMARY_DIAGNOSIS_ICD10,
        PRIMARY_DIAGNOSIS_DESC,
        DX_REMARKS,
        AVAIL_HOSP_ID,
        PLANOFMANAGEMENT,
        TRANSAMOUNT,
        TEST_SUBTYPE,
        MACE_TESTGROUP,
        REF_REQUESTID,
        REF_REFNO) VALUES (
        #{maceRequestProcedure.transCode, jdbcType=VARCHAR},
        #{maceRequest.requestId, jdbcType=INTEGER},
        #{maceRequestProcedure.requestFrom, jdbcType=VARCHAR},
        #{maceRequestProcedure.status, jdbcType=VARCHAR},
        #{maceRequestProcedure.statusRemarks, jdbcType=VARCHAR},
        #{maceRequestProcedure.approvedOn, jdbcType=TIMESTAMP},
        #{maceRequestProcedure.approvedBy, jdbcType=VARCHAR},
        #{maceRequestProcedure.approvalRemarks, jdbcType=VARCHAR},
        #{maceRequestProcedure.disapprovedOn, jdbcType=TIMESTAMP},
        #{maceRequestProcedure.disapprovedBy, jdbcType=VARCHAR},
        #{maceRequestProcedure.disapprovalRemarks, jdbcType=VARCHAR},
        #{maceRequestProcedure.disapprovalReason, jdbcType=VARCHAR},
        #{maceRequestProcedure.approvalNo, jdbcType=VARCHAR},
        #{maceRequestProcedure.validFrom, jdbcType=TIMESTAMP},
        #{maceRequestProcedure.validTo, jdbcType=TIMESTAMP},
        #{maceRequestProcedure.notes, jdbcType=VARCHAR},
        #{maceRequestProcedure.expiredOn, jdbcType=TIMESTAMP},
        #{maceRequestProcedure.consultReason, jdbcType=VARCHAR},
        #{maceRequestProcedure.docHospId, jdbcType=INTEGER},
        #{maceRequestProcedure.doctorCode, jdbcType=VARCHAR},
        #{maceRequestProcedure.hospitalCode, jdbcType=VARCHAR},
        #{maceRequestProcedure.primaryDiagnosisId, jdbcType=INTEGER},
        #{maceRequestProcedure.primaryDiagnosisICD10, jdbcType=VARCHAR},
        #{maceRequestProcedure.primaryDiagnosisDesc, jdbcType=VARCHAR},
        #{maceRequestProcedure.dxRemarks, jdbcType=VARCHAR},
        #{maceRequestProcedure.availHospId, jdbcType=VARCHAR},
        #{maceRequestProcedure.planOfManagement, jdbcType=VARCHAR},
        #{maceRequestProcedure.transamount, jdbcType=DECIMAL},
        #{maceRequestProcedure.testSubtype, jdbcType=SMALLINT},
        #{maceRequestProcedure.maceTestGroup, jdbcType=VARCHAR},
        #{maceRequestProcedure.refRequestId, jdbcType=INTEGER},
        #{maceRequestProcedure.refRefNo, jdbcType=VARCHAR}
        )
    </insert>

    <insert id="saveMaceReqOpProcedure" parameterType="com.basicauth.data.MaceRequestOpProcedure" flushCache="true"
            useGeneratedKeys="true" keyProperty="maceRequestOpProcedure.diagProcId" keyColumn="DIAGPROC_ID">
        INSERT INTO MACE_REQ_OP_PROCEDURE (
        REQDIAG_ID,
        MACEREQUEST_ID,
        PRESCRIBEDTEST_ID,
        TRANSACTION_ID,
        REF_DIAGPROC_ID,
        DiagnosisId,
        ProcedureId,
        PROC_DESC,
        RUV,
        [SESSION],
        AREA,
        PROC_HOSPAMOUNT,
        PROC_DEFAMOUNT,
        PROC_ACTUALAMOUNT,
        "GROUP",
        PROC_TYPE,
        PROC_TYPEDESC,
        PROC_CLASS,
        PROC_CLASSDESC,
        REMARKS,
        STATUS,
        MACE_SUBTYPE,
        TRANS_CODE) VALUES (
        #{maceRequestOpProcedure.reqDiagId, jdbcType=INTEGER},
        #{maceRequest.requestId, jdbcType=INTEGER},
        #{maceRequestOpProcedure.prescribedTestId, jdbcType=INTEGER},
        #{maceRequestOpProcedure.transactionId, jdbcType=VARCHAR},
        #{maceRequestOpProcedure.refDiagProcId, jdbcType=VARCHAR},
        #{maceRequestOpProcedure.diagnosisId, jdbcType=INTEGER},
        #{maceRequestOpProcedure.procedureId, jdbcType=INTEGER},
        #{maceRequestOpProcedure.procDesc, jdbcType=VARCHAR},
        #{maceRequestOpProcedure.ruv, jdbcType=VARCHAR},
        #{maceRequestOpProcedure.session, jdbcType=VARCHAR},
        #{maceRequestOpProcedure.area, jdbcType=VARCHAR},
        #{maceRequestOpProcedure.procHospAmount, jdbcType=DECIMAL},
        #{maceRequestOpProcedure.procDefAmount, jdbcType=DECIMAL},
        #{maceRequestOpProcedure.procActualAmount, jdbcType=DECIMAL},
        #{maceRequestOpProcedure.group, jdbcType=VARCHAR},
        #{maceRequestOpProcedure.procType, jdbcType=VARCHAR},
        #{maceRequestOpProcedure.procTypeDesc, jdbcType=VARCHAR},
        #{maceRequestOpProcedure.procClass, jdbcType=VARCHAR},
        #{maceRequestOpProcedure.procClassDesc, jdbcType=VARCHAR},
        #{maceRequestOpProcedure.remarks, jdbcType=VARCHAR},
        #{maceRequestOpProcedure.status, jdbcType=VARCHAR},
        #{maceRequestOpProcedure.maceSubtype, jdbcType=VARCHAR},
        #{maceRequestOpProcedure.transCode, jdbcType=VARCHAR}
        )
    </insert>

    <insert id="saveMaceReqOpDiag" parameterType="com.basicauth.data.MaceRequestOpDiag" flushCache="true"
            useGeneratedKeys="true" keyProperty="maceRequestOpDiag.reqDiagId" keyColumn="REQDIAG_ID">
        INSERT INTO [dbo].[MACE_REQ_OP_DIAG]
        ([MACEREQUEST_ID]
        ,[TRANSACTION_ID]
        ,DiagnosisId
        ,[ICD10_CODE]
        ,[ICD10_CLASS]
        ,[ICD10_4C]
        ,[DIAG_DESC]
        ,[DIAG_TYPE_OLD]
        ,[DIAG_TYPE]
        ,[DIAG_CASETYPE]
        ,[TYPE_DESC]
        ,[GROUP_DESC]
        ,[DIAG_CLASS]
        ,[DIAG_REMARKS]
        ,[TO_RULE_OUT]
        ,[TO_CONSIDER]
        ,[VERSUS]
        ,[MACE_DIAG_TYPE]
        ,[TRANS_CODE]
        ,[DISEASE_LIMIT]
        ,[REM_LIMIT]
        ,[IS_PRIMARY]
        ,[IS_ADMITTING]
        ,[IS_FINAL]
        ,[DISEASE_LIMIT_TYPE])
        VALUES
        (#{maceRequest.requestId, jdbcType=INTEGER}
        ,#{maceRequestOpDiag.transactionId, jdbcType=INTEGER}
        ,#{maceRequestOpDiag.diagnosisId, jdbcType=INTEGER}
        ,#{maceRequestOpDiag.icd10Code, jdbcType=VARCHAR}
        ,#{maceRequestOpDiag.icd10Class, jdbcType=VARCHAR}
        ,#{maceRequestOpDiag.icd104C, jdbcType=VARCHAR}
        ,#{maceRequestOpDiag.diagDesc, jdbcType=VARCHAR}
        ,#{maceRequestOpDiag.diagTypeOld, jdbcType=VARCHAR}
        ,#{maceRequestOpDiag.diagType, jdbcType=VARCHAR}
        ,#{maceRequestOpDiag.diagCaseType, jdbcType=VARCHAR}
        ,#{maceRequestOpDiag.typeDesc, jdbcType=VARCHAR}
        ,#{maceRequestOpDiag.groupDesc, jdbcType=VARCHAR}
        ,#{maceRequestOpDiag.diagClass, jdbcType=VARCHAR}
        ,#{maceRequestOpDiag.diagRemarks, jdbcType=VARCHAR}
        ,#{maceRequestOpDiag.toRuleOut, jdbcType=VARCHAR}
        ,#{maceRequestOpDiag.toConsider, jdbcType=VARCHAR}
        ,#{maceRequestOpDiag.versus, jdbcType=VARCHAR}
        ,#{maceRequestOpDiag.maceDiagType, jdbcType=VARCHAR}
        ,#{maceRequestOpDiag.transCode, jdbcType=VARCHAR}
        ,#{maceRequestOpDiag.diseaseLimit, jdbcType=DECIMAL}
        ,#{maceRequestOpDiag.remLimit, jdbcType=DECIMAL}
        ,#{maceRequestOpDiag.isPrimary, jdbcType=BIT}
        ,#{maceRequestOpDiag.isAdmitting, jdbcType=BIT}
        ,#{maceRequestOpDiag.isFinal, jdbcType=BIT}
        ,#{maceRequestOpDiag.diseaseLimitType, jdbcType=VARCHAR})
    </insert>

    <insert id="saveMaceRequestOpDiag" parameterType="com.basicauth.data.MaceRequestOpDiag" flushCache="true"
            useGeneratedKeys="true" keyProperty="maceRequestOpDiag.reqDiagId" keyColumn="REQDIAG_ID">
        INSERT INTO [dbo].[MACE_REQ_OP_DIAG]
        ([MACEREQUEST_ID]
        ,[TRANSACTION_ID]
        ,DiagnosisId
        ,[ICD10_CODE]
        ,[ICD10_CLASS]
        ,[ICD10_4C]
        ,[DIAG_DESC]
        ,[DIAG_TYPE_OLD]
        ,[DIAG_TYPE]
        ,[DIAG_CASETYPE]
        ,[TYPE_DESC]
        ,[GROUP_DESC]
        ,[DIAG_CLASS]
        ,[DIAG_REMARKS]
        ,[TO_RULE_OUT]
        ,[TO_CONSIDER]
        ,[VERSUS]
        ,[MACE_DIAG_TYPE]
        ,[TRANS_CODE]
        ,[DISEASE_LIMIT]
        ,[REM_LIMIT]
        ,[IS_PRIMARY]
        ,[IS_ADMITTING]
        ,[IS_FINAL]
        ,[DISEASE_LIMIT_TYPE])
        VALUES
        (#{maceRequestOpDiag.maceRequestId, jdbcType=INTEGER}
        ,#{maceRequestOpDiag.transactionId, jdbcType=INTEGER}
        ,#{maceRequestOpDiag.diagnosisId, jdbcType=INTEGER}
        ,#{maceRequestOpDiag.icd10Code, jdbcType=VARCHAR}
        ,#{maceRequestOpDiag.icd10Class, jdbcType=VARCHAR}
        ,#{maceRequestOpDiag.icd104C, jdbcType=VARCHAR}
        ,#{maceRequestOpDiag.diagDesc, jdbcType=VARCHAR}
        ,#{maceRequestOpDiag.diagTypeOld, jdbcType=VARCHAR}
        ,#{maceRequestOpDiag.diagType, jdbcType=VARCHAR}
        ,#{maceRequestOpDiag.diagCaseType, jdbcType=VARCHAR}
        ,#{maceRequestOpDiag.typeDesc, jdbcType=VARCHAR}
        ,#{maceRequestOpDiag.groupDesc, jdbcType=VARCHAR}
        ,#{maceRequestOpDiag.diagClass, jdbcType=VARCHAR}
        ,#{maceRequestOpDiag.diagRemarks, jdbcType=VARCHAR}
        ,#{maceRequestOpDiag.toRuleOut, jdbcType=VARCHAR}
        ,#{maceRequestOpDiag.toConsider, jdbcType=VARCHAR}
        ,#{maceRequestOpDiag.versus, jdbcType=VARCHAR}
        ,#{maceRequestOpDiag.maceDiagType, jdbcType=VARCHAR}
        ,#{maceRequestOpDiag.transCode, jdbcType=VARCHAR}
        ,#{maceRequestOpDiag.diseaseLimit, jdbcType=DECIMAL}
        ,#{maceRequestOpDiag.remLimit, jdbcType=DECIMAL}
        ,#{maceRequestOpDiag.isPrimary, jdbcType=BIT}
        ,#{maceRequestOpDiag.isAdmitting, jdbcType=BIT}
        ,#{maceRequestOpDiag.isFinal, jdbcType=BIT}
        ,#{maceRequestOpDiag.diseaseLimitType, jdbcType=VARCHAR})
    </insert>

    <insert id="saveMaceReqOpTest" parameterType="com.basicauth.data.MaceRequestOpTest" flushCache="true"
            useGeneratedKeys="true" keyProperty="maceRequestOpTest.diagTestId" keyColumn="DIAGTEST_ID">
        INSERT INTO [dbo].[MACE_REQ_OP_TESTS] (
            [REQDIAG_ID],
            [MACEREQUEST_ID],
            [PRESCRIBEDTEST_ID],
            [TRANSACTION_ID],
            [REF_DIAGPROC_ID],
            DiagnosisId,
            [ProcedureId],
            [PROC_DESC],
            [RUV],
            [SESSION],
            [AREA],
            [PROC_HOSPAMOUNT],
            [PROC_DEFAMOUNT],
            [PROC_ACTUALAMOUNT],
            [GROUP],
            [PROC_TYPE],
            [PROC_TYPEDESC],
            [PROC_CLASS],
            [PROC_CLASSDESC],
            [REMARKS],
            [STATUS],
            [MACE_SUBTYPE],
            [TRANS_CODE],
            [TOOTH],
            [SURFACE_NO]
        ) VALUES (
            #{maceRequestOpTest.reqDiagId, jdbcType=INTEGER},
            #{maceRequestOpTest.maceRequestId, jdbcType=INTEGER},
            #{maceRequestOpTest.prescribedTestId, jdbcType=INTEGER},
            #{maceRequestOpTest.transactionId, jdbcType=INTEGER},
            #{maceRequestOpTest.refDiagProcId, jdbcType=INTEGER},
            #{maceRequestOpTest.diagnosisId, jdbcType=INTEGER},
            #{maceRequestOpTest.procedureId, jdbcType=INTEGER},
            #{maceRequestOpTest.procDesc, jdbcType=VARCHAR},
            #{maceRequestOpTest.ruv, jdbcType=VARCHAR},
            #{maceRequestOpTest.session, jdbcType=VARCHAR},
            #{maceRequestOpTest.area, jdbcType=VARCHAR},
            #{maceRequestOpTest.procHospAmount, jdbcType=DECIMAL},
            #{maceRequestOpTest.procDefAmount, jdbcType=DECIMAL},
            #{maceRequestOpTest.procActualAmount, jdbcType=DECIMAL},
            #{maceRequestOpTest.group, jdbcType=VARCHAR},
            #{maceRequestOpTest.procType, jdbcType=VARCHAR},
            #{maceRequestOpTest.procTypeDesc, jdbcType=VARCHAR},
            #{maceRequestOpTest.procClass, jdbcType=VARCHAR},
            #{maceRequestOpTest.procClassDesc, jdbcType=VARCHAR},
            #{maceRequestOpTest.remarks, jdbcType=VARCHAR},
            #{maceRequestOpTest.status, jdbcType=INTEGER},
            #{maceRequestOpTest.maceSubtype, jdbcType=INTEGER},
            #{maceRequestOpTest.transCode, jdbcType=VARCHAR},
            #{maceRequestOpTest.tooth, jdbcType=INTEGER},
            #{maceRequestOpTest.surfaceNo, jdbcType=INTEGER}
        )
    </insert>

    <insert id="saveMaceReqTest" parameterType="com.basicauth.data.MaceRequestTest" flushCache="true"
            useGeneratedKeys="true" keyProperty="maceRequestTest.transactionId" keyColumn="TRANSACTION_ID">
        INSERT INTO MACEREQ_TEST (
        TRANS_CODE,
        MACEREQUEST_ID,
        REQUEST_FROM,
        STATUS,
        STATUS_REMARKS,
        APPROVED_ON,
        APPROVED_BY,
        APPROVAL_REMARKS,
        DISAPPROVED_ON,
        DISAPPROVED_BY,
        DISAPPROVAL_REMARKS,
        DISAPPROVAL_REASON,
        APPROVAL_NO,
        VALIDFROM,
        VALIDTO,
        NOTES,
        EXPIRED_ON,
        CONSULT_REASON,
        DOC_HOSP_ID,
        DOCTOR_CODE,
        HOSPITAL_CODE,
        PrimaryDiagnosisId,
        PRIMARY_DIAGNOSIS_ICD10,
        PRIMARY_DIAGNOSIS_DESC,
        DX_REMARKS,
        AVAIL_HOSP_ID,
        PLANOFMANAGEMENT,
        TRANSAMOUNT,
        TEST_SUBTYPE,
        MACE_TESTGROUP,
        REF_REQUESTID,
        REF_REFNO
        ) VALUES (
        #{maceRequestTest.transCode, jdbcType=VARCHAR},
        #{maceRequestTest.maceRequestId, jdbcType=INTEGER},
        #{maceRequestTest.requestFrom, jdbcType=VARCHAR},
        #{maceRequestTest.status, jdbcType=VARCHAR},
        #{maceRequestTest.statusRemarks, jdbcType=VARCHAR},
        #{maceRequestTest.approvedOn, jdbcType=TIMESTAMP},
        #{maceRequestTest.approvedBy, jdbcType=VARCHAR},
        #{maceRequestTest.approvalRemarks, jdbcType=VARCHAR},
        #{maceRequestTest.disapprovedOn, jdbcType=TIMESTAMP},
        #{maceRequestTest.disapprovedBy, jdbcType=VARCHAR},
        #{maceRequestTest.disapprovalRemarks, jdbcType=VARCHAR},
        #{maceRequestTest.disapprovalReason, jdbcType=VARCHAR},
        #{maceRequestTest.approvalNo, jdbcType=VARCHAR},
        #{maceRequestTest.validFrom, jdbcType=TIMESTAMP},
        #{maceRequestTest.validTo, jdbcType=TIMESTAMP},
        #{maceRequestTest.notes, jdbcType=VARCHAR},
        #{maceRequestTest.expiredOn, jdbcType=TIMESTAMP},
        #{maceRequestTest.consultReason, jdbcType=VARCHAR},
        #{maceRequestTest.docHospId, jdbcType=INTEGER},
        #{maceRequestTest.doctorCode, jdbcType=VARCHAR},
        #{maceRequestTest.hospitalCode, jdbcType=VARCHAR},
        #{maceRequestTest.primaryDiagnosisId, jdbcType=INTEGER},
        #{maceRequestTest.primaryDiagnosisICD10, jdbcType=VARCHAR},
        #{maceRequestTest.primaryDiagnosisDesc, jdbcType=VARCHAR},
        #{maceRequestTest.dxRemarks, jdbcType=VARCHAR},
        #{maceRequestTest.availHospId, jdbcType=VARCHAR},
        #{maceRequestTest.planOfManagement, jdbcType=VARCHAR},
        #{maceRequestTest.transamount, jdbcType=DECIMAL},
        #{maceRequestTest.testSubtype, jdbcType=SMALLINT},
        #{maceRequestTest.maceTestGroup, jdbcType=VARCHAR},
        #{maceRequestTest.refRequestId, jdbcType=INTEGER},
        #{maceRequestTest.refRefNo, jdbcType=VARCHAR}
        )
    </insert>

    <insert id="saveMaceReqOpDoctor" parameterType="com.basicauth.data.MaceRequestOpDoctor" flushCache="true"
            useGeneratedKeys="true" keyProperty="maceRequestOpDoctor.opReqdocId" keyColumn="OP_REQDOC_ID">
        INSERT INTO MACE_REQ_OP_DOCTOR(
	    MACEREQUEST_ID,
	    DOC_HOSP_ID,
	    DOCTOR_CODE,
	    DOC_LNAME,
	    DOC_FNAME,
	    DOC_MNAME,
	    SPECIALIZATION,
	    ISACCREDITED,
	    HOSPITAL_CODE,
	    HOSP_PROF_FEE,
	    DEF_PROF_FEE,
	    ACTUAL_PROF_FEE,
	    MACE_DOCTYPE,
	    ProcedureId,
	    PROC_DESC,
	    ADDED_ON,
	    ADDED_BY,
	    FULL_NAME,
	    REMARKS
        ) VALUES (
	    #{maceRequestOpDoctor.maceRequestId, jdbcType=INTEGER},
	    #{maceRequestOpDoctor.docHospId, jdbcType=INTEGER},
	    #{maceRequestOpDoctor.doctorCode, jdbcType=VARCHAR},
	    #{maceRequestOpDoctor.docLname, jdbcType=VARCHAR},
	    #{maceRequestOpDoctor.docFname, jdbcType=VARCHAR},
	    #{maceRequestOpDoctor.docMname, jdbcType=VARCHAR},
	    #{maceRequestOpDoctor.specialization, jdbcType=VARCHAR},
	    #{maceRequestOpDoctor.isAccredited, jdbcType=BIT},
	    #{maceRequestOpDoctor.hospitalCode, jdbcType=VARCHAR},
	    #{maceRequestOpDoctor.hospProfFee, jdbcType=DECIMAL},
	    #{maceRequestOpDoctor.defProfFee, jdbcType=DECIMAL},
	    #{maceRequestOpDoctor.actualProfFee, jdbcType=DECIMAL},
	    #{maceRequestOpDoctor.maceDoctype, jdbcType=VARCHAR},
	    #{maceRequestOpDoctor.procedureId, jdbcType=INTEGER},
	    #{maceRequestOpDoctor.procDesc, jdbcType=VARCHAR},
	    #{maceRequestOpDoctor.addedOn, jdbcType=TIMESTAMP},
	    #{maceRequestOpDoctor.addedBy, jdbcType=VARCHAR},
	    #{maceRequestOpDoctor.fullName, jdbcType=VARCHAR},
	    #{maceRequestOpDoctor.remarks, jdbcType=VARCHAR}
	    )
    </insert>

    <insert id="saveMaceReqOpOtherCharge" parameterType="com.basicauth.data.MaceRequestOpOtherCharge"
            flushCache="true"
            useGeneratedKeys="true" keyProperty="maceRequestOpOtherCharge.opOtherChargeId"
            keyColumn="OP_OTHERCHARGE_ID">
        INSERT INTO MACE_REQ_OP_OTHERCHARGES(
        MACEREQUEST_ID,
        CHARGE_TYPE,
        DiagnosisId,
        DIAG_DESC,
        DETAILS,
        CHARGE_AMOUNT
        ) VALUES (
        #{maceRequestOpOtherCharge.maceRequestId, jdbcType=INTEGER},
        #{maceRequestOpOtherCharge.chargeType, jdbcType=VARCHAR},
        #{maceRequestOpOtherCharge.diagnosisId, jdbcType=INTEGER},
        #{maceRequestOpOtherCharge.diagDesc, jdbcType=VARCHAR},
        #{maceRequestOpOtherCharge.details, jdbcType=VARCHAR},
        #{maceRequestOpOtherCharge.chargeAmount, jdbcType=DECIMAL}
        )
    </insert>

    <insert id="saveMaceReqOpOtherInformation" parameterType="com.basicauth.data.MaceRequestOpOtherInformation"
            flushCache="true"
            useGeneratedKeys="true" keyProperty="maceRequestOpOtherInformation.opOtherInformationId"
            keyColumn="OP_OTHERINFORMATION_ID">
        INSERT INTO MACE_REQ_OP_OTHERINFORMATION(
        MACEREQUEST_ID,
        INFORMATION_TYPE,
        DETAILS
        ) VALUES (
        #{maceRequestOpOtherInformation.maceRequestId, jdbcType=INTEGER},
        #{maceRequestOpOtherInformation.informationType, jdbcType=VARCHAR},
        #{maceRequestOpOtherInformation.details, jdbcType=VARCHAR}
        )
    </insert>

    <resultMap id="maceRequestAuditMap" type="com.basicauth.data.MaceRequestAudit">
        <result column="LOGID" property="logId" jdbcType="INTEGER"/>
        <result column="LOGDATETIME" property="logId" jdbcType="INTEGER"/>
        <result column="HOSTNAME" property="logId" jdbcType="INTEGER"/>
        <result column="USERID" property="logId" jdbcType="INTEGER"/>
        <result column="DEVICEID" property="logId" jdbcType="INTEGER"/>
        <result column="USER_TYPE" property="logId" jdbcType="INTEGER"/>
        <result column="FACILITY" property="logId" jdbcType="INTEGER"/>
        <result column="FUNCTION_NAME" property="logId" jdbcType="INTEGER"/>
        <result column="DETAIL" property="logId" jdbcType="INTEGER"/>
        <result column="TRANSTYPE" property="logId" jdbcType="INTEGER"/>
        <result column="MEMBERID" property="logId" jdbcType="INTEGER"/>
        <result column="REQUESTID" property="logId" jdbcType="INTEGER"/>
        <result column="OLD_VALUE" property="logId" jdbcType="INTEGER"/>
        <result column="NEW_VALUE" property="logId" jdbcType="INTEGER"/>
    </resultMap>

    <insert id="saveMaceRequestIpRoom" parameterType="com.basicauth.domain.MaceReqIpRoom" flushCache="true"
            useGeneratedKeys="true" keyProperty="mrir.ipRoomId" keyColumn="IP_ROOM_ID">
        INSERT INTO MACE_REQ_IP_ROOM (
        MACEREQUEST_ID,
        TRANSACTION_ID,
        HOSPITAL_CODE,
        ROOM_NO,
        ROOMPLAN,
        ROOMTYPE,
        RATE,
        DATE_FROM,
        DATE_TO,
        IS_ROOM_SHARING,
        ROOM_SHARING_TYPE,
        ROOM_SHARING_REMARKS,
        IS_ROOM_WAIVING,
        ADDED_ON,
        ADDED_BY,
        LAST_UPDATE_ON,
        LAST_UPDATE_BY,
        TRANS_CODE
        ) VALUES (
        #{mrir.maceRequestId, jdbcType=INTEGER},
        #{mrir.transactionId, jdbcType=INTEGER},
        #{mrir.hospitalCode, jdbcType=VARCHAR},
        #{mrir.roomNo, jdbcType=VARCHAR},
        #{mrir.roomplan, jdbcType=VARCHAR},
        #{mrir.roomtype, jdbcType=VARCHAR},
        #{mrir.rate, jdbcType=VARCHAR},
        #{mrir.dateFrom, jdbcType=TIMESTAMP},
        #{mrir.dateTo, jdbcType=TIMESTAMP},
        #{mrir.isRoomSharing, jdbcType=BIT},
        #{mrir.roomSharingType, jdbcType=VARCHAR},
        #{mrir.roomSharingRemarks, jdbcType=VARCHAR},
        #{mrir.isRoomWaiving, jdbcType=BIT},
        #{mrir.addedOn, jdbcType=TIMESTAMP},
        #{mrir.addedBy, jdbcType=VARCHAR},
        #{mrir.lastUpdateOn, jdbcType=TIMESTAMP},
        #{mrir.lastUpdateBy, jdbcType=VARCHAR},
        #{mrir.transCode, jdbcType=VARCHAR}
        )
    </insert>

    <update id="updateMaceRequestIpRoom" flushCache="true">
        UPDATE MACE_REQ_IP_ROOM
        SET
        HOSPITAL_CODE = #{mrir.hospitalCode, jdbcType=VARCHAR},
        ROOMPLAN = #{mrir.roomplan, jdbcType=VARCHAR},
        ROOM_NO = #{mrir.roomNo, jdbcType=VARCHAR},
        ROOMTYPE = #{mrir.roomtype, jdbcType=VARCHAR},
        RATE = #{mrir.rate, jdbcType=VARCHAR},
        DATE_FROM = #{mrir.dateFrom, jdbcType=TIMESTAMP},
        DATE_TO = #{mrir.dateTo, jdbcType=TIMESTAMP},
        IS_ROOM_SHARING = #{mrir.isRoomSharing, jdbcType=BIT},
        ROOM_SHARING_TYPE = #{mrir.roomSharingType, jdbcType=VARCHAR},
        ROOM_SHARING_REMARKS = #{mrir.roomSharingRemarks, jdbcType=VARCHAR},
        IS_ROOM_WAIVING = #{mrir.isRoomWaiving, jdbcType=BIT},
        ADDED_ON = #{mrir.addedOn, jdbcType=TIMESTAMP},
        ADDED_BY = #{mrir.addedBy, jdbcType=VARCHAR},
        LAST_UPDATE_ON = #{mrir.lastUpdateOn, jdbcType=TIMESTAMP},
        LAST_UPDATE_BY = #{mrir.lastUpdateBy, jdbcType=VARCHAR},
        TRANS_CODE = #{mrir.transCode, jdbcType=VARCHAR}
        where IP_ROOM_ID = #{mrir.ipRoomId, jdbcType=INTEGER}
    </update>

    <insert id="saveMaceRequestAuditLog" flushCache="true">
        INSERT INTO [dbo].[MACE_REQ_AUDIT]
        ([LOGDATETIME]
        ,[HOSTNAME]
        ,[USERID]
        ,[DEVICEID]
        ,[USER_TYPE]
        ,[FACILITY]
        ,[FUNCTION_NAME]
        ,[DETAIL]
        ,[TRANSTYPE]
        ,[MEMBERID]
        ,[REQUESTID]
        ,[OLD_VALUE]
        ,[NEW_VALUE])
        VALUES
        (#{maceRequestAudit.logDateTime, jdbcType=TIMESTAMP}
        ,#{maceRequestAudit.hostname, jdbcType=VARCHAR}
        ,#{maceRequestAudit.userId, jdbcType=VARCHAR}
        ,#{maceRequestAudit.deviceId, jdbcType=VARCHAR}
        ,#{maceRequestAudit.userType, jdbcType=VARCHAR}
        ,#{maceRequestAudit.facility, jdbcType=VARCHAR}
        ,#{maceRequestAudit.functionName, jdbcType=VARCHAR}
        ,#{maceRequestAudit.detail, jdbcType=VARCHAR}
        ,#{maceRequestAudit.transtype, jdbcType=VARCHAR}
        ,#{maceRequestAudit.memberId, jdbcType=VARCHAR}
        ,#{maceRequest.requestId, jdbcType=VARCHAR}
        ,#{maceRequestAudit.oldValue, jdbcType=VARCHAR}
        ,#{maceRequestAudit.newValue, jdbcType=VARCHAR})
    </insert>

    <insert id="saveMaceReqIpOtherService" parameterType="com.basicauth.domain.MaceReqIpOtherservices" flushCache="true"
            useGeneratedKeys="true" keyProperty="mrios.otherserviceId" keyColumn="otherservice_id">
        INSERT INTO MACE_REQ_IP_OTHERSERVICES (
        [MACEREQUEST_ID],
        [TRANSACTION_ID],
        [SERVICE_HOSPAMOUNT],
        [SERVICE_DEFAMOUNT],
        [SERVICE_ACTUALAMOUNT],
        [SERVICE_TYPE],
        [REMARKS],
        [STATUS]
        ) VALUES (
        #{mrios.maceRequestId, jdbcType=INTEGER},
        #{mrios.transactionId, jdbcType=INTEGER},
        #{mrios.serviceHospamount, jdbcType=NUMERIC},
        #{mrios.serviceDefamount, jdbcType=NUMERIC},
        #{mrios.serviceActualamount, jdbcType=NUMERIC},
        #{mrios.serviceType, jdbcType=VARCHAR},
        #{mrios.remarks, jdbcType=VARCHAR},
        #{mrios.status, jdbcType=INTEGER}
        )
    </insert>

    <insert id="saveMaceReqIpDoctor" parameterType="com.basicauth.domain.MaceReqIpDoctor" flushCache="true"
            useGeneratedKeys="true" keyProperty="mrid.ipReqdocId" keyColumn="IP_REQDOC_ID">
        INSERT INTO MACE_REQ_IP_DOCTOR
        (
        MACEREQUEST_ID,
        TRANSACTION_ID,
        DOC_HOSP_ID,
        DOCTOR_CODE,
        DOC_LNAME,
        DOC_FNAME,
        DOC_MNAME,
        ProcedureId,
        ISACCREDITED,
        HOSPITAL_CODE,
        HOSP_PROF_FEE,
        DEF_PROF_FEE,
        ACTUAL_PROF_FEE,
        REF_DIAGPROC_ID,
        MACE_DOCTYPE,
        ADDED_ON,
        ADDED_BY,
        TRANS_CODE,
        FULL_NAME,
        REMARKS,
        SPECIAL_SOCIETY,
        DATE_SIGNED
        )
        VALUES
        (
        #{mrid.maceRequestId, jdbcType=INTEGER},
        #{mrid.transactionId, jdbcType=INTEGER},
        #{mrid.docHospId, jdbcType=INTEGER},
        #{mrid.doctorCode, jdbcType=VARCHAR},
        #{mrid.docLname, jdbcType=VARCHAR},
        #{mrid.docFname, jdbcType=VARCHAR},
        #{mrid.docMname, jdbcType=VARCHAR},
        #{mrid.procedureId, jdbcType=INTEGER},
        #{mrid.isAccredited, jdbcType=BIT},
        #{mrid.hospitalCode, jdbcType=VARCHAR},
        #{mrid.hospProfFee, jdbcType=NUMERIC},
        #{mrid.defProfFee, jdbcType=NUMERIC},
        #{mrid.actualProfFee, jdbcType=NUMERIC},
        #{mrid.refDiagProcId, jdbcType=INTEGER},
        #{mrid.maceDoctype, jdbcType=VARCHAR},
        #{mrid.addedOn, jdbcType=TIMESTAMP},
        #{mrid.addedBy, jdbcType=VARCHAR},
        #{mrid.transCode, jdbcType=VARCHAR},
        #{mrid.fullName, jdbcType=VARCHAR},
        #{mrid.remarks, jdbcType=VARCHAR},
        #{mrid.specialSociety, jdbcType=VARCHAR},
        #{mrid.dateSigned, jdbcType=TIMESTAMP}
        )
    </insert>

    <update id="updateMaceReqIpDoctor" flushCache="true">
        UPDATE [MACE_REQ_IP_DOCTOR]
        SET
        [DOC_HOSP_ID] = #{mrid.docHospId, jdbcType=INTEGER}
        ,[DOCTOR_CODE] = #{mrid.doctorCode, jdbcType=VARCHAR}
        ,[DOC_LNAME] = #{mrid.docLname, jdbcType=VARCHAR}
        ,[DOC_FNAME] = #{mrid.docFname, jdbcType=VARCHAR}
        ,[DOC_MNAME] = #{mrid.docMname, jdbcType=VARCHAR}
        ,[ProcedureId] = #{mrid.procedureId, jdbcType=INTEGER}
        ,[ISACCREDITED] = #{mrid.isAccredited, jdbcType=BIT}
        ,[HOSPITAL_CODE] = #{mrid.hospitalCode, jdbcType=VARCHAR}
        ,[HOSP_PROF_FEE] = #{mrid.hospProfFee, jdbcType=NUMERIC}
        ,[DEF_PROF_FEE] = #{mrid.defProfFee, jdbcType=NUMERIC}
        ,[ACTUAL_PROF_FEE] = #{mrid.actualProfFee, jdbcType=NUMERIC}
        ,[REF_DIAGPROC_ID] = #{mrid.refDiagProcId, jdbcType=INTEGER}
        ,[MACE_DOCTYPE] = #{mrid.maceDoctype, jdbcType=VARCHAR}
        ,[ADDED_ON] = #{mrid.addedOn, jdbcType=TIMESTAMP}
        ,[ADDED_BY] = #{mrid.addedBy, jdbcType=VARCHAR}
        ,[TRANS_CODE] = #{mrid.transCode, jdbcType=VARCHAR}
        ,[FULL_NAME] = #{mrid.fullName, jdbcType=VARCHAR}
        ,[REMARKS] = #{mrid.remarks, jdbcType=VARCHAR}
        where IP_REQDOC_ID = #{mrid.ipReqdocId, jdbcType=INTEGER}
    </update>

    <insert id="saveMaceReqErDoctor" parameterType="com.basicauth.domain.MaceReqErDoctor" flushCache="true"
            useGeneratedKeys="true" keyProperty="mred.erReqDocId" keyColumn="ER_REQDOC_ID">

        INSERT INTO MACE_REQ_ER_DOCTOR(
        MACEREQUEST_ID,
        DOC_HOSP_ID,
        DOCTOR_CODE,
        DOC_LNAME,
        DOC_FNAME,
        DOC_MNAME,
        SPECIALIZATION,
        ISACCREDITED,
        HOSPITAL_CODE,
        HOSP_PROF_FEE,
        DEF_PROF_FEE,
        ACTUAL_PROF_FEE,
        MACE_DOCTYPE,
        PROC_CODE,
        PROC_DESC,
        ADDED_ON,
        ADDED_BY,
        TRANS_CODE
        ) VALUES (
        #{mred.maceRequestId, jdbcType=INTEGER},
        #{mred.docHospId, jdbcType=INTEGER},
        #{mred.doctorCode, jdbcType=VARCHAR},
        #{mred.docLname, jdbcType=VARCHAR},
        #{mred.docFname, jdbcType=VARCHAR},
        #{mred.docMname, jdbcType=VARCHAR},
        #{mred.specialization, jdbcType=VARCHAR},
        #{mred.isAccredited, jdbcType=BIT},
        #{mred.hospitalCode, jdbcType=VARCHAR},
        #{mred.hospProfFee, jdbcType=DECIMAL},
        #{mred.defProfFee, jdbcType=DECIMAL},
        #{mred.actualProfFee, jdbcType=DECIMAL},
        #{mred.maceDocType, jdbcType=VARCHAR},
        #{mred.procedureId, jdbcType=VARCHAR},
        #{mred.procDesc, jdbcType=VARCHAR},
        #{mred.addedOn, jdbcType=TIMESTAMP},
        #{mred.addedBy, jdbcType=VARCHAR},
        #{mred.transCode, jdbcType=VARCHAR}
        )

    </insert>

    <insert id="saveMaceReqIpDiag" parameterType="com.basicauth.domain.MaceReqIpDiag" flushCache="true"
            useGeneratedKeys="true" keyProperty="mrid.ipReqdiagId" keyColumn="IP_REQDIAG_ID">
        INSERT INTO MACE_REQ_IP_DIAG (
        MACEREQUEST_ID,
        TRANSACTION_ID,
        DiagnosisId,
        ICD10_CODE,
        ICD10_CLASS,
        ICD10_4C,
        DIAG_DESC,
        DIAG_TYPE_OLD,
        DIAG_TYPE,
        DIAG_CASETYPE,
        TYPE_DESC,
        GROUP_DESC,
        DIAG_CLASS,
        DIAG_REMARKS,
        MACE_DIAG_TYPE,
        TRANS_CODE,
        TO_RULE_OUT,
        TO_CONSIDER,
        VERSUS,
        DISEASE_LIMIT,
        REM_LIMIT,
        IS_PRIMARY,
        IS_ADMITTING,
        IS_FINAL,
        CreatedBy,
        CreatedDate,
        DISEASE_LIMIT_TYPE,
        REMARKS
        ) VALUES (
        #{mrid.maceRequestId, jdbcType=INTEGER},
        #{mrid.transactionId, jdbcType=INTEGER},
        #{mrid.diagnosisId, jdbcType=INTEGER},
        #{mrid.icd10Code, jdbcType=VARCHAR},
        #{mrid.icd10Class, jdbcType=VARCHAR},
        #{mrid.icd104C, jdbcType=VARCHAR},
        #{mrid.diagDesc, jdbcType=VARCHAR},
        #{mrid.diagTypeOld, jdbcType=VARCHAR},
        #{mrid.diagType, jdbcType=VARCHAR},
        #{mrid.diagCaseType, jdbcType=VARCHAR},
        #{mrid.typeDesc, jdbcType=VARCHAR},
        #{mrid.procGroupDesc, jdbcType=VARCHAR},
        #{mrid.diagClass, jdbcType=VARCHAR},
        #{mrid.diagRemarks, jdbcType=VARCHAR},
        #{mrid.maceDiagType, jdbcType=INTEGER},
        #{mrid.transCode, jdbcType=VARCHAR},
        #{mrid.toRuleOut, jdbcType=BIT},
        #{mrid.toConsider, jdbcType=BIT},
        #{mrid.versus, jdbcType=BIT},
        #{mrid.diseaseLimit, jdbcType=DECIMAL},
        #{mrid.remLimit, jdbcType=DECIMAL},
        #{mrid.isPrimary, jdbcType=BIT},
        #{mrid.isAdmitting, jdbcType=BIT},
        #{mrid.isFinal, jdbcType=BIT},
        #{mrid.createdBy, jdbcType=VARCHAR},
        #{mrid.createdDate, jdbcType=TIMESTAMP},
        #{mrid.diseaseLimitType, jdbcType=VARCHAR},
        #{mrid.remarks, jdbcType=VARCHAR}
        )
    </insert>

    <update id="updateMaceReqIpDiag" flushCache="true">
        UPDATE [MACE_REQ_IP_DIAG]
        SET [ICD10_CODE] = #{mrid.icd10Code, jdbcType=VARCHAR}
        ,[ICD10_CLASS] = #{mrid.icd10Class, jdbcType=VARCHAR}
        ,[ICD10_4C] = #{mrid.icd104C, jdbcType=VARCHAR}
        ,[DIAG_DESC] = #{mrid.diagDesc, jdbcType=VARCHAR}
        ,[DIAG_TYPE_OLD] = #{mrid.diagTypeOld, jdbcType=VARCHAR}
        ,[DIAG_TYPE] = #{mrid.diagType, jdbcType=VARCHAR}
        ,[DIAG_CASETYPE] = #{mrid.diagCaseType, jdbcType=VARCHAR}
        ,[TYPE_DESC] = #{mrid.typeDesc, jdbcType=VARCHAR}
        ,[GROUP_DESC] = #{mrid.procGroupDesc, jdbcType=VARCHAR}
        ,[DIAG_CLASS] = #{mrid.diagClass, jdbcType=VARCHAR}
        ,[DIAG_REMARKS] = #{mrid.diagRemarks, jdbcType=VARCHAR}
        ,[MACE_DIAG_TYPE] = #{mrid.maceDiagType, jdbcType=INTEGER}
        ,[TRANS_CODE] = #{mrid.transCode, jdbcType=VARCHAR}
        ,[DISEASE_LIMIT] = #{mrid.diseaseLimit, jdbcType=DECIMAL}
        ,[REM_LIMIT] = #{mrid.remLimit, jdbcType=DECIMAL}
        ,[IS_PRIMARY] = #{mrid.isPrimary, jdbcType=BIT}
        ,[IS_ADMITTING] = #{mrid.isAdmitting, jdbcType=BIT}
        ,[IS_FINAL] = #{mrid.isFinal, jdbcType=BIT}
        ,[TO_RULE_OUT] = #{mrid.toRuleOut, jdbcType=BIT}
        ,[TO_CONSIDER] = #{mrid.toConsider, jdbcType=BIT}
        ,[VERSUS] = #{mrid.versus, jdbcType=BIT}
        ,[DiagnosisId] = #{mrid.diagnosisId, jdbcType=INTEGER}
        ,[CreatedBy] = #{mrid.createdBy, jdbcType=VARCHAR}
        ,[CreatedDate] = #{mrid.createdDate, jdbcType=TIMESTAMP}
        ,[DISEASE_LIMIT_TYPE] = #{mrid.diseaseLimitType, jdbcType=VARCHAR}
        ,[REMARKS] = #{mrid.remarks, jdbcType=VARCHAR}
        where IP_REQDIAG_ID = #{mrid.ipReqdiagId, jdbcType=INTEGER}
    </update>

    <insert id="saveMaceReqIpDiagProc" parameterType="com.basicauth.domain.MaceReqIpDiagproc" flushCache="true"
            useGeneratedKeys="true" keyProperty="mridp.ipReqdiagprocId" keyColumn="IP_REQDIAGPROC_ID">
        INSERT INTO MACE_REQ_IP_DIAGPROC (
        REQDIAG_ID,
        MACEREQUEST_ID,
        TRANSACTION_ID,
        DiagnosisId,
        ProcedureId,
        PROC_DESC,
        RUV,
        [SESSION],
        AREA,
        HOSP_AMOUNT,
        DEF_AMOUNT,
        ACTUAL_AMOUNT,
        [GROUP],
        PROC_TYPE,
        PROC_TYPEDESC,
        PROC_CLASS,
        PROC_CLASSDESC,
        REMARKS,
        STATUS,
        MACE_SUBTYPE,
        COVERED,
        TRANS_CODE,
        CreatedBy,
        CreatedDate
        ) VALUES (
        #{mridp.reqDiagId, jdbcType=INTEGER},
        #{mridp.maceRequestId, jdbcType=INTEGER},
        #{mridp.transactionId, jdbcType=INTEGER},
        #{mridp.diagnosisId, jdbcType=INTEGER},
        #{mridp.procedureId, jdbcType=INTEGER},
        #{mridp.procDesc, jdbcType=VARCHAR},
        #{mridp.ruv, jdbcType=VARCHAR},
        #{mridp.session, jdbcType=VARCHAR},
        #{mridp.area, jdbcType=VARCHAR},
        #{mridp.hospAmount, jdbcType=NUMERIC},
        #{mridp.defAmount, jdbcType=NUMERIC},
        #{mridp.actualAmount, jdbcType=NUMERIC},
        #{mridp.procGroup, jdbcType=VARCHAR},
        #{mridp.procType, jdbcType=VARCHAR},
        #{mridp.procTypedesc, jdbcType=VARCHAR},
        #{mridp.procClass, jdbcType=VARCHAR},
        #{mridp.procClassdesc, jdbcType=VARCHAR},
        #{mridp.remarks, jdbcType=VARCHAR},
        #{mridp.status, jdbcType=INTEGER},
        #{mridp.maceSubtype, jdbcType=INTEGER},
        #{mridp.covered, jdbcType=INTEGER},
        #{mridp.transCode, jdbcType=VARCHAR},
        #{mridp.createdBy, jdbcType=VARCHAR},
        #{mridp.createdDate, jdbcType=TIMESTAMP}
        )
    </insert>

    <update id="updateMaceReqIpDiagProc" flushCache="true">
        UPDATE [MACE_REQ_IP_DIAGPROC]
        SET [PROC_DESC] = #{mridp.procDesc, jdbcType=VARCHAR}
            ,[RUV] = #{mridp.ruv, jdbcType=VARCHAR}
            ,[HOSP_AMOUNT] = #{mridp.hospAmount, jdbcType=NUMERIC}
            ,[DEF_AMOUNT] = #{mridp.defAmount, jdbcType=NUMERIC}
            ,[ACTUAL_AMOUNT] = #{mridp.actualAmount, jdbcType=NUMERIC}
            ,[GROUP] = #{mridp.procGroup, jdbcType=VARCHAR}
            ,[PROC_TYPE] = #{mridp.procType, jdbcType=VARCHAR}
            ,[PROC_TYPEDESC] = #{mridp.procTypedesc, jdbcType=VARCHAR}
            ,[PROC_CLASS] = #{mridp.procClass, jdbcType=VARCHAR}
            ,[PROC_CLASSDESC] = #{mridp.procClassdesc, jdbcType=VARCHAR}
            ,[REMARKS] = #{mridp.remarks, jdbcType=VARCHAR}
            ,[STATUS] = #{mridp.status, jdbcType=INTEGER}
            ,[MACE_SUBTYPE] = #{mridp.maceSubtype, jdbcType=INTEGER}
            ,[COVERED] = #{mridp.covered, jdbcType=INTEGER}
            ,[TRANS_CODE] = #{mridp.transCode, jdbcType=VARCHAR}
            ,[AREA] = #{mridp.area, jdbcType=VARCHAR}
            ,[SESSION] = #{mridp.session, jdbcType=VARCHAR}
            ,[ProcedureId] = #{mridp.procedureId, jdbcType=INTEGER}
            ,[DiagnosisId] = #{mridp.diagnosisId, jdbcType=INTEGER}
            ,[CreatedBy] = #{mridp.createdBy, jdbcType=VARCHAR}
            ,[CreatedDate] = #{mridp.createdDate, jdbcType=TIMESTAMP}
        where IP_REQDIAGPROC_ID = #{mridp.ipReqdiagprocId, jdbcType=INTEGER}
    </update>

    <insert id="saveMaceRequestIpOtherCharge" parameterType="com.basicauth.data.MaceReqIpOtherCharge" flushCache="true"
            useGeneratedKeys="true" keyProperty="mriOc.ipOtherChargeId" keyColumn="IP_OTHERCHARGE_ID">
        INSERT INTO MACE_REQ_IP_OTHERCHARGES(
        MACEREQUEST_ID,
        TRANSACTION_ID,
        CHARGE_TYPE,
        DiagnosisId,
        DIAG_DESC,
        DETAILS,
        CHARGE_AMOUNT
        ) VALUES (
        #{mriOc.maceRequestId, jdbcType=INTEGER},
        #{mriOc.transactionId, jdbcType=INTEGER},
        #{mriOc.chargeType, jdbcType=VARCHAR},
        #{mriOc.diagnosisId, jdbcType=INTEGER},
        #{mriOc.diagDesc, jdbcType=VARCHAR},
        #{mriOc.details, jdbcType=VARCHAR},
        #{mriOc.chargeAmount, jdbcType=DECIMAL}
        )
    </insert>

    <update id="updateMaceRequestIpOtherCharge" flushCache="true">
        UPDATE [MACE_REQ_IP_OTHERCHARGES]
        SET [CHARGE_TYPE] = #{mriOc.chargeType, jdbcType=VARCHAR}
            ,[DETAILS] = #{mriOc.details, jdbcType=VARCHAR}
            ,[CHARGE_AMOUNT] = #{mriOc.chargeAmount, jdbcType=DECIMAL}
            ,[DIAG_DESC] = #{mriOc.diagDesc, jdbcType=VARCHAR}
            ,[DiagnosisId] = #{mriOc.diagnosisId, jdbcType=INTEGER}
        where IP_OTHERCHARGE_ID = #{mriOc.ipOtherChargeId, jdbcType=INTEGER}
    </update>

    <insert id="saveMaceRequestIpOtherInformation" parameterType="com.basicauth.data.MaceReqIpOtherInformation"
            flushCache="true"
            useGeneratedKeys="true" keyProperty="mriOi.ipOtherInformationId" keyColumn="IP_OTHERINFORMATION_ID">
        INSERT INTO MACE_REQ_IP_OTHERINFORMATION(
        MACEREQUEST_ID,
        TRANSACTION_ID,
        INFORMATION_TYPE,
        DETAILS
        ) VALUES (
        #{mriOi.maceRequestId, jdbcType=INTEGER},
        #{mriOi.transactionId, jdbcType=INTEGER},
        #{mriOi.informationType, jdbcType=VARCHAR},
        #{mriOi.details, jdbcType=VARCHAR}
        )
    </insert>

    <update id="updateMaceRequestIpOtherInformation" flushCache="true">
        UPDATE [MACE_REQ_IP_OTHERINFORMATION]
        SET [INFORMATION_TYPE] = #{mriOi.informationType, jdbcType=VARCHAR}
            ,[DETAILS] = #{mriOi.details, jdbcType=VARCHAR}
        where IP_OTHERINFORMATION_ID = #{mriOi.ipOtherInformationId, jdbcType=INTEGER}
    </update>

    <resultMap id="OtherServiceMap" type="com.basicauth.data.OtherService">
        <result column="Id" property="id" jdbcType="INTEGER"/>
        <result column="Service_Code" property="serviceCode" jdbcType="VARCHAR"/>
        <result column="Service_Desc" property="serviceDesc" jdbcType="VARCHAR"/>
        <result column="Created_On" property="createdOn" jdbcType="TIMESTAMP"/>
        <result column="Created_By" property="lastUpdateBy" jdbcType="VARCHAR"/>
        <result column="LastUpdate_On" property="lastUpdateOn" jdbcType="TIMESTAMP"/>
        <result column="LastUpdate_By" property="createdBy" jdbcType="VARCHAR"/>
    </resultMap>

    <resultMap id="diagServiceTypeResultMap" type="com.basicauth.domain.MaceServicetypes">
        <result column="SERVICETYPE_ID" property="serviceTypeId" jdbcType="INTEGER"/>
        <result column="SERVICETYPE_CODE" property="servicetypeCode" jdbcType="VARCHAR"/>
        <result column="SERVICE_DESC" property="serviceDesc" jdbcType="VARCHAR"/>
        <result column="ACTIVE" property="active" jdbcType="BIT"/>
        <result column="LASTUPDATE_ON" property="lastupdateOn" jdbcType="TIMESTAMP"/>
        <result column="LASTUPDATE_BY" property="lastupdateBy" jdbcType="VARCHAR"/>
    </resultMap>

    <resultMap id="diagSubServiceTypeResultMap" type="com.basicauth.domain.MaceServiceSubtype">
        <result column="ID" property="id" jdbcType="INTEGER"/>
        <result column="SERVICETYPE_ID" property="serviceTypeId" jdbcType="VARCHAR"/>
        <result column="SERVICE_DESC" property="desc" jdbcType="VARCHAR"/>
        <result column="ACTIVE" property="active" jdbcType="BIT"/>
        <result column="LASTUPDATE_ON" property="lastUpdateOn" jdbcType="TIMESTAMP"/>
        <result column="LASTUPDATE_BY" property="lastUpdateBy" jdbcType="VARCHAR"/>
    </resultMap>

    <select id="getServiceTypes" resultMap="diagServiceTypeResultMap" resultType="java.util.List">
        SELECT
        SERVICETYPE_ID,
        SERVICETYPE_CODE,
        SERVICE_DESC,
        ACTIVE,
        LASTUPDATE_ON,
        LASTUPDATE_BY

        FROM
        MACE_SERIVCETYPES
    </select>

    <!-- TODO: TO BE MIGRATED TO SOMEWHERE -->

    <resultMap id="maceRequestMap" type="com.basicauth.data.MaceRequest">
        <result column="request_id" property="requestId" jdbcType="INTEGER"/>
        <result column="request_code" property="requestCode" jdbcType="VARCHAR"/>
        <result column="servicetype_id" property="serviceTypeId" jdbcType="INTEGER"/>
        <result column="member_code" property="memCode" jdbcType="VARCHAR"/>
        <result column="mem_lname" property="memLname" jdbcType="VARCHAR"/>
        <result column="mem_fname" property="memFname" jdbcType="VARCHAR"/>
        <result column="mem_mi" property="memMi" jdbcType="VARCHAR"/>
        <result column="mem_company" property="memCompany" jdbcType="VARCHAR"/>
        <result column="mem_acct" property="memAcct" jdbcType="VARCHAR"/>
        <result column="mem_stat" property="memStat" jdbcType="VARCHAR"/>
        <result column="mem_bdate" property="memBdate" jdbcType="TIMESTAMP"/>
        <result column="mem_gender" property="memGender" jdbcType="VARCHAR"/>
        <result column="mem_age" property="memAge" jdbcType="INTEGER"/>
        <result column="mem_type" property="memType" jdbcType="VARCHAR"/>
        <result column="idremarks" property="idremarks" jdbcType="VARCHAR"/>
        <result column="acct_validity" property="acctValidity" jdbcType="TIMESTAMP"/>
        <result column="acct_effectivity" property="acctEffectivity" jdbcType="TIMESTAMP"/>
        <result column="request_origin" property="requestOrigin" jdbcType="VARCHAR"/>
        <result column="request_fromhosp" property="requestFromhosp" jdbcType="VARCHAR"/>
        <result column="request_frommem" property="requestFrommem" jdbcType="VARCHAR"/>
        <result column="request_by_code" property="requestByCode" jdbcType="VARCHAR"/>
        <result column="request_by" property="requestBy" jdbcType="VARCHAR"/>
        <result column="request_device" property="requestDevice" jdbcType="VARCHAR"/>
        <result column="request_datetime" property="requestDatetime" jdbcType="TIMESTAMP"/>
        <result column="disclaimer_ticked" property="disclaimerTicked" jdbcType="BIT"/>
        <result column="last_update_on" property="lastupdateOn" jdbcType="VARCHAR"/>
        <result column="last_update_by" property="lastupdateBy" jdbcType="VARCHAR"/>
        <result column="status" property="status" jdbcType="VARCHAR"/>
        <result column="status_assignee" property="statusAssignee" jdbcType="VARCHAR"/>
        <result column="status_remarks" property="statusRemarks" jdbcType="VARCHAR"/>
        <result column="override" property="override" jdbcType="BIT"/>
        <result column="par_request_id" property="parRequestId" jdbcType="VARCHAR"/>
        <result column="mbas_code" property="mbasCode" jdbcType="VARCHAR"/>
        <result column="mbas_approver" property="mbasApprover" jdbcType="VARCHAR"/>
        <result column="mbasupdate_on" property="mbasupdateOn" jdbcType="TIMESTAMP"/>
        <result column="servicetype" property="serviceType" jdbcType="VARCHAR"/>
        <result column="hasAttachments" property="hasAttachments" jdbcType="BOOLEAN"/>
        <result column="HOSP_CONTACT" property="hospContact" jdbcType="VARCHAR"/>
        <result column="HOSP_EMAIL" property="hospEmail" jdbcType="VARCHAR"/>
        <result column="MEM_EMAIL" property="memEmail" jdbcType="VARCHAR"/>
        <result column="MEM_CONTACT" property="memContact" jdbcType="VARCHAR"/>
        <result column="total_utilization" property="totalUtilization" jdbcType="VARCHAR"/>
        <result column="admission_type" property="admissionType" jdbcType="VARCHAR"/>
        <result column="admission_date" property="admissionDate" jdbcType="TIMESTAMP"/>
        <result column="reason_for_admission" property="reasonForConsult" jdbcType="VARCHAR"/>
    </resultMap>

    <select id="getReferenceNoByReqId" resultType="java.lang.String">
        SELECT REFERENCE_NO FROM MACEREQ_CONSULT WHERE MACEREQUEST_ID = #{reqId}
    </select>

    <select id="getApprovalNosByReqId" resultType="java.lang.String">
        SELECT APPROVAL_NO FROM MACEREQ_TEST WHERE MACEREQUEST_ID = #{reqId}
        UNION
        SELECT APPROVAL_NO FROM MACEREQ_PROCEDURE WHERE MACEREQUEST_ID = #{reqId}
    </select>

    <select id="getRecentTransactionHospCode" resultMap="maceRequestMap" resultType="java.util.List">
        SELECT TOP 30 * FROM MACE_REQUEST WHERE REQUEST_FROMHOSP = #{hospCode}
        <if test="memberCode != '' or memberCode != null">
            AND MEMBER_CODE = #{memberCode}
        </if>
        ORDER BY REQUEST_DATETIME DESC
    </select>

    <update id="updateMaceRequestStatus" flushCache="true">
        UPDATE MACE_REQUEST
        SET STATUS = #{status}
        WHERE REQUEST_ID = #{id}
    </update>

    <update id="updateMaceRequestStatusAndAssignee" flushCache="true">
        UPDATE MACE_REQUEST
        SET STATUS = #{status},
        STATUS_ASSIGNEE = #{statusAssignee}
        WHERE REQUEST_ID = #{id}
    </update>

    <update id="overrideParentRequest" flushCache="true">
        UPDATE MACE_REQUEST
        SET OVERRIDE = #{isOverriden, jdbcType=BIT}
        WHERE REQUEST_ID = #{parRequestId}
    </update>

    <select id="getMaceReqCodeByMaceReqId" resultType="java.lang.String">
        SELECT REQUEST_CODE FROM MACE_REQUEST WHERE REQUEST_ID = #{requestId}
    </select>

    <select id="getreqIdByRequestCode" resultType="java.lang.Integer">
        SELECT REQUEST_ID FROM MACE_REQUEST WHERE REQUEST_CODE = #{requestCode}
    </select>

    <select id="getMaceRequestByRequestCode" resultMap="maceRequestMap" resultType="com.basicauth.data.MaceRequest">
        SELECT TOP 1 * FROM MACE_REQUEST WHERE REQUEST_CODE = #{requestCode}
    </select>

    <resultMap id="maceReqConsultMap" type="com.basicauth.domain.MaceReqConsult">
        <result column="transaction_id" property="transactionId" jdbcType="INTEGER"/>
        <result column="macerequest_id" property="maceRequestId" jdbcType="INTEGER"/>
        <result column="request_from" property="requestFrom" jdbcType="VARCHAR"/>
        <result column="status" property="status" jdbcType="VARCHAR"/>
        <result column="status_remarks" property="statusRemarks" jdbcType="VARCHAR"/>
        <result column="approved_on" property="approvedOn" jdbcType="TIMESTAMP"/>
        <result column="approved_by" property="approvedBy" jdbcType="VARCHAR"/>
        <result column="approval_remarks" property="approvalRemarks" jdbcType="VARCHAR"/>
        <result column="disapproved_on" property="disapprovedOn" jdbcType="TIMESTAMP"/>
        <result column="disapproved_by" property="disapprovedBy" jdbcType="VARCHAR"/>
        <result column="disapproval_remarks" property="disapprovalRemarks" jdbcType="VARCHAR"/>
        <result column="disapproval_reason" property="disapprovalReason" jdbcType="VARCHAR"/>
        <result column="reference_no" property="referenceNo" jdbcType="VARCHAR"/>
        <result column="validfrom" property="validfrom" jdbcType="TIMESTAMP"/>
        <result column="validto" property="validto" jdbcType="TIMESTAMP"/>
        <result column="availed_on" property="availedOn" jdbcType="TIMESTAMP"/>
        <result column="avail_member_agreed" property="availMemberAgreed" jdbcType="BIT"/>
        <result column="avail_member_agreedon" property="availMemberAgreedon" jdbcType="TIMESTAMP"/>
        <result column="pin_entered" property="pinEntered" jdbcType="BIT"/>
        <result column="notes" property="notes" jdbcType="VARCHAR"/>
        <result column="record_submitted_on" property="recordSubmittedOn" jdbcType="TIMESTAMP"/>
        <result column="record_submitted_by" property="recordSubmittedBy" jdbcType="VARCHAR"/>
        <result column="expired_on" property="expiredOn" jdbcType="TIMESTAMP"/>
        <result column="consultation_date" property="consultationDate" jdbcType="TIMESTAMP"/>
        <result column="consult_reason" property="consultReason" jdbcType="VARCHAR"/>
        <result column="doc_hosp_id" property="docHospId" jdbcType="INTEGER"/>
        <result column="doctor_code" property="doctorCode" jdbcType="VARCHAR"/>
        <result column="hospital_code" property="hospitalCode" jdbcType="VARCHAR"/>
        <result column="fee" property="fee" jdbcType="NUMERIC"/>
        <result column="history_of_present_illness" property="historyOfPresentIllness" jdbcType="VARCHAR"/>
        <result column="past_or_family_history" property="pastOrFamilyHistory" jdbcType="VARCHAR"/>
        <result column="review_of_systems" property="reviewOfSystems" jdbcType="VARCHAR"/>
        <result column="vitals_bp" property="vitalsBp" jdbcType="VARCHAR"/>
        <result column="vitals_hr" property="vitalsHr" jdbcType="VARCHAR"/>
        <result column="vitals_rr" property="vitalsRr" jdbcType="VARCHAR"/>
        <result column="vitals_temp" property="vitalsTemp" jdbcType="VARCHAR"/>
        <result column="physical_examination" property="physicalExamination" jdbcType="VARCHAR"/>
        <result column="PrimaryDiagnosisId" property="primaryDiagnosisId" jdbcType="INTEGER"/>
        <result column="primary_diagnosis_icd10" property="primaryDiagnosisIcd10" jdbcType="VARCHAR"/>
        <result column="primary_diagnosis_desc" property="primaryDiagnosisDesc" jdbcType="VARCHAR"/>
        <result column="dx_remarks" property="dxRemarks" jdbcType="VARCHAR"/>
        <result column="is_congenital" property="isCongenital" jdbcType="BIT"/>
        <result column="is_maternity" property="isMaternity" jdbcType="BIT"/>
        <result column="is_medicolegal" property="isMedicolegal" jdbcType="BIT"/>
        <result column="planofmanagement" property="planOfManagement" jdbcType="VARCHAR"/>
        <result column="transamount" property="transAmount" jdbcType="NUMERIC"/>
        <result column="consult_subtype" property="consultSubtype" jdbcType="INTEGER"/>
        <result column="trans_code" property="transCode" jdbcType="VARCHAR"/>
        <result column="doctorName" property="doctorName" jdbcType="VARCHAR"/>
        <result column="MEM_FNAME" property="memberFirstname" jdbcType="VARCHAR"/>
        <result column="MEM_MI" property="memberMiddlename" jdbcType="VARCHAR"/>
        <result column="MEM_LNAME" property="memberLastname" jdbcType="VARCHAR"/>
        <result column="DOC_FNAME" property="doctorFirstname" jdbcType="VARCHAR"/>
        <result column="DOC_MNAME" property="doctorMiddlename" jdbcType="VARCHAR"/>
        <result column="DOC_LNAME" property="doctorLastname" jdbcType="VARCHAR"/>
        <result column="DIAG_DESC" property="prescribeDiagnosis" jdbcType="VARCHAR"/>
        <result column="PROC_DESC" property="prescribeProcedure" jdbcType="VARCHAR"/>
        <result column="PrescribeProcedureStatus" property="prescribeProcedureStatus" jdbcType="INTEGER"/>
    </resultMap>

    <update id="updateMaceReqConsult" flushCache="true">
        UPDATE MACEREQ_CONSULT
        SET
        STATUS = #{mrc.status, jdbcType=VARCHAR},
        AVAILED_ON = #{mrc.availedOn, jdbcType=TIMESTAMP},
        HISTORY_OF_PRESENT_ILLNESS = #{mrc.historyOfPresentIllness, jdbcType=VARCHAR},
        PAST_OR_FAMILY_HISTORY = #{mrc.pastOrFamilyHistory, jdbcType=VARCHAR},
        REVIEW_OF_SYSTEMS = #{mrc.reviewOfSystems, jdbcType=VARCHAR},
        VITALS_BP = #{mrc.vitalsBp, jdbcType=VARCHAR},
        VITALS_HR = #{mrc.vitalsHr, jdbcType=VARCHAR},
        VITALS_RR = #{mrc.vitalsRr, jdbcType=VARCHAR},
        VITALS_TEMP = #{mrc.vitalsTemp, jdbcType=VARCHAR},
        PHYSICAL_EXAMINATION = #{mrc.physicalExamination, jdbcType=VARCHAR},
        PrimaryDiagnosisId = #{mrc.primaryDiagnosisId, jdbcType=INTEGER},
        PRIMARY_DIAGNOSIS_ICD10 = #{mrc.primaryDiagnosisIcd10, jdbcType=VARCHAR},
        PRIMARY_DIAGNOSIS_DESC = #{mrc.primaryDiagnosisDesc, jdbcType=VARCHAR},
        DX_REMARKS = #{mrc.dxRemarks, jdbcType=VARCHAR},
        PRIMARY_DIAGNOSIS_REMARKS = #{mrc.primaryDiagnosisRemarks, jdbcType=VARCHAR},
        IS_CONGENITAL = #{mrc.isCongenital, jdbcType=BIT},
        IS_MATERNITY = #{mrc.isMaternity, jdbcType=BIT},
        IS_MEDICOLEGAL = #{mrc.isMedicolegal, jdbcType=BIT},
        PLANOFMANAGEMENT = #{mrc.planOfManagement, jdbcType=VARCHAR}
        WHERE TRANSACTION_ID = #{mrc.transactionId, jdbcType=INTEGER}
    </update>

    <select id="getMaceReqConsultByRefNo" resultMap="maceReqConsultMap"
            resultType="com.basicauth.domain.MaceReqConsult">
        SELECT TOP 1 * FROM MACEREQ_CONSULT WHERE REFERENCE_NO = #{referenceNo}
    </select>

    <select id="getConsultDoctorHospital" resultMap="maceReqConsultMap"
            resultType="java.util.List">
        SELECT mrc.[TRANSACTION_ID]
        ,mrc.[TRANS_CODE]
        ,mrc.[REFERENCE_NO]
        ,mrc.[MACEREQUEST_ID]
        ,mrc.[CONSULT_SUBTYPE]
        ,mrc.[REQUEST_FROM]
        ,mrc.[STATUS] CONSULT_STATUS
        ,mrc.[STATUS_REMARKS]
        ,mrc.[APPROVED_ON]
        ,mrc.[APPROVED_BY]
        ,mrc.[APPROVAL_REMARKS]
        ,mrc.[VALIDFROM]
        ,mrc.[VALIDTO]
        ,mrc.[AVAILED_ON]
        ,mrc.[AVAIL_MEMBER_AGREED]
        ,mrc.[AVAIL_MEMBER_AGREEDON]
        ,mrc.[PIN_ENTERED]
        ,mrc.[NOTES]
        ,mrc.[RECORD_SUBMITTED_ON]
        ,mrc.[RECORD_SUBMITTED_BY]
        ,mrc.[EXPIRED_ON]
        ,mrc.[CONSULTATION_DATE]
        ,mrc.[CONSULT_REASON]
        ,mrc.[DOC_HOSP_ID]
        ,mrc.[DOCTOR_CODE]
        ,mrc.[HOSPITAL_CODE]
        ,mrc.[FEE]
        ,mrc.[HISTORY_OF_PRESENT_ILLNESS]
        ,mrc.[PAST_OR_FAMILY_HISTORY]
        ,mrc.[REVIEW_OF_SYSTEMS]
        ,mrc.[VITALS_BP]
        ,mrc.[VITALS_HR]
        ,mrc.[VITALS_RR]
        ,mrc.[VITALS_TEMP]
        ,mrc.[PHYSICAL_EXAMINATION]
        ,mrc.[PRIMARY_DIAGNOSIS_CODE]
        ,mrc.[PRIMARY_DIAGNOSIS_ICD10]
        ,mrc.[PRIMARY_DIAGNOSIS_DESC]
        ,mrc.[DX_REMARKS]
        ,mrc.[PRIMARY_DIAGNOSIS_REMARKS]
        ,mrc.[IS_CONGENITAL]
        ,mrc.[IS_MATERNITY]
        ,mrc.[IS_MEDICOLEGAL]
        ,mrc.[PLANOFMANAGEMENT]
        ,mrc.[TRANSAMOUNT]
        ,mrc.[PrimaryDiagnosisId]
        ,mr.[REQUEST_ID]
        ,mr.[REQUEST_CODE]
        ,mr.[SERVICETYPE_ID]
        ,mr.[MEMBER_CODE]
        ,mr.[MEM_LNAME] ,mr.[MEM_FNAME] ,mr.[MEM_MI]
        ,mr.[MEM_COMPANY]
        ,mr.[MEM_ACCT]
        ,mr.[MEM_STAT]
        ,mr.[MEM_BDATE]
        ,mr.[MEM_GENDER]
        ,mr.[MEM_AGE]
        ,mr.[MEM_TYPE]
        ,mr.[IDREMARKS]
        ,mr.[ACCT_VALIDITY]
        ,mr.[ACCT_EFFECTIVITY]
        ,mr.[REQUEST_ORIGIN]
        ,mr.[REQUEST_FROMHOSP]
        ,mr.[HOSP_EMAIL]
        ,mr.[HOSP_CONTACT]
        ,mr.[REQUEST_FROMMEM]
        ,mr.[MEM_EMAIL]
        ,mr.[MEM_CONTACT]
        ,mr.[REQUEST_BY]
        ,mr.[REQUEST_DEVICE]
        ,mr.[REQUEST_DATETIME]
        ,mr.[DISCLAIMER_TICKED]
        ,mr.[LASTUPDATE_ON]
        ,mr.[LASTUPDATE_BY]
        ,mr.[STATUS_ASSIGNEE]
        ,mr.[STATUS_REMARKS]
        ,mr.[OVERRIDE]
        ,mr.[PAR_REQUEST_ID]
        ,mr.[MBAS_CODE]
        ,mr.[MBAS_APPROVER]
        ,mr.[MBASUPDATE_ON]
        ,mr.[STATUS]
        ,mr.[ADMISSION_TYPE]
        ,mr.[ADMISSION_DATE]
        ,mr.[TOTAL_UTILIZATION]
        ,mr.[REQUEST_BY_CODE]
        ,mr.[REASON_FOR_ADMISSION]
        ,mr.[REQUEST_FROM]
        ,d.[DOC_LNAME] ,d.[DOC_FNAME], d.[DOC_MNAME]
        ,mrod.[DIAG_DESC]
        ,mcp.PROC_DESC, mcp.[STATUS] PrescribeProcedureStatus
        FROM [Mace].[dbo].[MACEREQ_CONSULT] mrc
        JOIN [Mace].[dbo].[MACE_REQUEST] mr ON mrc.MACEREQUEST_ID = mr.REQUEST_ID
        AND mr.MEM_STAT = 'ACTIVE'
        JOIN [Mace].[dbo].vw_Doctors d ON mrc.DOCTOR_CODE = d.DOCTOR_CODE
        AND mrc.HOSPITAL_CODE = d.HOSPITAL_CODE
        LEFT JOIN [Mace].[dbo].[MACE_CONS_PRESCRIBEDTEST] mcp ON mrc.MACEREQUEST_ID = mcp.MACEREQUEST_ID
        JOIN [Mace].[dbo].[MACE_REQ_OP_DIAG] mrod ON mcp.REQDIAG_ID = mrod.REQDIAG_ID
        WHERE mrc.DOCTOR_CODE = #{doctorCode}
        <if test="null != referenceNumber">
            AND mrc.REFERENCE_NO = #{referenceNumber}
        </if>
        AND mrc.HOSPITAL_CODE = #{hospitalCode}
        AND mrc.STATUS = 'APPROVED'
        AND mrc.APPROVED_ON IS NOT NULL
        AND mrc.EXPIRED_ON IS NULL
    </select>

    <insert id="saveMaceReqConsult" parameterType="com.basicauth.domain.MaceReqConsult" flushCache="true"
            useGeneratedKeys="true" keyProperty="mrc.transactionId" keyColumn="transaction_id">
        INSERT INTO MACEREQ_CONSULT (
        TRANS_CODE,
        MACEREQUEST_ID,
        CONSULT_SUBTYPE,
        REQUEST_FROM,
        STATUS,
        STATUS_REMARKS,
        APPROVED_ON,
        APPROVED_BY,
        APPROVAL_REMARKS,
        DISAPPROVED_ON,
        DISAPPROVED_BY,
        DISAPPROVAL_REMARKS,
        DISAPPROVAL_REASON,
        REFERENCE_NO,
        VALIDFROM,
        VALIDTO,
        AVAILED_ON,
        AVAIL_MEMBER_AGREED,
        AVAIL_MEMBER_AGREEDON,
        PIN_ENTERED,
        NOTES,
        RECORD_SUBMITTED_ON,
        RECORD_SUBMITTED_BY,
        EXPIRED_ON,
        CONSULTATION_DATE,
        CONSULT_REASON,
        DOC_HOSP_ID,
        DOCTOR_CODE,
        HOSPITAL_CODE,
        FEE,
        HISTORY_OF_PRESENT_ILLNESS,
        PAST_OR_FAMILY_HISTORY,
        REVIEW_OF_SYSTEMS,
        VITALS_BP,
        VITALS_HR,
        VITALS_RR,
        VITALS_TEMP,
        PHYSICAL_EXAMINATION,
        PrimaryDiagnosisId,
        PRIMARY_DIAGNOSIS_ICD10,
        PRIMARY_DIAGNOSIS_DESC,
        DX_REMARKS,
        IS_CONGENITAL,
        IS_MATERNITY,
        IS_MEDICOLEGAL,
        PLANOFMANAGEMENT,
        TRANSAMOUNT
        ) VALUES (
        #{mrc.transCode, jdbcType=VARCHAR},
        #{mrc.maceRequestId, jdbcType=INTEGER},
        #{mrc.consultSubtype, jdbcType=SMALLINT},
        #{mrc.requestFrom, jdbcType=VARCHAR},
        #{mrc.status, jdbcType=VARCHAR},
        #{mrc.statusRemarks, jdbcType=VARCHAR},
        #{mrc.approvedOn, jdbcType=DATE},
        #{mrc.approvedBy, jdbcType=VARCHAR},
        #{mrc.approvalRemarks, jdbcType=VARCHAR},
        #{mrc.disapprovedOn, jdbcType=DATE},
        #{mrc.disapprovedBy, jdbcType=VARCHAR},
        #{mrc.disapprovalRemarks, jdbcType=VARCHAR},
        #{mrc.disapprovalReason, jdbcType=VARCHAR},
        #{mrc.referenceNo, jdbcType=VARCHAR},
        #{mrc.validfrom, jdbcType=DATE},
        #{mrc.validto, jdbcType=DATE},
        #{mrc.availedOn, jdbcType=TIMESTAMP},
        #{mrc.availMemberAgreed, jdbcType=BIT},
        #{mrc.availMemberAgreedon, jdbcType=TIMESTAMP},
        #{mrc.pinEntered, jdbcType=BIT},
        #{mrc.notes, jdbcType=VARCHAR},
        #{mrc.recordSubmittedOn, jdbcType=TIMESTAMP},
        #{mrc.recordSubmittedBy, jdbcType=VARCHAR},
        #{mrc.expiredOn, jdbcType=TIMESTAMP},
        #{mrc.consultationDate, jdbcType=TIMESTAMP},
        #{mrc.consultReason, jdbcType=VARCHAR},
        #{mrc.docHospId, jdbcType=INTEGER},
        #{mrc.doctorCode, jdbcType=VARCHAR},
        #{mrc.hospitalCode, jdbcType=VARCHAR},
        #{mrc.fee, jdbcType=NUMERIC},
        #{mrc.historyOfPresentIllness, jdbcType=VARCHAR},
        #{mrc.pastOrFamilyHistory, jdbcType=VARCHAR},
        #{mrc.reviewOfSystems, jdbcType=VARCHAR},
        #{mrc.vitalsBp, jdbcType=VARCHAR},
        #{mrc.vitalsHr, jdbcType=VARCHAR},
        #{mrc.vitalsRr, jdbcType=VARCHAR},
        #{mrc.vitalsTemp, jdbcType=VARCHAR},
        #{mrc.physicalExamination, jdbcType=VARCHAR},
        #{mrc.primaryDiagnosisId, jdbcType=INTEGER},
        #{mrc.primaryDiagnosisIcd10, jdbcType=VARCHAR},
        #{mrc.primaryDiagnosisDesc, jdbcType=VARCHAR},
        #{mrc.dxRemarks, jdbcType=VARCHAR},
        #{mrc.isCongenital, jdbcType=BIT},
        #{mrc.isMaternity, jdbcType=BIT},
        #{mrc.isMedicolegal, jdbcType=BIT},
        #{mrc.planOfManagement, jdbcType=VARCHAR},
        #{mrc.transAmount, jdbcType=DECIMAL}
        )
    </insert>

    <select id="getMaceRequestsByMemberCode" resultMap="maceRequestMap">
        select * from mace_request
        where member_code = #{memberCode}
        and status like #{status}
        order by request_datetime desc
        offset (#{offset}) rows
        fetch next (#{count}) rows only
    </select>

    <select id="getServiceTypeOnlyFilteredMaceRequestsByMemberCode" resultMap="maceRequestMap">
        select * from mace_request
        where servicetype_id = #{serviceType}
        and member_code = #{memberCode}
        and status like #{status}
        order by request_datetime desc
        offset (#{offset}) rows
        fetch next (#{count}) rows only
    </select>

    <select id="getServiceTypeFilteredMaceRequestsByMemberCode" resultMap="maceRequestMap">
        select mr.* from mace_request as mr
        inner join macereq_consult as mrc on mrc.macerequest_id = mr.request_id
        where mr.servicetype_id = #{serviceType}
        and mr.member_code = #{memberCode}
        and mr.status like #{status}
        order by request_datetime desc
        offset (#{offset}) rows
        fetch next (#{count}) rows only
    </select>

    <select id="getServiceTypeOnlyFilteredMaceRequestsByMemberCodeForConsult" resultMap="maceRequestMap">
        select mr.* from mace_request as mr
        where mr.servicetype_id = 1
        and mr.member_code = #{memberCode}
        and mr.status like #{status}
        order by request_datetime desc
        offset (#{offset}) rows
        fetch next (#{count}) rows only
    </select>

    <select id="getServiceTypeOnlyFilteredMaceRequestsByMemberCodeForTest" resultMap="maceRequestMap">
        select mr.* from mace_request as mr
        where mr.servicetype_id = 2
        and mr.member_code = #{memberCode}
        and mr.status like #{status}
        order by request_datetime desc
        offset (#{offset}) rows
        fetch next (#{count}) rows only
    </select>

    <select id="getServiceTypeFilteredMaceRequestsByMemberCodeForConsult" resultMap="maceRequestMap">
        select mr.* from mace_request as mr
        inner join macereq_consult as mrc on mrc.macerequest_id = mr.request_id
        where mr.servicetype_id = 1
        and mr.member_code = #{memberCode}
        and mrc.consult_subtype = #{subServiceType}
        and mr.status like #{status}
        order by request_datetime desc
        offset (#{offset}) rows
        fetch next (#{count}) rows only
    </select>

    <select id="getServiceTypeFilteredMaceRequestsByMemberCodeForTest" resultMap="maceRequestMap">
        select mr.* from mace_request as mr
        inner join macereq_test as mrt on mrt.macerequest_id = mr.request_id
        where mr.servicetype_id = 2
        and mr.member_code = #{memberCode}
        and mrt.test_subtype = #{subServiceType}
        and mr.status like #{status}
        order by request_datetime desc
        offset (#{offset}) rows
        fetch next (#{count}) rows only
    </select>

    <select id="getMaceReqConsult" resultMap="maceReqConsultMap" resultType="com.basicauth.domain.MaceReqConsult">
        select TOP 1 * from macereq_consult where macerequest_id = #{maceRequestId}
    </select>

    <select id="getMaceRequestConsult" resultMap="maceReqConsultMap" statementType="CALLABLE">
        {CALL [SP_MACE_GetMaceConsults](
        #{@membercode, mode=IN, jdbcType=VARCHAR } ,
        #{@consStatus, mode=IN, jdbcType=VARCHAR },
        #{@constype, mode=IN, jdbcType=VARCHAR },
        #{@doctorCode, mode=IN, jdbcType=VARCHAR },
        #{@serviceType, mode=IN, jdbcType=VARCHAR },
        #{@testStatus, mode=IN, jdbcType=VARCHAR },
        #{@offset, mode=IN, jdbcType=INTEGER },
        #{@count, mode=IN, jdbcType=INTEGER }
        )}
    </select>

    <select id="getMaceRequestByRequestID" resultMap="maceRequestMap" resultType="com.basicauth.data.MaceRequest">
        select TOP 1 * from MACE_REQUEST where REQUEST_ID = #{request_id}
    </select>

    <select id="getConsultDiagnosis" resultMap="maceReqOpDiagMap">
        select * from Mace_req_op_diag where (macerequest_id=#{request_id} OR #{request_id} is null)
        and (transaction_id =#{transaction_id} or #{transaction_id} is null)
    </select>

    <select id="getConsultPrescribedTests" resultMap="maceConsPrescribedtestMap">
        select * from [MACE_CONS_PRESCRIBEDTEST] where
        (macerequest_id=#{request_id} or #{request_id} IS NULL)
        AND
        ([CONS_TRANSACTION_ID]=#{transaction_id} or #{transaction_id} is null)
        AND (mace_subtype IN (SELECT ListValue FROM dbo.FN_ListToTable(',',#{servicetype})) OR #{servicetype} is null)
        AND ([status] IN (SELECT ListValue FROM dbo.FN_ListToTable(',',#{testStatus})) or #{testStatus} IS NULL or
        [status] IS NULL)
    </select>

    <select id="getOtherServices" resultMap="OtherServiceMap" resultType="java.util.List">
        SELECT * FROM MACE_CM_OTHERSERVICES
    </select>

    <resultMap id="maceReqInpatientMap" type="com.basicauth.data.MaceReqInpatient">
        <result column="transaction_id" property="transactionId" jdbcType="INTEGER"/>
        <result column="macerequest_id" property="maceRequestId" jdbcType="INTEGER"/>
        <result column="request_from" property="requestFrom" jdbcType="VARCHAR"/>
        <result column="status" property="status" jdbcType="VARCHAR"/>
        <result column="status_remarks" property="statusRemarks" jdbcType="VARCHAR"/>
        <result column="approved_on" property="approvedOn" jdbcType="TIMESTAMP"/>
        <result column="approved_by" property="approvedBy" jdbcType="VARCHAR"/>
        <result column="approval_remarks" property="approvalRemarks" jdbcType="VARCHAR"/>
        <result column="disapproved_on" property="disapprovedOn" jdbcType="TIMESTAMP"/>
        <result column="disapproved_by" property="disapprovedBy" jdbcType="VARCHAR"/>
        <result column="disapproval_remarks" property="disapprovalRemarks" jdbcType="VARCHAR"/>
        <result column="disapproval_reason" property="disapprovalReason" jdbcType="VARCHAR"/>
        <result column="loa_no" property="loaNo" jdbcType="VARCHAR"/>
        <result column="validfrom" property="validfrom" jdbcType="DATE"/>
        <result column="validto" property="validto" jdbcType="DATE"/>
        <result column="admitted_on" property="admittedOn" jdbcType="TIMESTAMP"/>
        <result column="roomboard" property="roomboard" jdbcType="VARCHAR"/>
        <result column="room_no" property="roomNo" jdbcType="VARCHAR"/>
        <result column="roomrate_perday" property="roomratePerday" jdbcType="NUMERIC"/>
        <result column="record_submitted_on" property="recordSubmittedOn" jdbcType="TIMESTAMP"/>
        <result column="record_submitted_by" property="recordSubmittedBy" jdbcType="VARCHAR"/>
        <result column="ip_reason_remarks" property="ipReasonRemarks" jdbcType="VARCHAR"/>
        <result column="doc_hosp_id" property="docHospId" jdbcType="INTEGER"/>
        <result column="doctor_code" property="doctorCode" jdbcType="VARCHAR"/>
        <result column="hospital_code" property="hospitalCode" jdbcType="VARCHAR"/>
        <result column="estimated_cost" property="estimatedCost" jdbcType="NUMERIC"/>
        <result column="PrimaryDiagnosisId" property="primaryDiagnosisId" jdbcType="INTEGER"/>
        <result column="primary_diagnosis_icd_10" property="primaryDiagnosisIcd10" jdbcType="VARCHAR"/>
        <result column="primary_diagnosis_desc" property="primaryDiagnosisDesc" jdbcType="VARCHAR"/>
        <result column="disease_type" property="diseaseType" jdbcType="VARCHAR"/>
        <result column="dx_remarks" property="dxRemarks" jdbcType="VARCHAR"/>
        <result column="discharged_on" property="dischargedOn" jdbcType="TIMESTAMP"/>
        <result column="dischargeupdate_by" property="dischargeupdateBy" jdbcType="VARCHAR"/>
        <result column="lastupdate_on" property="lastupdateOn" jdbcType="TIMESTAMP"/>
        <result column="lastupdate_by" property="lastupdateBy" jdbcType="VARCHAR"/>
        <result column="pec_limit" property="pecLimit" jdbcType="VARCHAR"/>
        <result column="pec_remlimit" property="pecRemlimit" jdbcType="VARCHAR"/>
        <result column="dd_limit" property="ddLimit" jdbcType="VARCHAR"/>
        <result column="dd_remlimit" property="ddRemlimit" jdbcType="VARCHAR"/>
        <result column="disposition" property="disposition" jdbcType="VARCHAR"/>
        <result column="disp_remarks" property="dispRemarks" jdbcType="VARCHAR"/>
        <result column="trans_code" property="transCode" jdbcType="VARCHAR"/>
        <result column="request_code" property="requestCode" jdbcType="VARCHAR"/>
        <result column="HOSP_CONTACT" property="coorContact" jdbcType="VARCHAR"/>
        <result column="HOSP_EMAIL" property="coorEmail" jdbcType="VARCHAR"/>
        <result column="MEM_CONTACT" property="memContact" jdbcType="VARCHAR"/>
    </resultMap>

    <resultMap id="maceReqErMap" type="com.basicauth.domain.MaceReqEr">
        <result column="transaction_id" property="transactionId" jdbcType="INTEGER"/>
        <result column="macerequest_id" property="maceRequestId" jdbcType="INTEGER"/>
        <result column="request_from" property="requestFrom" jdbcType="VARCHAR"/>
        <result column="status" property="status" jdbcType="VARCHAR"/>
        <result column="status_remarks" property="statusRemarks" jdbcType="VARCHAR"/>
        <result column="approved_on" property="approvedOn" jdbcType="TIMESTAMP"/>
        <result column="approved_by" property="approvedBy" jdbcType="VARCHAR"/>
        <result column="approval_remarks" property="approvalRemarks" jdbcType="VARCHAR"/>
        <result column="disapproved_on" property="disapprovedOn" jdbcType="TIMESTAMP"/>
        <result column="disapproved_by" property="disapprovedBy" jdbcType="VARCHAR"/>
        <result column="disapproval_remarks" property="disapprovalRemarks" jdbcType="VARCHAR"/>
        <result column="disapproval_reason" property="disapprovalReason" jdbcType="VARCHAR"/>
        <result column="loa_no" property="loaNo" jdbcType="VARCHAR"/>
        <result column="validfrom" property="validfrom" jdbcType="TIMESTAMP"/>
        <result column="validto" property="validto" jdbcType="TIMESTAMP"/>
        <result column="admitted_on" property="admittedOn" jdbcType="TIMESTAMP"/>
        <result column="roomboard" property="roomboard" jdbcType="VARCHAR"/>
        <result column="room_no" property="roomNo" jdbcType="VARCHAR"/>
        <result column="roomrate_perday" property="roomratePerday" jdbcType="NUMERIC"/>
        <result column="record_submitted_on" property="recordSubmittedOn" jdbcType="TIMESTAMP"/>
        <result column="record_submitted_by" property="recordSubmittedBy" jdbcType="VARCHAR"/>
        <result column="er_reason_remarks" property="erReasonRemarks" jdbcType="VARCHAR"/>
        <result column="doc_hosp_id" property="docHospId" jdbcType="INTEGER"/>
        <result column="doctor_code" property="doctorCode" jdbcType="VARCHAR"/>
        <result column="hospital_code" property="hospitalCode" jdbcType="VARCHAR"/>
        <result column="estimated_cost" property="estimatedCost" jdbcType="NUMERIC"/>
        <result column="primary_diagnosis_code" property="primaryDiagnosisCode" jdbcType="VARCHAR"/>
        <result column="primary_diagnosis_icd_10" property="primaryDiagnosisIcd10" jdbcType="VARCHAR"/>
        <result column="primary_diagnosis_desc" property="primaryDiagnosisDesc" jdbcType="VARCHAR"/>
        <result column="disease_type" property="diseaseType" jdbcType="VARCHAR"/>
        <result column="dx_remarks" property="dxRemarks" jdbcType="VARCHAR"/>
        <result column="discharged_on" property="dischargedOn" jdbcType="TIMESTAMP"/>
        <result column="dischargeupdate_by" property="dischargeupdateBy" jdbcType="VARCHAR"/>
        <result column="lastupdate_on" property="lastupdateOn" jdbcType="TIMESTAMP"/>
        <result column="lastupdate_by" property="lastupdateBy" jdbcType="VARCHAR"/>
        <result column="pec_limit" property="pecLimit" jdbcType="VARCHAR"/>
        <result column="pec_remlimit" property="pecRemlimit" jdbcType="VARCHAR"/>
        <result column="dd_limit" property="ddLimit" jdbcType="VARCHAR"/>
        <result column="dd_remlimit" property="ddRemlimit" jdbcType="VARCHAR"/>
        <result column="disposition" property="disposition" jdbcType="VARCHAR"/>
        <result column="disp_remarks" property="dispRemarks" jdbcType="VARCHAR"/>
        <result column="trans_code" property="transCode" jdbcType="VARCHAR"/>
        <result column="request_code" property="requestCode" jdbcType="VARCHAR"/>
    </resultMap>

    <update id="updateMaceReqInpatient" flushCache="true">
        UPDATE MACEREQ_INPATIENT
        SET IP_REASON_REMARKS = #{mri.ipReasonRemarks, jdbcType=VARCHAR},
        LASTUPDATE_BY = #{mri.lastupdateBy, jdbcType=VARCHAR},
        LASTUPDATE_ON = #{mri.lastupdateOn, jdbcType=TIMESTAMP},
        PRIMARY_DIAGNOSIS_DESC = #{mri.primaryDiagnosisDesc, jdbcType=VARCHAR},
        DX_REMARKS = #{mri.dxRemarks, jdbcType=VARCHAR},
        DISEASE_TYPE = #{mri.diseaseType, jdbcType=VARCHAR},
        ROOM_NO = #{mri.roomNo, jdbcType=VARCHAR},
        DOCTOR_CODE = #{mri.doctorCode, jdbcType=VARCHAR},
        HOSPITAL_CODE = #{mri.hospitalCode, jdbcType=VARCHAR},
        ADMITTED_ON = #{mri.admittedOn, jdbcType=TIMESTAMP},
        DD_LIMIT = #{mri.ddLimit, jdbcType=NUMERIC},
        DISCHARGED_ON = #{mri.dischargedOn, jdbcType=TIMESTAMP},
        STATUS = #{mri.status, jdbcType=VARCHAR}
        WHERE
        MACEREQUEST_ID = #{mri.maceRequestId, jdbcType=INTEGER}
    </update>

    <update id="updateMaceReqEr" flushCache="true">
        UPDATE MACEREQ_ER
        SET
        STATUS = #{mrer.status, jdbcType=VARCHAR},
        STATUS_REMARKS = #{mrer.statusRemarks, jdbcType=VARCHAR},
        DISCHARGED_ON = #{mrer.dischargedOn, jdbcType=TIMESTAMP},
        DISCHARGEUPDATE_BY = #{mrer.dischargeupdateBy, jdbcType=VARCHAR},
        LASTUPDATE_BY = #{mrer.lastupdateBy, jdbcType=VARCHAR},
        LASTUPDATE_ON = #{mrer.lastupdateOn, jdbcType=TIMESTAMP}
        WHERE
        MACEREQUEST_ID = #{mrer.maceRequestId, jdbcType=INTEGER}
    </update>

    <select id="getMaceReqInpatientByReqId" resultMap="maceReqInpatientMap"
            resultType="com.basicauth.data.MaceReqInpatient">
        SELECT TOP 1 * FROM MACEREQ_INPATIENT WHERE MACEREQUEST_ID = #{requestId}
    </select>

    <resultMap id="maceReqIpDiagMap" type="com.basicauth.domain.MaceReqIpDiag">
        <result column="ip_reqdiag_id" property="ipReqdiagId" jdbcType="INTEGER"/>
        <result column="transaction_id" property="transactionId" jdbcType="INTEGER"/>
        <result column="macerequest_id" property="maceRequestId" jdbcType="INTEGER"/>
        <result column="diag_code" property="diagCode" jdbcType="VARCHAR"/>
        <result column="icd10_code" property="icd10Code" jdbcType="VARCHAR"/>
        <result column="icd10_class" property="icd10Class" jdbcType="VARCHAR"/>
        <result column="icd10_4c" property="icd104C" jdbcType="VARCHAR"/>
        <result column="diag_desc" property="diagDesc" jdbcType="VARCHAR"/>
        <result column="diag_type_old" property="diagTypeOld" jdbcType="VARCHAR"/>
        <result column="diag_type" property="diagType" jdbcType="VARCHAR"/>
        <result column="type_desc" property="typeDesc" jdbcType="VARCHAR"/>
        <result column="group_desc" property="procGroupDesc" jdbcType="VARCHAR"/>
        <result column="diag_class" property="diagClass" jdbcType="VARCHAR"/>
        <result column="diag_remarks" property="diagRemarks" jdbcType="VARCHAR"/>
        <result column="mace_diag_type" property="maceDiagType" jdbcType="VARCHAR"/>
        <result column="trans_code" property="transCode" jdbcType="VARCHAR"/>
        <result column="DATE_ADDED" property="dateAdded" jdbcType="TIMESTAMP"/>
        <result column="CreatedBy" property="createdBy" jdbcType="VARCHAR"/>
        <result column="CreatedDate" property="createdDate" jdbcType="TIMESTAMP"/>

    </resultMap>

    <update id="requestForDischargeIP">
        UPDATE MACEREQ_INPATIENT
        SET DISPOSITION = 'FOR DISCHARGE'
        WHERE MACEREQUEST_ID = #{requestId}
    </update>

    <delete id="deleteMaceReqIpDiag" flushCache="true">
        DELETE FROM MACE_REQ_IP_DIAG
        WHERE IP_REQDIAG_ID = #{ipReqDiagId}
    </delete>

    <select id="getMaceReqIpDiagByReqId" resultMap="maceReqIpDiagMap" resultType="java.util.List">
        SELECT A.*, B.RECORD_SUBMITTED_ON AS DATE_ADDED FROM MACE_REQ_IP_DIAG A JOIN MACEREQ_INPATIENT B
        ON A.TRANSACTION_ID = B.TRANSACTION_ID WHERE A.MACEREQUEST_ID = #{requestId}
    </select>

    <resultMap id="maceReqIpDoctorMap" type="com.basicauth.domain.MaceReqIpDoctor">
        <result column="ip_reqdoc_id" property="ipReqdocId" jdbcType="INTEGER"/>
        <result column="macerequest_id" property="maceRequestId" jdbcType="INTEGER"/>
        <result column="transaction_id" property="transactionId" jdbcType="INTEGER"/>
        <result column="doc_hosp_id" property="docHospId" jdbcType="INTEGER"/>
        <result column="doctor_code" property="doctorCode" jdbcType="VARCHAR"/>
        <result column="doc_lname" property="docLname" jdbcType="VARCHAR"/>
        <result column="doc_fname" property="docFname" jdbcType="VARCHAR"/>
        <result column="doc_mname" property="docMname" jdbcType="VARCHAR"/>
        <result column="isaccredited" property="isAccredited" jdbcType="BIT"/>
        <result column="hospital_code" property="hospitalCode" jdbcType="VARCHAR"/>
        <result column="hosp_prof_fee" property="hospProfFee" jdbcType="NUMERIC"/>
        <result column="def_prof_fee" property="defProfFee" jdbcType="NUMERIC"/>
        <result column="actual_prof_fee" property="actualProfFee" jdbcType="NUMERIC"/>
        <result column="ref_diagproc_id" property="refDiagProcId" jdbcType="INTEGER"/>
        <result column="mace_doctype" property="maceDoctype" jdbcType="VARCHAR"/>
        <result column="added_on" property="addedOn" jdbcType="TIMESTAMP"/>
        <result column="added_by" property="addedBy" jdbcType="VARCHAR"/>
        <result column="trans_code" property="transCode" jdbcType="VARCHAR"/>
        <result column="full_name" property="fullName" jdbcType="VARCHAR"/>
    </resultMap>

    <delete id="deleteMaceReqIpDoctor" flushCache="true">
        DELETE FROM MACE_REQ_IP_DOCTOR WHERE IP_REQDOC_ID = #{ipReqdocId}
    </delete>

    <select id="getMaceReqIpDoctors" resultMap="maceReqIpDoctorMap" resultType="java.util.List">
        SELECT * FROM MACE_REQ_IP_DOCTOR WHERE MACEREQUEST_ID = #{requestId}
    </select>

    <resultMap id="maceReqIpRoomMap" type="com.basicauth.domain.MaceReqIpRoom">
        <result column="ip_room_id" property="ipRoomId" jdbcType="INTEGER"/>
        <result column="macerequest_id" property="maceRequestId" jdbcType="INTEGER"/>
        <result column="transaction_id" property="transactionId" jdbcType="INTEGER"/>
        <result column="hospital_code" property="hospitalCode" jdbcType="NUMERIC"/>
        <result column="roomplan" property="roomplan" jdbcType="NUMERIC"/>
        <result column="roomtype" property="roomtype" jdbcType="NUMERIC"/>
        <result column="rate" property="rate" jdbcType="VARCHAR"/>
        <result column="date_from" property="dateFrom" jdbcType="VARCHAR"/>
        <result column="date_to" property="dateTo" jdbcType="INTEGER"/>
        <result column="added_on" property="addedOn" jdbcType="INTEGER"/>
        <result column="added_by" property="addedBy" jdbcType="INTEGER"/>
        <result column="last_update_on" property="lastUpdateOn" jdbcType="INTEGER"/>
        <result column="last_update_by" property="lastUpdateBy" jdbcType="INTEGER"/>
        <result column="trans_code" property="transCode" jdbcType="VARCHAR"/>
        <result column="ROOM_NO" property="roomNo" jdbcType="VARCHAR"/>
    </resultMap>

    <select id="getMaceReqIpRoom" resultMap="maceReqIpRoomMap" resultType="com.basicauth.domain.MaceReqIpRoom">
        SELECT TOP 1 * FROM mace_req_ip_room
        WHERE macerequest_id=#{maceRequestId}
        AND transaction_id=#{transactionId}
        ORDER BY ADDED_ON DESC
    </select>

    <select id="getLastReqCodeIp" resultMap="maceReqInpatientMap" resultType="com.basicauth.data.MaceReqInpatient">
            SELECT TOP 1 B.*, A.REQUEST_CODE FROM MACE_REQUEST A JOIN MACEREQ_INPATIENT B
            ON A.REQUEST_ID = B.MACEREQUEST_ID
            WHERE A.SERVICETYPE_ID = 4 AND A.MEMBER_CODE = #{memCode}
            AND B.APPROVED_ON IS NOT NULL
            ORDER BY APPROVED_ON DESC
    </select>

    <resultMap id="maceReqTestMap" type="com.basicauth.data.MaceRequestTest">
        <result column="transaction_id" property="transactionId" jdbcType="INTEGER"/>
        <result column="macerequest_id" property="maceRequestId" jdbcType="INTEGER"/>
        <result column="request_from" property="requestFrom" jdbcType="VARCHAR"/>
        <result column="status" property="status" jdbcType="VARCHAR"/>
        <result column="status_remarks" property="statusRemarks" jdbcType="VARCHAR"/>
        <result column="approved_on" property="approvedOn" jdbcType="TIMESTAMP"/>
        <result column="approved_by" property="approvedBy" jdbcType="VARCHAR"/>
        <result column="approval_remarks" property="approvalRemarks" jdbcType="VARCHAR"/>
        <result column="disapproved_on" property="disapprovedOn" jdbcType="TIMESTAMP"/>
        <result column="disapproved_by" property="disapprovedBy" jdbcType="VARCHAR"/>
        <result column="disapproval_remarks" property="disapprovalRemarks" jdbcType="VARCHAR"/>
        <result column="disapproval_reason" property="disapprovalReason" jdbcType="VARCHAR"/>
        <result column="approval_no" property="approvalNo" jdbcType="VARCHAR"/>
        <result column="validfrom" property="validFrom" jdbcType="TIMESTAMP"/>
        <result column="validto" property="validTo" jdbcType="TIMESTAMP"/>
        <result column="notes" property="notes" jdbcType="VARCHAR"/>
        <result column="expired_on" property="expiredOn" jdbcType="TIMESTAMP"/>
        <result column="consult_reason" property="consultReason" jdbcType="VARCHAR"/>
        <result column="doc_hosp_id" property="docHospId" jdbcType="INTEGER"/>
        <result column="doctor_code" property="doctorCode" jdbcType="VARCHAR"/>
        <result column="hospital_code" property="hospitalCode" jdbcType="VARCHAR"/>
        <result column="primary_diagnosis_code" property="primaryDiagnosisCode" jdbcType="VARCHAR"/>
        <result column="primary_diagnosis_icd_10" property="primaryDiagnosisICD10" jdbcType="VARCHAR"/>
        <result column="primary_diagnosis_desc" property="primaryDiagnosisDesc" jdbcType="VARCHAR"/>
        <result column="dx_remarks" property="dxRemarks" jdbcType="VARCHAR"/>
        <result column="avail_hosp_id" property="availHospId" jdbcType="VARCHAR"/>
        <result column="planofmanagement" property="planOfManagement" jdbcType="VARCHAR"/>
        <result column="transamount" property="transamount" jdbcType="NUMERIC"/>
        <result column="test_subtype" property="testSubtype" jdbcType="INTEGER"/>
        <result column="mace_testproc_group" property="maceTestGroup" jdbcType="VARCHAR"/>
        <result column="ref_requestid" property="refRequestId" jdbcType="INTEGER"/>
        <result column="ref_refno" property="refRefNo" jdbcType="VARCHAR"/>
        <result column="proc_desc" property="procDesc" jdbcType="VARCHAR"/>
        <result column="CostCenterDesc" property="costCenter" jdbcType="VARCHAR"/>
        <result column="TRANS_CODE" property="transCode" jdbcType="VARCHAR"/>
    </resultMap>

    <!--TODO Fix mapping Francis-->
    <!--<resultMap id="maceReqTestAttachmentMap" type="com.basicauth.data.MaceRequestAttachment">-->
    <!--<result column="transaction_id" property="transactionId" jdbcType="INTEGER"/>-->
    <!--<result column="macerequest_id" property="maceRequestId" jdbcType="INTEGER"/>-->
    <!--<result column="request_from" property="requestFrom" jdbcType="VARCHAR"/>-->
    <!--<result column="status" property="status" jdbcType="VARCHAR"/>-->
    <!--<result column="status_remarks" property="statusRemarks" jdbcType="VARCHAR"/>-->
    <!--<result column="approved_on" property="approvedOn" jdbcType="TIMESTAMP"/>-->
    <!--<result column="approved_by" property="approvedBy" jdbcType="VARCHAR"/>-->
    <!--<result column="approval_remarks" property="approvalRemarks" jdbcType="VARCHAR"/>-->
    <!--<result column="disapproved_on" property="disapprovedOn" jdbcType="TIMESTAMP"/>-->
    <!--<result column="disapproved_by" property="disapprovedBy" jdbcType="VARCHAR"/>-->
    <!--<result column="disapproval_remarks" property="disapprovalRemarks" jdbcType="VARCHAR"/>-->
    <!--<result column="disapproval_reason" property="disapprovalReason" jdbcType="VARCHAR"/>-->
    <!--<result column="approval_no" property="approvalNo" jdbcType="VARCHAR"/>-->
    <!--<result column="validfrom" property="validFrom" jdbcType="TIMESTAMP"/>-->
    <!--<result column="validto" property="validTo" jdbcType="TIMESTAMP"/>-->
    <!--<result column="notes" property="notes" jdbcType="VARCHAR"/>-->
    <!--<result column="expired_on" property="expiredOn" jdbcType="TIMESTAMP"/>-->
    <!--<result column="consult_reason" property="consultReason" jdbcType="VARCHAR"/>-->
    <!--<result column="doc_hosp_id" property="docHospId" jdbcType="INTEGER"/>-->
    <!--<result column="doctor_code" property="doctorCode" jdbcType="VARCHAR"/>-->
    <!--<result column="hospital_code" property="hospitalCode" jdbcType="VARCHAR"/>-->
    <!--<result column="primary_diagnosis_code" property="primaryDiagnosisCode" jdbcType="VARCHAR"/>-->
    <!--<result column="primary_diagnosis_icd_10" property="primaryDiagnosisICD10" jdbcType="VARCHAR"/>-->
    <!--<result column="primary_diagnosis_desc" property="primaryDiagnosisDesc" jdbcType="VARCHAR"/>-->
    <!--<result column="dx_remarks" property="dxRemarks" jdbcType="VARCHAR"/>-->
    <!--<result column="avail_hosp_id" property="availHospId" jdbcType="VARCHAR"/>-->
    <!--<result column="planofmanagement" property="planOfManagement" jdbcType="VARCHAR"/>-->
    <!--<result column="transamount" property="transamount" jdbcType="NUMERIC"/>-->
    <!--<result column="test_subtype" property="testSubtype" jdbcType="INTEGER"/>-->
    <!--<result column="mace_testproc_group" property="maceTestGroup" jdbcType="VARCHAR"/>-->
    <!--<result column="ref_requestid" property="refRequestId" jdbcType="INTEGER"/>-->
    <!--<result column="ref_refno" property="refRefNo" jdbcType="VARCHAR"/>-->
    <!--<result column="proc_desc" property="procDesc" jdbcType="VARCHAR"/>-->
    <!--<result column="CostCenter" property="costCenter" jdbcType="VARCHAR"/>-->
    <!--</resultMap>-->

    <select id="getMaceRequestTests" resultMap="maceReqTestMap" resultType="java.util.List">
        SELECT DISTINCT a.*, c.CostCenterDesc
        FROM (MACEREQ_TEST a
        INNER JOIN MACE_REQ_OP_TESTS b
        ON a.TRANSACTION_ID = b.TRANSACTION_ID)
        INNER JOIN [procedure] c
        ON b.ProcedureId = c.ProcedureId
        WHERE a.MACEREQUEST_ID = #{requestId}
    </select>

    <!--TODO FIX QUERY FRANCIS-->
    <!--<select id="getMaceRequestTestsForWithAttachment" resultMap="maceReqTestAttachmentMap" resultType="java.util.List">-->
    <!--SELECT DISTINCT a.*, b.proc_desc, c.CostCenter-->
    <!--FROM (MACEREQ_TEST a-->
    <!--INNER JOIN MACE_REQ_OP_TESTS b-->
    <!--ON a.TRANSACTION_ID = b.TRANSACTION_ID)-->
    <!--INNER JOIN vw_Diagnosis_TestProcedures c-->
    <!--ON b.proc_code = c.ProcedureCode-->
    <!--WHERE a.MACEREQUEST_ID = #{requestId}-->
    <!--</select>-->


    <resultMap id="maceRequestProcedureMap" type="com.basicauth.data.MaceRequestProcedure">
        <result column="transaction_id" property="transactionId" jdbcType="INTEGER"/>
        <result column="macerequest_id" property="maceRequestId" jdbcType="INTEGER"/>
        <result column="request_from" property="requestFrom" jdbcType="VARCHAR"/>
        <result column="status" property="status" jdbcType="VARCHAR"/>
        <result column="status_remarks" property="statusRemarks" jdbcType="VARCHAR"/>
        <result column="approved_on" property="approvedOn" jdbcType="TIMESTAMP"/>
        <result column="approved_by" property="approvedBy" jdbcType="VARCHAR"/>
        <result column="approval_remarks" property="approvalRemarks" jdbcType="VARCHAR"/>
        <result column="disapproved_on" property="disapprovedOn" jdbcType="TIMESTAMP"/>
        <result column="disapproved_by" property="disapprovedBy" jdbcType="VARCHAR"/>
        <result column="disapproval_remarks" property="disapprovalRemarks" jdbcType="VARCHAR"/>
        <result column="disapproval_reason" property="disapprovalReason" jdbcType="VARCHAR"/>
        <result column="approval_no" property="approvalNo" jdbcType="VARCHAR"/>
        <result column="validfrom" property="validFrom" jdbcType="TIMESTAMP"/>
        <result column="validto" property="validTo" jdbcType="TIMESTAMP"/>
        <result column="notes" property="notes" jdbcType="VARCHAR"/>
        <result column="expired_on" property="expiredOn" jdbcType="TIMESTAMP"/>
        <result column="consult_reason" property="consultReason" jdbcType="VARCHAR"/>
        <result column="doc_hosp_id" property="docHospId" jdbcType="INTEGER"/>
        <result column="doctor_code" property="doctorCode" jdbcType="VARCHAR"/>
        <result column="hospital_code" property="hospitalCode" jdbcType="VARCHAR"/>
        <result column="primary_diagnosis_code" property="primaryDiagnosisCode" jdbcType="VARCHAR"/>
        <result column="primary_diagnosis_icd_10" property="primaryDiagnosisICD10" jdbcType="VARCHAR"/>
        <result column="primary_diagnosis_desc" property="primaryDiagnosisDesc" jdbcType="VARCHAR"/>
        <result column="dx_remarks" property="dxRemarks" jdbcType="VARCHAR"/>
        <result column="avail_hosp_id" property="availHospId" jdbcType="VARCHAR"/>
        <result column="planonmanagement" property="planOfManagement" jdbcType="VARCHAR"/>
        <result column="TRANSAMOUNT" property="transamount" jdbcType="NUMERIC"/>
        <result column="test_subtype" property="testSubtype" jdbcType="INTEGER"/>
        <result column="mace_testgroup" property="maceTestGroup" jdbcType="VARCHAR"/>
        <result column="ref_requestid" property="refRequestId" jdbcType="INTEGER"/>
        <result column="ref_refno" property="refRefNo" jdbcType="VARCHAR"/>
        <result column="trans_code" property="transCode" jdbcType="VARCHAR"/>
        <result column="proc_desc" property="procDesc" jdbcType="VARCHAR"/>
        <result column="CostCenter" property="costCenter" jdbcType="VARCHAR"/>
    </resultMap>

    <select id="getMaceRequestProcedures" resultMap="maceRequestProcedureMap" resultType="java.util.List">
        SELECT DISTINCT a.*, b.proc_desc, c.CostCenterDesc
        FROM (MACEREQ_PROCEDURE a
        INNER JOIN MACE_REQ_OP_PROCEDURE b
        ON a.TRANSACTION_ID = b.TRANSACTION_ID)
        INNER JOIN "PROCEDURE" c
        ON b.ProcedureId = c.ProcedureId
        WHERE a.MACEREQUEST_ID = #{requestId}
    </select>

    <resultMap id="maceReqOpDiagMap" type="com.basicauth.data.MaceRequestOpDiag">
        <result column="reqdiag_id" property="reqDiagId" jdbcType="INTEGER"/>
        <result column="macerequest_id" property="maceRequestId" jdbcType="INTEGER"/>
        <result column="transaction_id" property="transactionId" jdbcType="INTEGER"/>
        <result column="diag_code" property="diagCode" jdbcType="VARCHAR"/>
        <result column="icd10_code" property="icd10Code" jdbcType="VARCHAR"/>
        <result column="icd10_class" property="icd10Class" jdbcType="VARCHAR"/>
        <result column="icd10_4c" property="icd104C" jdbcType="VARCHAR"/>
        <result column="diag_desc" property="diagDesc" jdbcType="VARCHAR"/>
        <result column="diag_type_old" property="diagTypeOld" jdbcType="VARCHAR"/>
        <result column="diag_type" property="diagType" jdbcType="VARCHAR"/>
        <result column="DIAG_CASETYPE" property="diagCaseType" jdbcType="VARCHAR"/>
        <result column="type_desc" property="typeDesc" jdbcType="VARCHAR"/>
        <result column="group_desc" property="groupDesc" jdbcType="VARCHAR"/>
        <result column="diag_class" property="diagClass" jdbcType="VARCHAR"/>
        <result column="diag_remarks" property="diagRemarks" jdbcType="VARCHAR"/>
        <result column="mace_diag_type" property="maceDiagType" jdbcType="VARCHAR"/>
        <result column="TRANS_CODE" property="transCode" jdbcType="VARCHAR"/>
    </resultMap>

    <select id="getMaceReqOpDiagByTransId" resultMap="maceReqOpDiagMap" resultType="java.util.List">
        SELECT * FROM MACE_REQ_OP_DIAG WHERE TRANSACTION_ID = #{transId}
        ORDER BY MACE_SUBTYPE ASC
    </select>

    <resultMap id="lastUpdateMap" type="com.basicauth.data.LastUpdatesCoor">
        <result column="list_type" property="listType" jdbcType="VARCHAR"/>
        <result column="last_update" property="lastUpdateDate" jdbcType="DATE"/>
    </resultMap>

    <select id="getLastUpdatesOnTables" resultMap="lastUpdateMap" resultType="java.util.List">
        SELECT * FROM COOR_TABLE_UPDATES
    </select>

    <select id="getMaceReqOpDiagByTestTransactionId" resultMap="maceReqOpDiagMap"
            resultType="com.basicauth.data.MaceRequestOpDiag">
        SELECT TOP 1 * FROM MACE_REQ_OP_DIAG WHERE TRANSACTION_ID = #{transId}
    </select>

    <select id="getMaceReqOpDiagByMaceReqId" resultMap="maceReqOpDiagMap" resultType="java.util.List">
        SELECT * FROM MACE_REQ_OP_DIAG WHERE MACEREQUEST_ID = #{requestId}
    </select>

    <resultMap id="maceConsPrescribedtestMap" type="com.basicauth.domain.dups.MaceConsPrescribedtest">
        <result column="PRESCRIBEDTEST_ID" property="prescribedtestId" jdbcType="INTEGER"/>
        <result column="REQDIAG_ID" property="reqdiagId" jdbcType="INTEGER"/>
        <result column="MACEREQUEST_ID" property="macerequestId" jdbcType="INTEGER"/>
        <result column="CONS_TRANSACTION_ID" property="consTransactionId" jdbcType="INTEGER"/>
        <result column="ProcedureId" property="procedureId" jdbcType="VARCHAR"/>
        <result column="PROC_DESC" property="procDesc" jdbcType="VARCHAR"/>
        <result column="GROUP" property="group" jdbcType="VARCHAR"/>
        <result column="PROC_TYPE" property="procType" jdbcType="VARCHAR"/>
        <result column="PROC_TYPEDESC" property="procTypedesc" jdbcType="VARCHAR"/>
        <result column="PROC_CLASS" property="procClass" jdbcType="VARCHAR"/>
        <result column="PROC_CLASSDESC" property="procClassdesc" jdbcType="VARCHAR"/>
        <result column="APPROVAL_TYPE_ID" property="approvalTypeId" jdbcType="INTEGER"/>
        <result column="APPROVAL_TYPE" property="approvalType" jdbcType="VARCHAR"/>
        <result column="COST_CENTER_ID" property="costCenterId" jdbcType="INTEGER"/>
        <result column="COST_CENTER" property="costCenter" jdbcType="VARCHAR"/>
        <result column="STATUS" property="status" jdbcType="INTEGER"/>
        <result column="MACE_SUBTYPE" property="maceSubtype" jdbcType="INTEGER"/>
    </resultMap>

    <insert id="saveMacePrescribedTest" flushCache="true">
        INSERT INTO MACE_CONS_PRESCRIBEDTEST
        (REQDIAG_ID
        , MACEREQUEST_ID
        , CONS_TRANSACTION_ID
        , ProcedureId
        , PROC_DESC
        , "GROUP"
        , PROC_TYPE
        , PROC_TYPEDESC
        , PROC_CLASS
        , PROC_CLASSDESC
        , APPROVAL_TYPE_ID
        , APPROVAL_TYPE
        , COST_CENTER_ID
        , COST_CENTER
        , STATUS
        , MACE_SUBTYPE)
        VALUES(
        #{mcpt.reqdiagId, jdbcType=INTEGER},
        #{mcpt.macerequestId, jdbcType=INTEGER},
        #{mcpt.consTransactionId, jdbcType=INTEGER},
        #{mcpt.procedureId, jdbcType=INTEGER},
        #{mcpt.procDesc, jdbcType=VARCHAR},
        #{mcpt.group, jdbcType=VARCHAR},
        #{mcpt.procType, jdbcType=VARCHAR},
        #{mcpt.procTypedesc, jdbcType=VARCHAR},
        #{mcpt.procClass, jdbcType=VARCHAR},
        #{mcpt.procClassdesc, jdbcType=VARCHAR},
        #{mcpt.approvalTypeId, jdbcType=INTEGER},
        #{mcpt.approvalType, jdbcType=VARCHAR},
        #{mcpt.costCenterId, jdbcType=INTEGER},
        #{mcpt.costCenter, jdbcType=VARCHAR},
        #{mcpt.status, jdbcType=INTEGER},
        #{mcpt.maceSubtype, jdbcType=INTEGER}
        )
    </insert>

    <resultMap id="MacePrescribedTest" type="com.basicauth.domain.MacePrescribedTest">
        <result property="procedureCode" column="ProcedureCode" jdbcType="VARCHAR"/>
        <result property="procedureDesc" column="ProcedureName" jdbcType="VARCHAR"/>
        <result property="amount" column="Amount" jdbcType="NUMERIC"/>
        <result property="approvalType" column="ApprovalType" jdbcType="VARCHAR"/>
        <result property="procedureGroup" column="ProcedureGroup" jdbcType="VARCHAR"/>
    </resultMap>

    <select id="getPrescribedTest" resultMap="MacePrescribedTest" resultType="com.basicauth.domain.MacePrescribedTest">
        SELECT TOP 1 ProcedureCode, ProcedureName, Amount, ApprovalType, ProcedureGroup
        FROM vw_Diagnosis_Procedures
        WHERE ProcedureCode = #{procedureCode}
    </select>

    <resultMap id="MacePrescribedProcedure" type="com.basicauth.domain.MacePrescribedProcedure">
        <result property="procedureCode" column="ProcedureID" jdbcType="VARCHAR"/>
        <result property="procedureDesc" column="ProcedureName" jdbcType="VARCHAR"/>
        <result property="amount" column="Amount" jdbcType="NUMERIC"/>
        <result property="approvalType" column="ApprovalType" jdbcType="VARCHAR"/>
        <result property="proclassCode" column="Proclass_Code" jdbcType="VARCHAR"/>
    </resultMap>

    <select id="getPrescribedProcedure" resultMap="MacePrescribedProcedure"
            resultType="com.basicauth.domain.MacePrescribedProcedure">
        SELECT TOP 1 ProcedureID, ProcedureName, Amount, ApprovalType, Proclass_Code
        FROM vw_Diagnosis_ClinicProcedures
        WHERE ProcedureID = #{procedureCode}
    </select>

    <resultMap id="maceReqOpTestMap" type="com.basicauth.data.MaceRequestOpTest">
        <result column="DIAGTEST_ID" property="diagTestId" jdbcType="INTEGER"/>
        <result column="REQDIAG_ID" property="reqDiagId" jdbcType="INTEGER"/>
        <result column="MACEREQUEST_ID" property="maceRequestId" jdbcType="INTEGER"/>
        <result column="PRESCRIBEDTEST_ID" property="prescribedTestId" jdbcType="INTEGER"/>
        <result column="TRANSACTION_ID" property="transactionId" jdbcType="INTEGER"/>
        <result column="REF_DIAGPROC_ID" property="refDiagProcId" jdbcType="INTEGER"/>
        <result column="DIAG_CODE" property="diagCode" jdbcType="INTEGER"/>
        <result column="PROC_CODE" property="procCode" jdbcType="INTEGER"/>
        <result column="PROC_DESC" property="procDesc" jdbcType="VARCHAR"/>
        <result column="RUV" property="ruv" jdbcType="VARCHAR"/>
        <result column="SESSION" property="session" jdbcType="VARCHAR"/>
        <result column="AREA" property="area" jdbcType="VARCHAR"/>
        <result column="PROC_HOSPAMOUNT" property="procHospAmount" jdbcType="VARCHAR"/>
        <result column="PROC_DEFAMOUNT" property="procDefAmount" jdbcType="VARCHAR"/>
        <result column="PROC_ACTUALAMOUNT" property="procActualAmount" jdbcType="VARCHAR"/>
        <result column="GROUP" property="group" jdbcType="VARCHAR"/>
        <result column="PROC_TYPE" property="procType" jdbcType="VARCHAR"/>
        <result column="PROC_TYPEDESC" property="procTypeDesc" jdbcType="VARCHAR"/>
        <result column="PROC_CLASS" property="procClass" jdbcType="VARCHAR"/>
        <result column="PROC_CLASSDESC" property="procClassDesc" jdbcType="VARCHAR"/>
        <result column="REMARKS" property="remarks" jdbcType="VARCHAR"/>
        <result column="STATUS" property="status" jdbcType="VARCHAR"/>
        <result column="MACE_SUBTYPE" property="maceSubtype" jdbcType="VARCHAR"/>
        <result column="TRANS_CODE" property="transCode" jdbcType="VARCHAR"/>
    </resultMap>

    <select id="getMaceReqOpTestsByMaceReqIdAndApprovalNo" resultMap="maceReqOpTestMap" resultType="java.util.List">
        SELECT * FROM MACE_REQ_OP_TESTS WHERE TRANSACTION_ID IN (SELECT TRANSACTION_ID FROM MACEREQ_TEST WHERE
        MACEREQUEST_ID = #{requestId} AND APPROVAL_NO = #{approvalNo})
    </select>

    <select id="getMaceRequestTestsMrIdAndDiagCode" resultMap="maceReqTestMap" resultType="java.util.List">
        SELECT * FROM MACEREQ_TEST WHERE TRANSACTION_ID IN (SELECT TRANSACTION_ID FROM MACE_REQ_OP_DIAG WHERE
        MACEREQUEST_ID = #{requestId} AND DIAG_CODE = #{diagCode})
    </select>

    <select id="getMaceReqOpTestByTestTransId" resultMap="maceReqOpTestMap"
            resultType="com.basicauth.data.MaceRequestOpTest">
        SELECT TOP 1 * FROM MACE_REQ_OP_TESTS WHERE REQDIAG_ID =
        (SELECT TOP 1 REQDIAG_ID FROM MACE_REQ_OP_DIAG B WHERE B.TRANSACTION_ID = #{transId})
    </select>

    <select id="getMaceReqOpTestByReqDiagId" resultMap="maceReqOpTestMap" resultType="java.util.List">
        SELECT * FROM MACE_REQ_OP_TESTS WHERE REQDIAG_ID = #{reqdiagId}
    </select>

    <select id="getMaceReqOpTestsByMaceReqId" resultMap="maceReqOpTestMap" resultType="java.util.List">
        SELECT * FROM MACE_REQ_OP_TESTS WHERE MACEREQUEST_ID = #{requestId}
    </select>

    <resultMap id="maceReqOpProcedureMap" type="com.basicauth.data.MaceRequestOpProcedure">
        <result column="DIAGPROC_ID" property="diagProcId" jdbcType="INTEGER"/>
        <result column="REQDIAG_ID" property="reqDiagId" jdbcType="INTEGER"/>
        <result column="MACEREQUEST_ID" property="maceRequestId" jdbcType="INTEGER"/>
        <result column="PRESCRIBEDTEST_ID" property="prescribedTestId" jdbcType="INTEGER"/>
        <result column="TRANSACTION_ID" property="transactionId" jdbcType="INTEGER"/>
        <result column="REF_DIAGPROC_ID" property="refDiagProcId" jdbcType="VARCHAR"/>
        <result column="DIAG_CODE" property="diagCode" jdbcType="VARCHAR"/>
        <result column="PROC_CODE" property="procCode" jdbcType="VARCHAR"/>
        <result column="PROC_DESC" property="procDesc" jdbcType="VARCHAR"/>
        <result column="RUV" property="ruv" jdbcType="VARCHAR"/>
        <result column="SESSION" property="area" jdbcType="VARCHAR"/>
        <result column="AREA" property="area" jdbcType="VARCHAR"/>
        <result column="PROC_HOSPAMOUNT" property="procHospAmount" jdbcType="DECIMAL"/>
        <result column="PROC_DEFAMOUNT" property="procDefAmount" jdbcType="DECIMAL"/>
        <result column="PROC_ACTUALAMOUNT" property="procActualAmount" jdbcType="DECIMAL"/>
        <result column="GROUP" property="group" jdbcType="VARCHAR"/>
        <result column="PROC_TYPE" property="procType" jdbcType="VARCHAR"/>
        <result column="PROC_TYPEDESC" property="procTypeDesc" jdbcType="VARCHAR"/>
        <result column="PROC_CLASS" property="procClass" jdbcType="VARCHAR"/>
        <result column="PROC_CLASSDESC" property="procClassDesc" jdbcType="VARCHAR"/>
        <result column="REMARKS" property="remarks" jdbcType="VARCHAR"/>
        <result column="STATUS" property="status" jdbcType="VARCHAR"/>
        <result column="MACE_SUBTYPE" property="maceSubtype" jdbcType="VARCHAR"/>
        <result column="TRANS_CODE" property="transCode" jdbcType="VARCHAR"/>
    </resultMap>

    <select id="getMaceReqOpProcedureByProcedureTransId" resultMap="maceReqOpProcedureMap"
            resultType="com.basicauth.data.MaceRequestOpProcedure">
        SELECT TOP 1 * FROM MACE_REQ_OP_PROCEDURE WHERE REQDIAG_ID =
        (SELECT TOP 1 REQDIAG_ID FROM MACE_REQ_OP_DIAG B WHERE B.TRANSACTION_ID = #{transId})
    </select>

    <select id="getMaceReqOpProcByReqDiagId" resultMap="maceReqOpProcedureMap"
            resultType="com.basicauth.data.MaceRequestOpProcedure">
        SELECT TOP 1 * FROM MACE_REQ_OP_PROCEDURE WHERE REQDIAG_ID = #{reqDiagId}
    </select>

    <select id="getMaceReqOpProcByMaceReqId" resultMap="maceReqOpProcedureMap" resultType="java.util.List">
        SELECT * FROM MACE_REQ_OP_PROCEDURE WHERE MACEREQUEST_ID = #{requestId}
    </select>

    <resultMap id="maceReqIpOtherServicesMap" type="com.basicauth.domain.MaceReqIpOtherservices">
        <result column="otherservice_id" property="otherserviceId" jdbcType="INTEGER"/>
        <result column="macerequest_id" property="maceRequestId" jdbcType="INTEGER"/>
        <result column="transaction_id" property="transactionId" jdbcType="INTEGER"/>
        <result column="service_hospamount" property="serviceHospamount" jdbcType="NUMERIC"/>
        <result column="service_defamount" property="serviceDefamount" jdbcType="NUMERIC"/>
        <result column="service_actualamount" property="serviceActualamount" jdbcType="NUMERIC"/>
        <result column="service_type" property="serviceType" jdbcType="VARCHAR"/>
        <result column="remarks" property="remarks" jdbcType="VARCHAR"/>
        <result column="status" property="status" jdbcType="INTEGER"/>
    </resultMap>

    <select id="getMaceReqIpServices" resultMap="maceReqIpOtherServicesMap" resultType="java.util.List">
        SELECT * FROM MACE_REQ_IP_OTHERSERVICES WHERE MACEREQUEST_ID = #{requestId}
    </select>

    <resultMap id="maceReqIpDiagProcMap" type="com.basicauth.domain.MaceReqIpDiagproc">
        <result column="ip_reqdiag_id" property="ipReqdiagprocId" jdbcType="INTEGER"/>
        <result column="reqdiag_id" property="reqDiagId" jdbcType="INTEGER"/>
        <result column="macerequest_id" property="maceRequestId" jdbcType="INTEGER"/>
        <result column="transaction_id" property="transactionId" jdbcType="INTEGER"/>
        <result column="proc_code" property="procCode" jdbcType="VARCHAR"/>
        <result column="proc_desc" property="procDesc" jdbcType="VARCHAR"/>
        <result column="ruv" property="ruv" jdbcType="VARCHAR"/>
        <result column="hosp_amount" property="hospAmount" jdbcType="NUMERIC"/>
        <result column="def_amount" property="defAmount" jdbcType="NUMERIC"/>
        <result column="actual_amount" property="actualAmount" jdbcType="NUMERIC"/>
        <result column="proc_group" property="procGroup" jdbcType="VARCHAR"/>
        <result column="proc_type" property="procType" jdbcType="VARCHAR"/>
        <result column="proc_typedesc" property="procTypedesc" jdbcType="VARCHAR"/>
        <result column="proc_class" property="procClass" jdbcType="VARCHAR"/>
        <result column="proc_classdesc" property="procClassdesc" jdbcType="VARCHAR"/>
        <result column="remarks" property="remarks" jdbcType="VARCHAR"/>
        <result column="status" property="status" jdbcType="INTEGER"/>
        <result column="mace_subtype" property="maceSubtype" jdbcType="INTEGER"/>
        <result column="covered" property="covered" jdbcType="INTEGER"/>
        <result column="trans_code" property="transCode" jdbcType="VARCHAR"/>
        <result column="createdBy" property="createdBy" jdbcType="VARCHAR"/>
        <result column="createdDate" property="createdDate" jdbcType="TIMESTAMP"/>
    </resultMap>

    <delete id="deleteMaceReqIpDiagproc" flushCache="true">
        DELETE FROM MACE_REQ_IP_DIAGPROC WHERE IP_REQDIAGPROC_ID = #{reqDiagId}
    </delete>

    <select id="getMaceReqIpDiagProcs" resultType="java.util.List" resultMap="maceReqIpDiagProcMap">
        SELECT A.*, B.RECORD_SUBMITTED_ON AS DATE_ADDED FROM MACE_REQ_IP_DIAGPROC A JOIN MACEREQ_INPATIENT B ON A.TRANSACTION_ID = B.TRANSACTION_ID WHERE A.MACEREQUEST_ID = #{requestId}
    </select>

    <resultMap id="maceConfigMap" type="com.basicauth.data.MaceConfig">
        <result column="ID" property="id" jdbcType="INTEGER"/>
        <result column="KEY_1" property="key1" jdbcType="VARCHAR"/>
        <result column="KEY_2" property="key2" jdbcType="VARCHAR"/>
        <result column="KEY_3" property="key3" jdbcType="VARCHAR"/>
        <result column="VALUE_TYPE" property="valueType" jdbcType="VARCHAR"/>
        <result column="VALUE_CONTENTS" property="valueContents" jdbcType="VARCHAR"/>
    </resultMap>

    <select id="getMaceConfigObjects" resultType="java.util.List" resultMap="maceConfigMap">
        SELECT          *
        FROM            MACE_CONFIG
        WHERE           VALUE_TYPE = #{valueType}
    </select>

    <resultMap id="approvalRulesDaoMap" type="com.basicauth.data.ApprovalRulesDao">
        <result column="APPROVAL_RULE_NAME" property="approvalRuleName" jdbcType="VARCHAR"/>
        <result column="JAVA_CLASS_NAME" property="javaClassName" jdbcType="VARCHAR"/>
        <result column="DESCRIPTION" property="description" jdbcType="VARCHAR"/>
    </resultMap>

    <select id="getApprovalRules" resultType="java.util.List" resultMap="approvalRulesDaoMap">
        SELECT approvalrule.APPROVAL_RULE_NAME, approvalrule.JAVA_CLASS_NAME, approvalrule.DESCRIPTION
        FROM MACE_APPRV_RULES approvalrule
        INNER JOIN MACE_APPRV_RULE_MAPPING rulemap
        ON approvalrule.JAVA_CLASS_NAME = rulemap.APPROVAL_RULE_CLASS_NAME
        WHERE rulemap.MACE_SERVICETYPE_ID = #{serviceTypeId}
        <if test="subtypeId != null and subtypeId > 0">
            AND rulemap.MACE_SUBTYPE_ID = #{subtypeId}
        </if>
        ORDER BY JAVA_CLASS_NAME
    </select>

    <insert id="saveMaceRequestApprovalLog" parameterType="com.basicauth.data.MaceRequestApproval"
            useGeneratedKeys="true" keyProperty="mra.id" keyColumn="ID" flushCache="true">
        INSERT INTO MACE_REQUEST_APPROVALS (
        APPROVAL_RULE_CLASS_NAME
        ,REQUEST_ID
        ,TRANSACTION_ID
        ,TRANS_CODE
        ,ProcedureId
        ,RUN_ON
        ,RUN_BY
        ,RESULT_STATUS
        ,RESULT_ASSIGNEE
        ,RESULT_REASON_MESSAGE
        )
        VALUES(
        #{mra.approvalRuleClassName, jdbcType=VARCHAR},
        #{mra.requestId, jdbcType=INTEGER},
        #{mra.transactionId, jdbcType=INTEGER},
        #{mra.transCode, jdbcType=VARCHAR},
        #{mra.procedureId, jdbcType=INTEGER},
        #{mra.runOn, jdbcType=TIMESTAMP},
        #{mra.runBy, jdbcType=VARCHAR},
        #{mra.resultStatus, jdbcType=VARCHAR},
        #{mra.resultAssignee, jdbcType=VARCHAR},
        #{mra.resultReasonMessage, jdbcType=VARCHAR}
        )
    </insert>

    <resultMap id="specialDiagnosisMap" type="com.basicauth.data.SpecialDiagnosis">
        <result column="ID" property="id" jdbcType="NUMERIC"/>
        <result column="DIAG_CODE" property="diagCode" jdbcType="VARCHAR"/>
        <result column="DIAG_DESC" property="diagDesc" jdbcType="VARCHAR"/>
        <result column="APPROVAL_RULE_ID" property="approvalRuleId" jdbcType="NUMERIC"/>
        <result column="APPRV_RULE_CLASS_NAME" property="approvalRuleClassName" jdbcType="VARCHAR"/>
    </resultMap>

    <select id="getSpecialDiagnosis" resultType="java.util.List" resultMap="specialDiagnosisMap">
        SELECT          TOP 1 *
        FROM            MACE_CM_SPECDIAG
        WHERE           DIAG_CODE = #{diagCode, jdbcType=VARCHAR}
    </select>
    <select id="getLastReqCodeEr" resultMap="maceReqErMap" resultType="com.basicauth.domain.MaceReqEr">
        SELECT TOP 1 B.*, A.REQUEST_CODE FROM MACE_REQUEST A JOIN MACEREQ_ER B
            ON A.REQUEST_ID = B.MACEREQUEST_ID
            WHERE A.SERVICETYPE_ID = 5 AND A.MEMBER_CODE = #{memCode}
            AND B.APPROVED_ON IS NOT NULL
            ORDER BY APPROVED_ON DESC
    </select>

    <insert id="saveMaceRequestER" parameterType="com.basicauth.domain.MaceReqEr"
            useGeneratedKeys="true" keyProperty="mrer.transactionId" keyColumn="transaction_id">
        INSERT INTO MACEREQ_ER (
        MACEREQUEST_ID,
        REQUEST_FROM,
        STATUS,
        STATUS_REMARKS,
        APPROVED_ON,
        APPROVED_BY,
        APPROVAL_REMARKS,
        DISAPPROVED_ON,
        DISAPPROVED_BY,
        DISAPPROVAL_REMARKS,
        DISAPPROVAL_REASON,
        LOA_NO,
        ADMITTED_ON,
        ROOMBOARD,
        ROOM_NO,
        ROOMRATE_PERDAY,
        RECORD_SUBMITTED_ON,
        RECORD_SUBMITTED_BY,
        ER_REASON_REMARKS,
        DOC_HOSP_ID,
        DOCTOR_CODE,
        HOSPITAL_CODE,
        ESTIMATED_COST,
        PRIMARY_DIAGNOSIS_ICD10,
        PRIMARY_DIAGNOSIS_DESC,
        DX_REMARKS,
        DISCHARGED_ON,
        DISCHARGEUPDATE_BY,
        LASTUPDATE_ON,
        LASTUPDATE_BY,
        PEC_LIMIT,
        PEC_REMLIMIT,
        DD_LIMIT,
        DD_REMLIMIT,
        DISPOSITION,
        DISP_REMARKS,
        TRANS_CODE,
        PrimaryDiagnosisId
        ) VALUES (
        #{mrer.maceRequestId, jdbcType=INTEGER},
        #{mrer.requestFrom, jdbcType=VARCHAR},
        #{mrer.status, jdbcType=VARCHAR},
        #{mrer.statusRemarks, jdbcType=VARCHAR},
        #{mrer.approvedOn, jdbcType=TIMESTAMP},
        #{mrer.approvedBy, jdbcType=VARCHAR},
        #{mrer.approvalRemarks, jdbcType=VARCHAR},
        #{mrer.disapprovedOn, jdbcType=TIMESTAMP},
        #{mrer.disapprovedBy, jdbcType=VARCHAR},
        #{mrer.disapprovalRemarks, jdbcType=VARCHAR},
        #{mrer.disapprovalReason, jdbcType=VARCHAR},
        #{mrer.loaNo, jdbcType=VARCHAR},
        #{mrer.admittedOn, jdbcType=TIMESTAMP},
        #{mrer.roomboard, jdbcType=VARCHAR},
        #{mrer.roomNo, jdbcType=VARCHAR},
        #{mrer.roomratePerday, jdbcType=NUMERIC},
        #{mrer.recordSubmittedOn, jdbcType=TIMESTAMP},
        #{mrer.recordSubmittedBy, jdbcType=VARCHAR},
        #{mrer.erReasonRemarks, jdbcType=VARCHAR},
        #{mrer.docHospId, jdbcType=VARCHAR},
        #{mrer.doctorCode, jdbcType=VARCHAR},
        #{mrer.hospitalCode, jdbcType=VARCHAR},
        #{mrer.estimatedCost, jdbcType=NUMERIC},
        #{mrer.primaryDiagnosisIcd10, jdbcType=VARCHAR},
        #{mrer.primaryDiagnosisDesc, jdbcType=VARCHAR},
        #{mrer.dxRemarks, jdbcType=VARCHAR},
        #{mrer.dischargedOn, jdbcType=TIMESTAMP},
        #{mrer.dischargeupdateBy, jdbcType=VARCHAR},
        #{mrer.lastupdateOn, jdbcType=TIMESTAMP},
        #{mrer.lastupdateBy, jdbcType=VARCHAR},
        #{mrer.pecLimit, jdbcType=VARCHAR},
        #{mrer.pecRemlimit, jdbcType=VARCHAR},
        #{mrer.ddLimit, jdbcType=VARCHAR},
        #{mrer.ddRemlimit, jdbcType=VARCHAR},
        #{mrer.disposition, jdbcType=VARCHAR},
        #{mrer.dispRemarks, jdbcType=VARCHAR},
        #{mrer.transCode, jdbcType=VARCHAR},
        #{mrer.primaryDiagnosisId, jdbcType=VARCHAR}
        )
    </insert>
    <insert id="addClaim">
        INSERT INTO MACE_CLAIMS(
        LOA_NUMBER,
        CONTROL_CODE,
        MEMBER_CODE,
        MEMBER_NAME,
        VISIT_DATE,
        MEM_TYPE,
        SA_AMOUNT,
        DISAPPROVED,
        ADVANCES,
        ERC,
        APPROVED,
        TYPE,
        STATUS,
        SUBMITTED_BY,
        DATE_SUBMITTED,
        DATE_RECIEVED,
        HOSPITAL_CLINIC,
        DUE_DATE
        )VALUES(
        #{claim.loaNumber, jdbcType=VARCHAR},
        #{claim.controlCode, jdbcType=VARCHAR},
        #{claim.memberCode, jdbcType=VARCHAR},
        #{claim.memberName, jdbcType=VARCHAR},
        #{claim.visitDate, jdbcType=TIMESTAMP},
        #{claim.memType, jdbcType=VARCHAR},
        #{claim.saAmount, jdbcType=NUMERIC},
        #{claim.disapproved, jdbcType=NUMERIC},
        #{claim.advances, jdbcType=NUMERIC},
        #{claim.erc, jdbcType=NUMERIC},
        #{claim.approved, jdbcType=NUMERIC},
        #{claim.type, jdbcType=VARCHAR},
        #{claim.status, jdbcType=VARCHAR},
        #{claim.submittedBy, jdbcType=VARCHAR},
        #{claim.dateSubmitted, jdbcType=TIMESTAMP},
        #{claim.dateRecieved, jdbcType=TIMESTAMP},
        #{claim.hospitalClinic, jdbcType=VARCHAR},
        #{claim.dueDate, jdbcType=VARCHAR}
        )
    </insert>
    <insert id="saveAdditionIPHeader" parameterType="com.basicauth.domain.MaceInpatientJson"
            useGeneratedKeys="true" keyProperty="iaj.tempHeader" keyColumn="id">
        INSERT INTO MACE_IP_ADD_HEADER(remarks, coorContact, coorEmail, memberContact,
        maceRequestId, status, createdOn, createdBy,
        roomCategory, roomNumber, roomRate, lengthOfStay, dateFrom)
        VALUES(
        #{iaj.remarks, jdbcType=VARCHAR},
        #{iaj.coorContact, jdbcType=VARCHAR},
        #{iaj.coorEmail, jdbcType=VARCHAR},
        #{iaj.memberContact, jdbcType=VARCHAR},
        #{iaj.maceRequestId, jdbcType=INTEGER},
        #{iaj.status, jdbcType=VARCHAR},
        GETDATE(),
        #{iaj.appUsername, jdbcType=VARCHAR},
        #{iaj.category, jdbcType=VARCHAR},
        #{iaj.roomNo, jdbcType=VARCHAR},
        #{iaj.roomRate, jdbcType=NUMERIC},
        #{iaj.lengthOfStay, jdbcType=VARCHAR},
        #{iaj.dateFrom, jdbcType=TIMESTAMP}
        )
    </insert>

    <select id="getMaceRequestByRequestId" resultMap="maceRequestMap" resultType="com.basicauth.data.MaceRequest">
        SELECT TOP 1 * FROM MACE_REQUEST WHERE REQUEST_ID = #{requestId}
    </select>

    <select id="getMaceRequestErByRequestId" resultMap="maceReqErMap" resultType="com.basicauth.domain.MaceReqEr">
        SELECT TOP 1 * FROM MACEREQ_ER WHERE MACEREQUEST_ID= #{requestId}
    </select>

    <select id="checkForDuplicateConsult" resultType="java.lang.Boolean">
        SELECT CAST(
        CASE WHEN EXISTS(
        SELECT MACEREQUEST_ID FROM MACEREQ_CONSULT WHERE
        MACEREQUEST_ID IN
        (SELECT REQUEST_ID FROM MACE_REQUEST
        WHERE MEMBER_CODE = #{cj.memberCode, jdbcType=VARCHAR}
        AND REQUEST_FROMHOSP = #{cj.hospitalCode, jdbcType=VARCHAR}
        AND (STATUS = 'APPROVED' OR STATUS = 'PENDING') AND
        DATEDIFF(day, REQUEST_DATETIME, GETDATE()) &gt;= 0 AND
        DATEDIFF(day, REQUEST_DATETIME, GETDATE()) &lt; 3)
        AND CONSULT_SUBTYPE = #{cj.consultSubtype, jdbcType=INTEGER}
        ) THEN 1
        ELSE 0
        END
        AS BIT)
    </select>

    <select id="getRequestByComparisonMember" resultType="java.lang.Integer">
        SELECT CAST(
        CASE WHEN EXISTS(
        SELECT MACEREQUEST_ID, DOCTOR_CODE FROM MACEREQ_CONSULT WHERE DOCTOR_CODE = #{c.doctorCode, jdbcType=VARCHAR}
        AND MACEREQUEST_ID IN
        (SELECT REQUEST_ID FROM MACE_REQUEST
        WHERE MEMBER_CODE = #{c.memberCode, jdbcType=VARCHAR}
        AND REQUEST_FROMHOSP = #{c.hospitalCode, jdbcType=VARCHAR}
        AND (STATUS = 'APPROVED' OR STATUS = 'PENDING') AND
        DATEDIFF(day, REQUEST_DATETIME, GETDATE()) &gt;= 0 AND
        DATEDIFF(day, REQUEST_DATETIME, GETDATE()) &lt; 3)
        AND CONSULT_SUBTYPE = #{c.consultSubtype, jdbcType=INTEGER}
        ) THEN 2
        WHEN EXISTS(SELECT MACEREQUEST_ID FROM MACEREQ_CONSULT WHERE
        MACEREQUEST_ID IN
        (SELECT REQUEST_ID FROM MACE_REQUEST
        WHERE MEMBER_CODE = #{c.memberCode, jdbcType=VARCHAR}
        AND REQUEST_FROMHOSP = #{c.hospitalCode, jdbcType=VARCHAR}
        AND (STATUS = 'APPROVED' OR STATUS = 'PENDING') AND
        DATEDIFF(day, REQUEST_DATETIME, GETDATE()) &gt;= 0 AND
        DATEDIFF(day, REQUEST_DATETIME, GETDATE()) &lt; 3)
        AND CONSULT_SUBTYPE = #{c.consultSubtype, jdbcType=INTEGER}
        ) THEN 1
        ELSE 0
        END
        AS INT)
    </select>

    <select id="checkForDuplicateBasicTest" resultType="java.lang.Boolean">
        SELECT CAST(
        CASE WHEN EXISTS(
        SELECT MACEREQUEST_ID FROM MACE_REQ_OP_TESTS WHERE
        MACEREQUEST_ID IN
        (SELECT REQUEST_ID FROM MACE_REQUEST
        WHERE MEMBER_CODE = #{bootrj.memberCode, jdbcType=VARCHAR}
        AND REQUEST_FROMHOSP = #{bootrj.hospitalCode, jdbcType=VARCHAR}
        AND (STATUS = 'APPROVED' OR STATUS = 'PENDING') AND
        DATEDIFF(day, REQUEST_DATETIME, GETDATE()) &gt;= 0 AND
        DATEDIFF(day, REQUEST_DATETIME, GETDATE()) &lt; 3)
        AND MACE_SUBTYPE = 3
        AND ProcedureId IN
        <foreach item="procId" collection="procIds" separator="," open="(" close=")">
            #{procId, jdbcType=INTEGER}
        </foreach>
        ) THEN 1
        ELSE 0
        END
        AS BIT)
    </select>

    <select id="checkForDuplicateTest" resultType="java.lang.Boolean">
        SELECT CAST(
        CASE WHEN EXISTS(
        SELECT MACEREQUEST_ID FROM MACE_REQ_OP_TESTS WHERE
        MACEREQUEST_ID IN
        (SELECT REQUEST_ID FROM MACE_REQUEST
        WHERE MEMBER_CODE = #{bootrj.memberCode, jdbcType=VARCHAR}
        AND REQUEST_FROMHOSP = #{bootrj.hospitalCode, jdbcType=VARCHAR}
        AND (STATUS = 'APPROVED' OR STATUS = 'PENDING') AND
        DATEDIFF(day, REQUEST_DATETIME, GETDATE()) &gt;= 0 AND
        DATEDIFF(day, REQUEST_DATETIME, GETDATE()) &lt; 3)
        AND MACE_SUBTYPE = 4
        AND ProcedureId IN
        <foreach item="procId" collection="procIds" separator="," open="(" close=")">
            #{procId, jdbcType=INTEGER}
        </foreach>
        ) THEN 1
        ELSE 0
        END
        AS BIT)
    </select>

    <select id="checkForDuplicateProc" resultType="java.lang.Boolean">
        SELECT CAST(
        CASE WHEN EXISTS(
        SELECT MACEREQUEST_ID FROM MACE_REQ_OP_PROCEDURE WHERE
        MACEREQUEST_ID IN
        (SELECT REQUEST_ID FROM MACE_REQUEST
        WHERE MEMBER_CODE = #{bootrj.memberCode, jdbcType=VARCHAR}
        AND REQUEST_FROMHOSP = #{bootrj.hospitalCode, jdbcType=VARCHAR}
        AND (STATUS = 'APPROVED' OR STATUS = 'PENDING') AND
        DATEDIFF(day, REQUEST_DATETIME, GETDATE()) &gt;= 0 AND
        DATEDIFF(day, REQUEST_DATETIME, GETDATE()) &lt; 3)
        AND ProcedureId IN
        <foreach item="procId" collection="procIds" separator="," open="(" close=")">
            #{procId, jdbcType=INTEGER}
        </foreach>
        ) THEN 1
        ELSE 0
        END
        AS BIT)
    </select>

    <resultMap id="maceAnnouncementsMap" type="com.basicauth.domain.MaceAnnouncements">
        <result column="MESSAGE_HEADER" property="messageHeader" jdbcType="VARCHAR"/>
        <result column="MESSAGE_CONTENT" property="messageContent" jdbcType="VARCHAR"/>
        <result column="DATE_POSTED" property="datePosted" jdbcType="TIMESTAMP"/>
        <result column="UPDATED_ON" property="updatedOn" jdbcType="TIMESTAMP"/>
        <result column="UPDATED_BY" property="updatedBy" jdbcType="VARCHAR"/>
        <result column="POSTED_BY" property="postedBy" jdbcType="VARCHAR"/>
        <result column="MESSAGE_TYPE" property="messageType" jdbcType="VARCHAR"/>
    </resultMap>

    <select id="getAnnouncements" resultMap="maceAnnouncementsMap" resultType="java.util.List">
        SELECT TOP 15 * FROM MACE_ANNOUNCEMENTS
        ORDER BY UPDATED_ON DESC
    </select>

    <resultMap id="MaceFaqs" type="com.basicauth.data.MaceFaqs">
        <result column="header" property="header" jdbcType="VARCHAR"/>
        <result column="body" property="body" jdbcType="VARCHAR"/>
        <result column="list_index" property="index" jdbcType="INTEGER"/>
    </resultMap>

    <select id="getMaceFaqs" resultMap="MaceFaqs" resultType="java.util.List">
        SELECT * FROM MACE_FAQS
        ORDER BY list_index ASC
    </select>

    <select id="getMemberFilteredLoaList" resultMap="MaceRequestMap" resultType="java.util.List">
        SELECT TOP 10 * FROM MACE_REQUEST
        WHERE MEMBER_CODE = #{loaFilter.memberCode, jdbcType=VARCHAR}
        <if test="loaFilter.status != null">
            AND STATUS = #{loaFilter.status, jdbcType=VARCHAR}
        </if>
        <if test="loaFilter.serviceTypeId != 0">
            AND SERVICETYPE_ID = #{loaFilter.serviceTypeId, jdbcType=INTEGER}
        </if>
        <if test="loaFilter.hospitalCode != null">
            AND REQUEST_FROMHOSP = #{loaFilter.hospitalCode, jdbcType=VARCHAR}
        </if>
        <if test="loaFilter.doctorCode != null">
            AND REQUEST_ID IN (
            SELECT DISTINCT MACEREQUEST_ID FROM MACE_REQ_OP_DOCTOR
            WHERE DOCTOR_CODE = #{loaFilter.doctorCode, jdbcType=VARCHAR}
            )
        </if>
        <if test="loaFilter.procCode != null">
            AND REQUEST_ID IN (
            SELECT DISTINCT MACEREQUEST_ID FROM MACE_REQ_OP_TESTS
            WHERE PROC_CODE = #{loaFilter.procCode, jdbcType=VARCHAR}
            UNION
            SELECT DISTINCT MACEREQUEST_ID FROM MACE_REQ_OP_PROCEDURE
            WHERE PROC_CODE = #{loaFilter.procCode, jdbcType=VARCHAR}
            )
        </if>
        <if test="loaFilter.diagCode != null">
            AND REQUEST_ID IN (
            SELECT DISTINCT MACEREQUEST_ID FROM MACE_REQ_OP_DIAG
            WHERE DIAG_CODE = #{loaFilter.diagCode, jdbcType=VARCHAR}
            )
        </if>
        <if test="loaFilter.startDate != null">
            AND REQUEST_DATETIME &gt;= #{loaFilter.startDate, jdbcType=TIMESTAMP}
        </if>
        <if test="loaFilter.endDate != null">
            AND REQUEST_DATETIME &lt;= #{loaFilter.endDate, jdbcType=TIMESTAMP}
        </if>
        ORDER BY REQUEST_DATETIME DESC
    </select>

    <select id="getRequestDetailsList" resultMap="MaceRequestMap" resultType="java.util.List">
        SELECT *
        FROM MACE_REQUEST
        <if test="memberCode != null">
            WHERE MEMBER_CODE = #{memberCode}
            <if test="hospCode != null">
                AND REQUEST_ID IN (SELECT MACEREQUEST_ID
                FROM MACEREQ_CONSULT
                WHERE DOCTOR_CODE = #{doctorCode} AND HOSPITAL_CODE = #{hospCode})
                UNION
                SELECT *
                FROM MACE_REQUEST
                WHERE MEMBER_CODE = #{memberCode}
                AND REQUEST_ID IN (SELECT MACEREQUEST_ID
                FROM MACEREQ_TEST
                WHERE DOCTOR_CODE = #{doctorCode} AND HOSPITAL_CODE = #{hospCode})
                UNION
                SELECT *
                FROM MACE_REQUEST
                WHERE MEMBER_CODE = #{memberCode}
                AND REQUEST_ID IN (SELECT MACEREQUEST_ID
                FROM MACEREQ_PROCEDURE
                WHERE DOCTOR_CODE = #{doctorCode} AND HOSPITAL_CODE = #{hospCode})
                ORDER BY REQUEST_DATETIME DESC
            </if>

        </if>
        <if test="memberCode == null and hospCode == null">
            WHERE REQUEST_ID IN (SELECT MACEREQUEST_ID
            FROM MACEREQ_CONSULT
            WHERE DOCTOR_CODE = #{doctorCode})
            UNION
            SELECT *
            FROM MACE_REQUEST
            WHERE MEMBER_CODE = #{memberCode}
            AND REQUEST_ID IN (SELECT MACEREQUEST_ID
            FROM MACEREQ_TEST
            WHERE DOCTOR_CODE = #{doctorCode})
            UNION
            SELECT *
            FROM MACE_REQUEST
            WHERE MEMBER_CODE = #{memberCode}
            AND REQUEST_ID IN (SELECT MACEREQUEST_ID
            FROM MACEREQ_PROCEDURE
            WHERE DOCTOR_CODE = #{doctorCode})
            ORDER BY REQUEST_DATETIME DESC
        </if>


    </select>

    <select id="getAppUserByDoctorCode" resultType="com.basicauth.data.AppUser">
        SELECT TOP 1 * FROM APPUSER WHERE DOCTOR_CODE = #{doctorCode}
    </select>
    <select id="getMaceRequestsByRequestCodes" resultMap="maceRequestMap" resultType="java.util.List">
        SELECT * FROM MACE_REQUEST
        WHERE SERVICETYPE_ID = #{serviceTypeId}
        AND REQUEST_CODE IN
        <foreach item="reqCode" collection="requestCodes" separator="," open="(" close=")">
            #{reqCode, jdbcType=VARCHAR}
        </foreach>
    </select>

    <resultMap id="MaceIPLogs" type="com.basicauth.data.MaceIPRequestLogs">
        <result column="MACEREQUEST_ID" property="maceRequestId" jdbcType="INTEGER"/>
        <result column="TRANSACTION_ID" property="transactionId" jdbcType="INTEGER"/>
        <result column="RECORD_SUBMITTED_ON" property="requestDateTime" jdbcType="TIMESTAMP"/>
        <result column="RECORD_SUBMITTED_BY" property="updatedBy" jdbcType="VARCHAR"/>
    </resultMap>

    <select id="getIPLogsByMemCode" resultMap="MaceIPLogs" resultType="java.util.List">
        SELECT MACEREQUEST_ID, TRANSACTION_ID, RECORD_SUBMITTED_BY, RECORD_SUBMITTED_ON FROM MACEREQ_INPATIENT
        WHERE MACEREQUEST_ID =
        (SELECT TOP 1 REQUEST_ID FROM MACE_REQUEST
        WHERE MEMBER_CODE = #{memCode}
        AND SERVICETYPE_ID = 4)
        AND STATUS = 'ADMITTED'
        ORDER BY RECORD_SUBMITTED_ON DESC
    </select>
    <select id="getMaceReqInpatientByReqIdTransId" resultType="com.basicauth.data.MaceReqInpatient"
            resultMap="maceReqInpatientMap">
        SELECT TOP 1 * FROM MACEREQ_INPATIENT WHERE MACEREQUEST_ID = #{maceReqId} AND TRANSACTION_ID = #{transId}
    </select>

    <select id="getMaceReqIpDoctorsByReqIdTransId" resultMap="maceReqIpDoctorMap" resultType="java.util.List">
        SELECT * FROM MACE_REQ_IP_DOCTOR
        WHERE MACEREQUEST_ID = #{requestId}
        AND TRANSACTION_ID = #{transactionId}
    </select>


    <select id="getMaceReqIpDiagByReqIdTransId" resultType="java.util.List" resultMap="maceReqIpDiagMap">
        SELECT * FROM MACE_REQ_IP_DIAG
        WHERE MACEREQUEST_ID = #{requestId}
        AND TRANSACTION_ID = #{transactionId}
    </select>
    <select id="getMaceReqIpDiagProcsByReqIdTransId" resultType="java.util.List" resultMap="maceReqIpDiagProcMap">
        SELECT * FROM MACE_REQ_IP_DIAGPROC
        WHERE MACEREQUEST_ID = #{requestId}
        AND TRANSACTION_ID = #{transactionId}
    </select>
    <select id="getMaceReqInpatientsByReqId" resultType="java.util.List" resultMap="maceReqInpatientMap">
        SELECT * FROM MACEREQ_INPATIENT WHERE MACEREQUEST_ID = #{requestId}
    </select>
    <select id="getMaceReqIpRooms" resultType="java.util.List" resultMap="maceReqIpRoomMap">
        SELECT * FROM MACE_REQ_IP_ROOM WHERE MACEREQUEST_ID = #{requestId}
    </select>

    <resultMap id="MacePrescribedTestMap" type="com.basicauth.domain.MacePrescribedTestObject">
        <result column="PRESCRIBEDTEST_ID" property="prescribedTestId" jdbcType="INTEGER"/>
        <result column="REQDIAG_ID" property="reqDiagId" jdbcType="INTEGER"/>
        <result column="MACEREQUEST_ID" property="maceRequestId" jdbcType="INTEGER"/>
        <result column="CONS_TRANSACTION_ID" property="consTransactionId" jdbcType="INTEGER"/>
        <result column="PROC_CODE" property="procCode" jdbcType="VARCHAR"/>
        <result column="PROC_DESC" property="procDesc" jdbcType="VARCHAR"/>
        <result column="GROUP" property="group" jdbcType="VARCHAR"/>
        <result column="PROC_TYPE" property="procType" jdbcType="VARCHAR"/>
        <result column="PROC_TYPEDESC" property="procTypeDesc" jdbcType="VARCHAR"/>
        <result column="PROC_CLASS" property="procClass" jdbcType="VARCHAR"/>
        <result column="PROC_CLASSDESC" property="procClassDesc" jdbcType="VARCHAR"/>
        <result column="APPROVAL_TYPE_ID" property="approvalTypeId" jdbcType="INTEGER"/>
        <result column="APPROVAL_TYPE" property="approvalType" jdbcType="VARCHAR"/>
        <result column="COST_CENTER_ID" property="costCenterId" jdbcType="INTEGER"/>
        <result column="COST_CENTER" property="costCenter" jdbcType="VARCHAR"/>
        <result column="STATUS" property="status" jdbcType="INTEGER"/>
        <result column="MACE_SUBTYPE" property="maceSubType" jdbcType="INTEGER"/>
    </resultMap>

    <select id="getMaceConsPrescribedTestsByReqId" resultType="java.util.List" resultMap="maceConsPrescribedtestMap">
        SELECT * FROM MACE_CONS_PRESCRIBEDTEST
        WHERE MACEREQUEST_ID = #{requestId}
    </select>

    <select id="getMaceAttachmentsByReqCodeTransId" resultType="java.util.List" resultMap="loaMaceAttachmentMap">
        SELECT * FROM MACE_REQUEST_ATTACHMENTS
        WHERE request_code = #{requestCode} AND transaction_id = #{transactionId}
    </select>
    <select id="getIPAuditLogs" resultType="java.util.List" resultMap="MaceAuditMap">
        SELECT * FROM MACE_AUDIT
        WHERE MaceRequestId = #{requestId}
    </select>


    <resultMap id="MaceClaimsMap" type="com.basicauth.domain.MaceClaims">
        <result column="LOA_NUMBER" property="loaNumber" jdbcType="VARCHAR"/>
        <result column="CONTROL_CODE" property="controlCode" jdbcType="VARCHAR"/>
        <result column="MEMBER_CODE" property="memberCode" jdbcType="VARCHAR"/>
        <result column="MEMBER_NAME" property="memberName" jdbcType="VARCHAR"/>
        <result column="VISIT_DATE" property="visitDate" jdbcType="TIMESTAMP"/>
        <result column="MEM_TYPE" property="memType" jdbcType="VARCHAR"/>
        <result column="SA_AMOUNT" property="saAmount" jdbcType="NUMERIC"/>
        <result column="DISAPPROVED" property="disapproved" jdbcType="NUMERIC"/>
        <result column="ADVANCES" property="advances" jdbcType="NUMERIC"/>
        <result column="ERC" property="erc" jdbcType="NUMERIC"/>
        <result column="APPROVED" property="approved" jdbcType="NUMERIC"/>
        <result column="TYPE" property="type" jdbcType="VARCHAR"/>
        <result column="STATUS" property="status" jdbcType="VARCHAR"/>
        <result column="SUBMITTED_BY" property="submittedBy" jdbcType="VARCHAR"/>
        <result column="DATE_SUBMITTED" property="dateSubmitted" jdbcType="TIMESTAMP"/>
        <result column="DATE_RECIEVED" property="dateRecieved" jdbcType="TIMESTAMP"/>
        <result column="HOSPITAL_CLINIC" property="hospitalClinic" jdbcType="VARCHAR"/>
        <result column="DUE_DATE" property="dueDate" jdbcType="TIMESTAMP"/>
    </resultMap>

    <delete id="deleteAllSubrequestData" flushCache="true">
        DELETE FROM MACE_REQ_OP_TESTS WHERE MACEREQUEST_ID = #{parRequestId};
        DELETE FROM MACE_REQ_OP_PROCEDURE WHERE MACEREQUEST_ID = #{parRequestId};
        DELETE FROM MACE_REQ_OP_DIAG WHERE MACEREQUEST_ID = #{parRequestId};
        DELETE FROM MACE_REQ_OP_DOCTOR WHERE MACEREQUEST_ID = #{parRequestId};
        DELETE FROM MACE_REQ_OP_ROOM WHERE MACEREQUEST_ID = #{parRequestId};
        DELETE FROM MACE_REQ_OP_OTHERCHARGES WHERE MACEREQUEST_ID = #{parRequestId};
        DELETE FROM MACE_REQ_OP_OTHERINFORMATION WHERE MACEREQUEST_ID = #{parRequestId};
        DELETE FROM MACEREQ_TEST WHERE MACEREQUEST_ID = #{parRequestId};
        DELETE FROM MACEREQ_PROCEDURE WHERE MACEREQUEST_ID = #{parRequestId};
    </delete>


    <resultMap id="MaceInpatientAudit" type="com.basicauth.domain.MaceInpatientAudit">
        <result column="MACEREQUEST_ID" property="maceRequestId" jdbcType="INTEGER"/>
        <result column="TRANSACTION_ID" property="transactionId" jdbcType="INTEGER"/>
        <result column="REQUEST_ORIGIN" property="requestOrigin" jdbcType="VARCHAR"/>
        <result column="REQUESTED_BY" property="requestedBy" jdbcType="VARCHAR"/>
        <result column="AUDIT_REMARKS" property="auditRemarks" jdbcType="VARCHAR"/>
        <result column="AUDIT_DATE" property="auditDate" jdbcType="TIMESTAMP"/>
        <result column="MEMBER_CODE" property="memberCode" jdbcType="VARCHAR"/>
    </resultMap>

    <resultMap id="MaceAuditMap" type="com.basicauth.domain.MaceAudit">
        <result column="MaceRequestId" property="maceRequestId" jdbcType="INTEGER"/>
        <result column="ReferenceColumnId" property="referenceColumnId" jdbcType="INTEGER"/>
        <result column="OldValue" property="oldValue" jdbcType="VARCHAR"/>
        <result column="NewValue" property="newValue" jdbcType="VARCHAR"/>
        <result column="CreatedBy" property="createdBy" jdbcType="VARCHAR"/>
        <result column="CreatedDate" property="createdDate" jdbcType="TIMESTAMP"/>
    </resultMap>

    <insert id="insertMaceInpatientAudit">
        INSERT INTO MACEREQ_INPATIENT_AUDIT(
        MACEREQUEST_ID,
        TRANSACTION_ID,
        REQUEST_ORIGIN,
        REQUESTED_BY,
        AUDIT_REMARKS,
        AUDIT_DATE,
        MEMBER_CODE
        )VALUES(
        #{mia.maceRequestId, jdbcType=INTEGER},
        #{mia.transactionId, jdbcType=INTEGER},
        #{mia.requestOrigin, jdbcType=VARCHAR},
        #{mia.requestedBy, jdbcType=VARCHAR},
        #{mia.auditRemarks, jdbcType=VARCHAR},
        #{mia.auditDate, jdbcType=TIMESTAMP},
        #{mia.memberCode, jdbcType=VARCHAR}
        )
    </insert>

    <select id="getInPatientContactLogs" resultType="java.util.List" resultMap="IpAuditLogsContactMap">
        SELECT * FROM MACE_REQUEST WHERE REQUEST_ID = #{requestId}
    </select>
    <select id="getInPatientRemarksLogs" resultType="java.util.List" resultMap="IpAuditLogsRemarksMap">
        SELECT * FROM MACEREQ_INPATIENT WHERE MACEREQUEST_ID = #{requestId}
    </select>
    <select id="getInPatientRoomLogs" resultType="java.util.List" resultMap="IpAuditLogsRoomMap">
          SELECT AA.ROOM_NO,BB.RATE,BB.ROOMPLAN,BB.ADDED_ON,
          BB.ADDED_BY,BB.DATE_FROM,BB.DATE_TO
          FROM MACE_REQ_IP_ROOM BB JOIN MACEREQ_INPATIENT AA
          ON  AA.MACEREQUEST_ID = BB.MACEREQUEST_ID
          WHERE BB.MACEREQUEST_ID = #{requestId}
    </select>


    <resultMap id="IpAuditLogsContactMap" type="com.basicauth.data.IpAuditLogsContact">
        <result column="HOSP_CONTACT" property="hospContact" jdbcType="VARCHAR"/>
        <result column="HOSP_EMAIL" property="hospEmail" jdbcType="VARCHAR"/>
        <result column="MEM_CONTACT" property="memberContact" jdbcType="VARCHAR"/>
        <result column="REQUEST_BY" property="createdBy" jdbcType="VARCHAR"/>
        <result column="REQUEST_DATETIME" property="createdDate" jdbcType="VARCHAR"/>
    </resultMap>
    <resultMap id="IpAuditLogsRoomMap" type="com.basicauth.data.IpAuditLogsRoom">
        <result column="ROOM_NO" property="roomNo" jdbcType="VARCHAR"/>
        <result column="RATE" property="roomPrice" jdbcType="VARCHAR"/>
        <result column="ROOMPLAN" property="roomCategory" jdbcType="VARCHAR"/>
        <result column="DATE_FROM" property="dateFrom" jdbcType="VARCHAR"/>
        <result column="DATE_TO" property="dateTo" jdbcType="VARCHAR"/>
        <result column="ADDED_BY" property="createdBy" jdbcType="VARCHAR"/>
        <result column="ADDED_ON" property="createdDate" jdbcType="VARCHAR"/>
    </resultMap>

    <resultMap id="IpAuditLogsRemarksMap" type="com.basicauth.data.IpAuditLogsRemarks">
        <result column="IP_REASON_REMARKS" property="remarks" jdbcType="VARCHAR"/>
        <result column="RECORD_SUBMITTED_BY" property="createdBy" jdbcType="VARCHAR"/>
        <result column="RECORD_SUBMITTED_ON" property="createdDate" jdbcType="VARCHAR"/>
    </resultMap>


    <select id="getInPatientDateLogs" resultType="string">
        SELECT DISTINCT CreatedDate
        FROM (
        SELECT [CreatedDate]
        FROM [Mace].[dbo].[MACE_REQ_IP_DIAG]
        WHERE MACEREQUEST_ID = #{requestId}
        UNION
        SELECT [CreatedDate]
        FROM [Mace].[dbo].[MACE_REQ_IP_DIAGPROC]
        WHERE MACEREQUEST_ID = #{requestId}
        UNION
        SELECT [ADDED_ON] AS CreatedDate
        FROM [Mace].[dbo].[MACE_REQ_IP_DOCTOR]
        WHERE MACEREQUEST_ID = #{requestId}
        UNION
        SELECT [ADDED_ON] AS CreatedDate
        FROM [Mace].[dbo].[MACE_REQ_IP_ROOM]
        WHERE MACEREQUEST_ID = #{requestId}
        UNION
        SELECT [added_on] AS CreatedDate
        FROM [Mace].[dbo].[MACE_REQUEST_ATTACHMENTS]
        WHERE REQUEST_ID = #{requestId}
        ) DistinctCreatedDate
        WHERE CreatedDate IS NOT NULL
        ORDER BY CreatedDate DESC
    </select>
    <select id="getMaceReqIpDoctorsByReqIdTransIdRequestDate" resultMap="maceReqIpDoctorMap"
            resultType="java.util.List">
        SELECT * FROM MACE_REQ_IP_DOCTOR
        WHERE MACEREQUEST_ID = #{requestId}
        AND TRANSACTION_ID = #{transactionId}
        AND ADDED_ON = #{requestDate}
    </select>
    <select id="getMaceReqIpDiagByReqIdTransIdRequestDate" resultType="java.util.List" resultMap="maceReqIpDiagMap">
        SELECT * FROM MACE_REQ_IP_DIAG
        WHERE MACEREQUEST_ID = #{requestId}
        AND TRANSACTION_ID = #{transactionId}
        AND CreatedDate = #{requestDate}
    </select>
    <select id="getMaceReqIpDiagProcsByReqIdTransIdRequestDate" resultType="java.util.List"
            resultMap="maceReqIpDiagProcMap">
        SELECT * FROM MACE_REQ_IP_DIAGPROC
        WHERE MACEREQUEST_ID = #{requestId}
        AND TRANSACTION_ID = #{transactionId}
        AND CreatedDate = #{requestDate}
    </select>
    <select id="getMaceReqIpRoomRequestDate" resultMap="maceReqIpRoomMap"
            resultType="com.basicauth.domain.MaceReqIpRoom">
        SELECT TOP 1 * FROM mace_req_ip_room
        WHERE macerequest_id =#{requestId}
        AND transaction_id =#{transactionId}
        AND ADDED_ON =#{requestDate}
    </select>

    <select id="getMaceReqIpRoomsTransId" resultType="java.util.List" resultMap="maceReqIpRoomMap">
        SELECT * FROM MACE_REQ_IP_ROOM WHERE MACEREQUEST_ID = #{requestId} AND TRANSACTION_ID = #{transactionId}
    </select>

    <select id="inpatientHasLoaNo" resultType="java.lang.Boolean">
        SELECT CAST(
        CASE WHEN EXISTS(SELECT TOP 1 LOA_NO
        FROM MACE_REQ_IP_LOASHEET WHERE MACEREQUEST_ID = #{requestId}) THEN 1
        ELSE 0
        END
        AS BIT)
    </select>
    <select id="getMaceRequestByRequestIdList" resultMap="maceRequestMap" resultType="java.util.List">
        SELECT * FROM MACE_REQUEST WHERE REQUEST_ID = #{requestId}
    </select>

    <select id="getMaceRequestsByHospitalCodeMemberCode" resultMap="maceRequestMap" resultType="java.util.List">
        SELECT * FROM MACE_REQUEST
        WHERE MEMBER_CODE = #{memberCode}
        <if test="hospitalCode != null and !hospitalCode.isEmpty()">
            AND REQUEST_FROMHOSP = #{hospitalCode}
        </if>
        AND STATUS = 'APPROVED'
        AND SERVICETYPE_ID = 1
        ORDER BY REQUEST_DATETIME DESC;
    </select>
    <select id="getMaceReqOpDiagByReqDiagId" resultMap="maceReqOpDiagMap"
            resultType="com.basicauth.data.MaceRequestOpDiag">
        SELECT * FROM MACE_REQ_OP_DIAG WHERE REQDIAG_ID = #{reqDiagId}
    </select>

    <select id="getLastMaceReqIpDiagByRequestId" resultMap="maceReqIpDiagMap"
            resultType="com.basicauth.domain.MaceReqIpDiag">
        SELECT TOP 1 * FROM MACE_REQ_IP_DIAG
        WHERE MACEREQUEST_ID = #{requestId}
        ORDER BY CreatedDate DESC
    </select>

    <select id="getMaceReqInpatientsHistoryByReqId" resultType="java.util.List" resultMap="maceReqInpatientMap">
        SELECT * FROM MACEREQ_INPATIENT_HISTORY WHERE MACEREQUEST_ID = #{requestId}
    </select>

    <select id="getMaceRequestApprovalByRequestIdTransId" resultType="java.util.List" resultMap="maceReqApprovalsMap">
        SELECT DISTINCT(RESULT_REASON_MESSAGE) FROM MACE_REQUEST_APPROVALS
        WHERE REQUEST_ID = #{maceRequestId}
        AND TRANSACTION_ID = #{transactionId}
    </select>
    <select id="getMaceAttachmentsByReqCodeTransIdReqDate" resultType="java.util.List" resultMap="loaMaceAttachmentMap">
        SELECT * FROM MACE_REQUEST_ATTACHMENTS
        WHERE request_code = #{requestCode}
        AND transaction_id = #{transactionId}
        AND added_on = #{requestDate}
    </select>

    <resultMap id="maceReqApprovalsMap" type="com.basicauth.data.MaceRequestApproval">
        <result column="ID" property="id" jdbcType="NUMERIC"/>
        <result column="APPROVAL_RULE_CLASS_NAME" property="approvalRuleClassName" jdbcType="VARCHAR"/>
        <result column="REQUEST_ID" property="requestId" jdbcType="NUMERIC"/>
        <result column="REQUEST_CODE" property="requestCode" jdbcType="VARCHAR"/>
        <result column="TRANSACTION_ID" property="transactionId" jdbcType="NUMERIC"/>
        <result column="TRANS_CODE" property="transCode" jdbcType="VARCHAR"/>
        <result column="RUN_ON" property="runOn" jdbcType="TIMESTAMP"/>
        <result column="RUN_BY" property="runBy" jdbcType="VARCHAR"/>
        <result column="RESULT_STATUS" property="resultStatus" jdbcType="VARCHAR"/>
        <result column="RESULT_ASSIGNEE" property="resultAssignee" jdbcType="VARCHAR"/>
        <result column="RESULT_REASON_MESSAGE" property="resultReasonMessage" jdbcType="VARCHAR"/>
        <result column="ProcedureId" property="procedureId" jdbcType="INTEGER"/>
    </resultMap>

    <select id="getFilteredMemberLOAList" resultMap="MaceRequestMap" resultType="java.util.List" timeout="6000">
        SELECT *
        FROM MACE_REQUEST
        WHERE MEMBER_CODE = #{loaFilter.memberCode, jdbcType=VARCHAR}

        <if test="loaFilter.findBy != null and loaFilter.findBy != ''">
            AND (REQUEST_FROMHOSP IN (
            SELECT DISTINCT HOSPITAL_CODE
            FROM vw_Hospitals
            WHERE HOSPITAL_NAME LIKE #{loaFilter.findBy, jdbcType=VARCHAR})
            OR REQUEST_ID IN (
            SELECT DISTINCT MACEREQUEST_ID
            FROM (
            SELECT MACEREQUEST_ID
            FROM MACE_REQ_OP_DOCTOR
            WHERE (DOC_LNAME LIKE #{loaFilter.findBy, jdbcType=VARCHAR}
            OR DOC_FNAME LIKE #{loaFilter.findBy, jdbcType=VARCHAR}
            OR DOC_MNAME LIKE #{loaFilter.findBy, jdbcType=VARCHAR})
            UNION
            SELECT MACEREQUEST_ID
            FROM MACEREQ_TEST
            WHERE DOCTOR_CODE IN (
            SELECT DOCTOR_CODE
            FROM SYS_DOCTOR_LTBL
            WHERE (DOC_LNAME LIKE #{loaFilter.findBy, jdbcType=VARCHAR}
            OR DOC_FNAME LIKE #{loaFilter.findBy, jdbcType=VARCHAR}
            OR DOC_MNAME LIKE #{loaFilter.findBy, jdbcType=VARCHAR}))
            UNION
            SELECT MACEREQUEST_ID
            FROM MACEREQ_PROCEDURE
            WHERE DOCTOR_CODE IN (
            SELECT DOCTOR_CODE
            FROM SYS_DOCTOR_LTBL
            WHERE (DOC_LNAME LIKE #{loaFilter.findBy, jdbcType=VARCHAR}
            OR DOC_FNAME LIKE #{loaFilter.findBy, jdbcType=VARCHAR}
            OR DOC_MNAME LIKE #{loaFilter.findBy, jdbcType=VARCHAR}))
            ) DistinctRequestId
            WHERE MACEREQUEST_ID IS NOT NULL
            )
            OR REQUEST_ID IN (
            SELECT DISTINCT MACEREQUEST_ID
            FROM MACE_REQ_OP_TESTS
            WHERE PROC_DESC LIKE #{loaFilter.findBy, jdbcType=VARCHAR}
            UNION
            SELECT DISTINCT MACEREQUEST_ID
            FROM MACE_REQ_OP_PROCEDURE
            WHERE PROC_DESC LIKE #{loaFilter.findBy, jdbcType=VARCHAR}
            ))
        </if>

        <if test="loaFilter.status != null and loaFilter.status != ''">
            AND STATUS = #{loaFilter.status, jdbcType=VARCHAR}
        </if>

        <if test="loaFilter.serviceTypeId != 0">
            AND SERVICETYPE_ID = #{loaFilter.serviceTypeId, jdbcType=INTEGER}
        </if>

        <if test="loaFilter.hospitalCodes != null and !loaFilter.hospitalCodes.isEmpty()">
            AND REQUEST_FROMHOSP IN
            <foreach item="item" index="index" collection="loaFilter.hospitalCodes" open="(" separator="," close=")">
                #{item}
            </foreach>
        </if>


        <if test="loaFilter.doctorCodes != null and !loaFilter.doctorCodes.isEmpty()">
            AND REQUEST_ID IN (
            SELECT DISTINCT MACEREQUEST_ID
            FROM MACE_REQ_OP_DOCTOR
            WHERE DOCTOR_CODE IN
            <foreach item="item" index="index" collection="loaFilter.doctorCodes" open="(" separator="," close=")">
                #{item}
            </foreach>
            )
        </if>

        <if test="loaFilter.procIds != null and !loaFilter.procIds.isEmpty()">
            AND REQUEST_ID IN (
            SELECT DISTINCT requestId
            FROM (
            SELECT MACEREQUEST_ID
            FROM MACE_REQ_OP_TESTS
            WHERE ProcedureId IN
            <foreach item="item" index="index" collection="loaFilter.procIds" open="(" separator="," close=")">
                #{item}
            </foreach>
            UNION
            SELECT MACEREQUEST_ID
            FROM MACE_REQ_OP_PROCEDURE
            WHERE ProcedureId IN
            <foreach item="item" index="index" collection="loaFilter.procIds" open="(" separator="," close=")">
                #{item}
            </foreach>)
            ) DistinctRequestId
            WHERE RequestId IS NOT NULL
        </if>

        <if test="loaFilter.diagIds != null and !loaFilter.diagIds.isEmpty()">
            AND REQUEST_ID IN (
            SELECT DISTINCT REQUEST_ID
            FROM (
            SELECT MACEREQUEST_ID
            FROM MACEREQ_TEST
            WHERE PrimaryDiagnosisId IN
            <foreach item="item" index="index" collection="loaFilter.diagIds" open="(" separator="," close=")">
                #{item}
            </foreach>
            UNION
            SELECT MACEREQUEST_ID
            FROM MACE_REQ_OP_DIAG
            WHERE DiagnosisId IN
            <foreach item="item" index="index" collection="loaFilter.diagIds" open="(" separator="," close=")">
                #{item}
            </foreach>
            SELECT MACEREQUEST_ID
            FROM MACE_REQ_OP_PROCEDURE
            WHERE DiagnosisId IN
            <foreach item="item" index="index" collection="loaFilter.diagIds" open="(" separator="," close=")">
                #{item}
            </foreach>
            SELECT MACEREQUEST_ID
            FROM MACE_REQ_OP_TESTS
            WHERE DiagnosisId IN
            <foreach item="item" index="index" collection="loaFilter.diagIds" open="(" separator="," close=")">
                #{item}
            </foreach>
            UNION
            SELECT MACEREQUEST_ID
            FROM MACEREQ_PROCEDURE
            WHERE PrimaryDiagnosisId IN
            <foreach item="item" index="index" collection="loaFilter.diagIds" open="(" separator="," close=")">
                #{item}
            </foreach>
            ) DISTINCT_Diagnosis_Id
            )
            )
        </if>

        <if test="loaFilter.startDate != null">
            AND REQUEST_DATETIME &gt;= #{loaFilter.startDate, jdbcType=TIMESTAMP}
        </if>

        <if test="loaFilter.endDate != null">
            AND REQUEST_DATETIME &lt;= #{loaFilter.endDate, jdbcType=TIMESTAMP}
        </if>

        <if test="loaFilter.sortBy != null and loaFilter.sortBy != ''">
            <if test="loaFilter.sortBy == 1">
                ORDER BY STATUS, REQUEST_DATETIME DESC
            </if>
            <if test="loaFilter.sortBy == 2">
                ORDER BY REQUEST_DATETIME DESC
            </if>
            <if test="loaFilter.sortBy == 3">
                ORDER BY REQUEST_FROMHOSP, REQUEST_DATETIME DESC
            </if>
            <if test="loaFilter.sortBy == 4">
                ORDER BY SERVICETYPE_ID, REQUEST_DATETIME DESC
            </if>
        </if>

        OFFSET(#{loaFilter.offset} * #{loaFilter.count})ROWS
        FETCH NEXT #{loaFilter.count} ROWS ONLY
    </select>

    <select id="getLastMaceReqIpDoctorsByReqId" resultMap="maceReqIpDoctorMap" resultType="com.basicauth.domain.MaceReqIpDoctor">
        SELECT TOP 1 * FROM MACE_REQ_IP_DOCTOR
        WHERE MACEREQUEST_ID = #{maceRequestId}
        ORDER BY ADDED_ON DESC;
    </select>

    <select id="getLastReqIpDiagProcByRequestId" resultMap="maceReqIpDiagProcMap" resultType="com.basicauth.domain.MaceReqIpDiagproc">
        SELECT TOP 1 * FROM MACE_REQ_IP_DIAGPROC
        WHERE MACEREQUEST_ID = #{maceRequestId}
        ORDER BY CreatedDate DESC;
    </select>
    <select id="getLastMaceReqIpRoomByRequestId" resultMap="maceReqIpRoomMap" resultType="com.basicauth.domain.MaceReqIpRoom">
        SELECT TOP 1 * FROM MACE_REQ_IP_DOCTOR
        WHERE MACEREQUEST_ID = #{maceRequestId}
        ORDER BY ADDED_ON DESC;
    </select>

</mapper>
